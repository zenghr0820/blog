---
title: "JavaåŸºç¡€ - åå°„æœºåˆ¶"
date: "2021-05-08 15:00:00"
permalink: "2021-05-08-java-basic-reflect"
---

# Java åŸºç¡€ - åå°„æœºåˆ¶

:::tip

æœ¬æ–‡ä¸»è¦è®°å½•å­¦ä¹  Java åå°„ï¼ˆreflectï¼‰çš„ä¸€ç‚¹å¿ƒå¾—ï¼Œåœ¨äº†è§£åå°„ä¹‹å‰ï¼Œåº”è¯¥å…ˆäº†è§£ Java ä¸­çš„ Class ç±»

:::

## å¸¦ç€BATå¤§å‚çš„é¢è¯•é—®é¢˜å»ç†è§£

- Java åå°„çš„ä½œç”¨ï¼Ÿ
- å“ªé‡Œä¼šç”¨åˆ°åå°„ï¼Ÿ
- è·å– Class å¯¹è±¡æœ‰å‡ ç§æ–¹å¼?
- åå°„çš„å®ç°æ–¹å¼æœ‰å“ªäº›ï¼Ÿ
- åˆ©ç”¨åå°„åŠ¨æ€åˆ›å»ºå¯¹è±¡å®ä¾‹?



## ä»€ä¹ˆæ˜¯åå°„æœºåˆ¶

:::tip

Java åå°„æœºåˆ¶åœ¨ç¨‹åº**è¿è¡Œæ—¶**ï¼Œå¯¹äºä»»æ„ä¸€ä¸ªç±»ï¼Œéƒ½èƒ½å¤ŸçŸ¥é“è¿™ä¸ªç±»çš„æ‰€æœ‰å±æ€§å’Œæ–¹æ³•ï¼›å¯¹äºä»»æ„ä¸€ä¸ªå¯¹è±¡ï¼Œéƒ½èƒ½å¤Ÿè°ƒç”¨å®ƒçš„ä»»æ„ä¸€ä¸ªæ–¹æ³•å’Œå±æ€§ã€‚è¿™ç§ **åŠ¨æ€çš„è·å–ä¿¡æ¯** ä»¥åŠ **åŠ¨æ€è°ƒç”¨å¯¹è±¡çš„æ–¹æ³•** çš„åŠŸèƒ½ç§°ä¸º **java çš„åå°„æœºåˆ¶**

:::

## Classï¼ˆå­—èŠ‚ç å¯¹è±¡ï¼‰

Class æ˜¯ java.lang åŒ…é‡Œçš„ä¸€ä¸ªç±»ï¼Œåœ¨ Java ä¸­ï¼Œå­¦ä¹ é¢å‘å¯¹è±¡æ—¶ï¼Œæˆ‘ä»¬é€šå¸¸æŠŠå¤šä¸ªäº‹ç‰©ï¼Œå‘ç°ä»–ä»¬çš„å…±æ€§ç‰¹å¾ï¼ŒæŠ½å‡ºæ¥å†™æˆä¸€ä¸ª Java ç±»ï¼Œå¯ä»¥æ ¹æ®è¯¥ç±»åˆ›å»ºå…·ä½“çš„ä¸ªä½“å¯¹è±¡ï¼Œç¼–è¯‘æ—¶ä¼šç”Ÿæˆä¸€ä¸ªä¸ª `.class` åç¼€çš„å­—èŠ‚ç æ–‡ä»¶ã€‚

åœ¨å­¦ä¹  JVMå†…å­˜æ¨¡å‹æ—¶ [JavaåŸºç¡€ - Jvmå†…å­˜æ¨¡å‹](/passages/2021-04-09-java-lan-basic.html#jvm%E5%86%85%E5%AD%98%E6%A8%A1%E5%9E%8B) ï¼Œé‡Œé¢æœ‰ä¸€ä¸ª æ–¹æ³•åŒº(**Method Area**) æ˜¯ç”¨äºå­˜å‚¨ ç±»ä¿¡æ¯ã€å¸¸é‡ã€é™æ€å˜é‡ç­‰æ•°æ®ï¼Œå½“æˆ‘ä»¬çš„ç¨‹åºåœ¨è¿è¡Œæ—¶ï¼Œç”¨åˆ°æŸä¸ªç±»ä¾‹å¦‚ Person ç±»ï¼ŒJvm ä¼šå…ˆæ‰«æç„¶åé€šè¿‡ç±»åŠ è½½å™¨å°† Person çš„ç±»ä¿¡æ¯å­˜å‚¨åˆ° æ–¹æ³•åŒº(**Method Area**) ä¸­ï¼Œå†é€šè¿‡æŠ½å– `Person.class` å­—èŠ‚ç æ–‡ä»¶çš„æ¨¡æ¿æ¥åˆ›å»º **Class** å®ä¾‹ï¼Œæµç¨‹å¦‚ä¸‹ğŸ‘‡

![mark](https://media.zenghr.cn/blog/img/20210508/sLWmlVex9M9J.png?imageslim)

æ‰€ä»¥æˆ‘ä»¬ä¹Ÿå¯ä»¥è®¤ä¸ºä¸€ä¸ª `.class` å­—èŠ‚ç æ–‡ä»¶å°±æ˜¯ä¸€ä¸ª **Class** å¯¹è±¡ï¼Œæœ‰ä¸”åªæœ‰ä¸€ä¸ªå¯¹åº”çš„ Class å¯¹è±¡

## è·å–å­—èŠ‚ç å¯¹è±¡çš„ä¸‰ç§æ–¹å¼

é€šè¿‡ API ï¼Œæˆ‘ä»¬å¾—çŸ¥ Class ï¼Œæ²¡æœ‰å…¬å…±çš„æ„é€ å™¨ï¼Œå…¶åŸå› æ˜¯ Class å¯¹è±¡æ˜¯åœ¨åŠ è½½ç±»æ—¶ç”± Java è™šæ‹Ÿæœºè‡ªåŠ¨æ„é€ çš„

```java
// 1. é€šè¿‡å­—ç¬¦ä¸²è·å– Class å¯¹è±¡ï¼Œç§°ä¸º å…¨é™å®šå
Class clz1 = Class.forName("cn.zenghr.reflect.User");
// 2. é€šè¿‡ç±»çš„ class å±æ€§
Class clz2 = User.class;
// 3. é€šè¿‡å¯¹è±¡çš„ getClass() å‡½æ•°
User user = new User();
Class clz3 = user.getClass();
```

- ç¬¬ä¸€ç§æ–¹æ³•æ˜¯é€šè¿‡ç±»çš„ **å…¨é™å®šå** è·å– Class å¯¹è±¡ï¼Œè¿™ä¹Ÿæ˜¯æˆ‘ä»¬å¹³æ—¶æœ€å¸¸ç”¨çš„åå°„è·å– Class å¯¹è±¡çš„æ–¹æ³•ï¼›
- ç¬¬äºŒç§æ–¹æ³•æœ‰é™åˆ¶æ¡ä»¶ï¼šéœ€è¦å¯¼å…¥ç±»çš„åŒ…ï¼›
- ç¬¬ä¸‰ç§æ–¹æ³•å·²ç»æœ‰äº† User å¯¹è±¡ï¼Œä¸å†éœ€è¦åå°„

å› ä¸º Java è¿è¡Œæ—¶ï¼Œæ¯ä¸€ä¸ªç±»åªä¼šç”Ÿæˆä¸€ä¸ª Class å¯¹è±¡ï¼Œæœ‰ä¸”åªæœ‰ä¸€ä¸ªï¼Œæ‰€æœ‰ä¸‰ç§æ–¹å¼è·å–çš„ Class å¯¹è±¡æ˜¯åŒä¸€ä¸ª

```java
System.out.println(clz1 == clz2); // true
System.out.println(clz2 == clz3); // true
```
## åå°„å‰è¨€

:::tip

æ€»ç»“: API æ–¹æ³•ä¸­å¸¦ç€ **s** è¡¨ç¤ºè·å–å¤šä¸ªï¼Œå¸¦ç€ **`Declared`** è¡¨ç¤ºå¿½ç•¥æƒé™ï¼ŒåŒ…æ‹¬ç§æœ‰çš„ä¹Ÿå¯ä»¥è·å–åˆ°

:::

**User(æ¼”ç¤ºç±»ï¼Œä»¥ä¸‹ä»£ç éƒ½ä½¿ç”¨è¯¥ç±»æ¼”ç¤º)**

```java
public class User {
    private String name;
    private int age;
    
    // æ— å‚æ„é€ å™¨
    public User() {}
    
    // æœ‰å‚æ„é€ å™¨
    public User(String name, int age) {
        this.name = name;
        this.age = age;
    }

    // ç§æœ‰æ„é€ å™¨
    private User(String name) {
        this.name = name;
    }

    // å…¬å…±æ„æ–¹æ³• - æ— å‚
    public void show() {
        System.out.println("user - show");
    }

    // ç§æœ‰æ–¹æ³• - æœ‰å‚
    private void show(String msg) {
        System.out.println("userï¼š" + msg);
    }

    // å…¬å…±é™æ€æ–¹æ³• - æœ‰å‚
    public static void show(int age) {
        System.out.println("userï¼š" + age);
    }
    
    // seter / geter çœç•¥

}
```

## åå°„ API

Java ç±»çš„æˆå‘˜åŒ…æ‹¬ä»¥ä¸‹ä¸‰ç±»ï¼šå±æ€§å­—æ®µã€æ„é€ å‡½æ•°ã€æ–¹æ³•ã€‚åå°„çš„ API ä¹Ÿæ˜¯ä¸è¿™å‡ ä¸ªæˆå‘˜ç›¸å…³ğŸ‘‡

<img src="https://media.zenghr.cn/blog/img/20210508/FSMrNY6hgVkf.jpg?imageslim" alt="mark" style="zoom:50%;" />

- **Fiele** ç±»ï¼šæä¾›æœ‰å…³ç±»çš„å±æ€§ä¿¡æ¯ï¼Œä»¥åŠå¯¹å®ƒçš„åŠ¨æ€è®¿é—®æƒé™ã€‚å®ƒæ˜¯ä¸€ä¸ªå°è£…åå°„ç±»çš„å±æ€§çš„ç±»
- **Constructor** ç±»ï¼šæä¾›æœ‰å…³ç±»çš„æ„é€ æ–¹æ³•çš„ä¿¡æ¯ï¼Œä»¥åŠå¯¹å®ƒçš„åŠ¨æ€è®¿é—®æƒé™ã€‚å®ƒæ˜¯ä¸€ä¸ªå°è£…åå°„ç±»çš„æ„é€ æ–¹æ³•çš„ç±»ã€‚
- **Method** ç±»ï¼šæä¾›å…³äºç±»çš„æ–¹æ³•çš„ä¿¡æ¯ï¼ŒåŒ…æ‹¬æŠ½è±¡æ–¹æ³•ã€‚å®ƒæ˜¯ç”¨æ¥å°è£…åå°„ç±»æ–¹æ³•çš„ä¸€ä¸ªç±»ã€‚
- **Class** ç±»ï¼šè¡¨ç¤ºæ­£åœ¨è¿è¡Œçš„ Java åº”ç”¨ç¨‹åºä¸­çš„ç±»çš„å®ä¾‹ã€‚
- **Object** ç±»ï¼šObject æ˜¯æ‰€æœ‰ Java ç±»çš„çˆ¶ç±»ã€‚æ‰€æœ‰å¯¹è±¡éƒ½é»˜è®¤å®ç°äº† Object ç±»çš„æ–¹æ³•

### newInstance()

åœ¨ **Class** ç±»ä¸­æä¾›äº†é€šè¿‡æ— å‚æ„é€ å™¨å¿«é€Ÿæ„å»ºå¯¹è±¡çš„æ–¹æ³• **newInstance()** ï¼Œæ³¨æ„ï¼š`è¯¥æ–¹æ³•è‡ªä» jdk1.9 ä¹‹åè¢«æ ‡è®°ä¸º è¿‡æ—¶æ–¹æ³•`


## AccessibleObject

AccessibleObject ç±»æ˜¯ Fieldã€Method å’Œ Constructor å¯¹è±¡çš„åŸºç±»ã€‚å®ƒæä¾›äº†å°†åå°„çš„å¯¹è±¡æ ‡è®°ä¸ºåœ¨ä½¿ç”¨æ—¶å–æ¶ˆé»˜è®¤ Java  è¯­è¨€è®¿é—®æ§åˆ¶æ£€æŸ¥çš„èƒ½åŠ›

å¯¹äºå…¬å…±æˆå‘˜ã€é»˜è®¤ï¼ˆæ‰“åŒ…ï¼‰è®¿é—®æˆå‘˜ã€å—ä¿æŠ¤æˆå‘˜å’Œç§æœ‰æˆå‘˜ï¼Œåœ¨åˆ†åˆ«ä½¿ç”¨ Fieldã€Method æˆ– Constructor  å¯¹è±¡æ¥è®¾ç½®æˆ–è·å–å­—æ®µã€è°ƒç”¨æ–¹æ³•ï¼Œæˆ–è€…åˆ›å»ºå’Œåˆå§‹åŒ–ç±»çš„æ–°å®ä¾‹çš„æ—¶å€™ï¼Œä¼šæ‰§è¡Œè®¿é—®æ£€æŸ¥

å½“è®¿é—®ç§æœ‰çš„å±æ€§ã€æ–¹æ³•ã€æ„é€ å™¨æ—¶ï¼Œä¸å–æ¶ˆæƒé™æ§åˆ¶ä¼šæŠ›å‡ºå¼‚å¸¸ï¼š**IllegalAccessException**ï¼Œå…·ä½“å®ç°æ–¹æ³•

```java
// å–æ¶ˆæƒé™åè®°å¾—è¿˜åŸæƒé™
setAccessible(true); // å–æ¶ˆæƒé™
setAccessible(false) // è¿˜åŸæƒé™
```

## è·å–æ„é€ å™¨(Constructor)

è·å–æ„é€ å™¨çš„ **API** ï¼š

- **getConstructors()ï¼š** è·å–æ‰€æœ‰å…¬å…±çš„æ„é€ æ–¹æ³•
- **getDeclaredConstructors()ï¼š** å¿½ç•¥æƒé™ï¼Œè·å–æ‰€æœ‰æ„é€ å™¨åŒ…æ‹¬ç§æœ‰çš„
- **getConstructor(Class... parameterTypes)ï¼š** è·å–æŒ‡å®šçš„å…¬å…±æ„é€ å™¨ï¼Œargsï¼šå‚æ•°åˆ—è¡¨çš„ç±»å‹
- **getDeclaredConstructor(Class.. parameterTypes)ï¼š** è·å–æŒ‡å®šçš„æ„é€ å™¨ï¼Œargsï¼šå‚æ•°åˆ—è¡¨çš„ç±»å‹

**Constructor** ç±»å¸¸ç”¨æ–¹æ³•ï¼š**`newInstance()`** æ ¹æ®å­—èŠ‚ç ç”Ÿæˆä¸€ä¸ªå¯¹è±¡

```java
// è·å–å­—èŠ‚ç å¯¹è±¡
Class clz = User.class;

// è·å–æ‰€æœ‰æ„é€ å™¨ - å…¬å…±çš„
Constructor[] constructors = clz.getConstructors();
for (Constructor constructor : constructors) {
    System.out.println(constructor);
}

// å¿½ç•¥æƒé™ è·å–æ‰€æœ‰æ„é€ å™¨ - declared
Constructor[] declaredConstructors = clz.getDeclaredConstructors();
for (Constructor constructor : declaredConstructors) {
    System.out.println(constructor);
}

// è·å–æŒ‡å®šçš„å…¬å…±æ„é€ å™¨ - æ— å‚
Constructor constructor = clz.getConstructor();

// å¿½ç•¥æƒé™ è·å–æŒ‡å®šçš„æ„é€ å™¨ - æ— å‚
Constructor privateConstructor = clz.getDeclaredConstructor(String.class);
// è·å–æŒ‡å®šçš„å…¬å…±æ„é€ å™¨ - æœ‰å‚
Constructor constructor1 = clz.getConstructor(String.class, int.class);
```

## è·å–æ–¹æ³•(Method)

è·å–æ–¹æ³•çš„ **API** ï¼š

- **getMethods()ï¼š** è·å–å…¬å…±çš„æ–¹æ³•
- **getDeclaredMethods()ï¼š** å¿½ç•¥æƒé™ï¼Œè·å–æ‰€æœ‰æ–¹æ³•åŒ…æ‹¬ç§æœ‰çš„
- **getMethod(String name, Class<?>... parameterTypes)ï¼š** è·å–æŒ‡å®šçš„å…¬å…±æ–¹æ³•ï¼Œargsï¼šæ–¹æ³•åç§°ã€å‚æ•°åˆ—è¡¨çš„ç±»å‹
- **getDeclaredMethod(String name, Class<?>... parameterTypes)ï¼š** è·å–æŒ‡å®šçš„æ–¹æ³•ï¼Œargsï¼šæ–¹æ³•åç§°ã€å‚æ•°åˆ—è¡¨çš„ç±»å‹

**Method** ç±»ä¸­æœ‰ä¸ªæ–¹æ³•ï¼Œå¯ä»¥è°ƒç”¨æ‰§è¡Œæ–¹æ³• **`invoke(Object, Object... args)`**ï¼Œargsï¼šéœ€è¦è°ƒç”¨æ–¹æ³•çš„å¯¹è±¡å®ä¾‹ã€æ–¹æ³•å‚æ•°

```java
// è·å–å­—èŠ‚ç å¯¹è±¡
Class clz = User.class;
// è·å–æ‰€æœ‰å…¬å…±æ–¹æ³•
Method[] methods = clz.getMethods();
for (Method method : methods) {
    System.out.println(method);
}

// è·å–æ‰€æœ‰æ–¹æ³• - å¿½ç•¥æƒé™
Method[] declaredMethods = clz.getDeclaredMethods();
for (Method method : declaredMethods) {
    System.out.println(method);
}
// é€šè¿‡ Class çš„ newInstance() æ–¹æ³•å¿«é€Ÿé€šè¿‡æ— å‚æ„é€ å™¨æ„å»ºä¸€ä¸ªå¯¹è±¡
Object obj = clz.newInstance();
// è·å–æŒ‡å®šæ–¹æ³• - å…¬å…±çš„
Method show = clz.getMethod("show");
// è¿è¡Œæ–¹æ³•
show.invoke(obj);

// åå°„è·å–æ–¹æ³• - ç§æœ‰
Method show1 = clz.getDeclaredMethod("show", String.class);
// å–æ¶ˆæƒé™
show1.setAccessible(true);
show1.invoke(obj, "hello");
show1.setAccessible(false);

// åå°„è·å–é™æ€æ–¹æ³• todo: è°ƒç”¨é™æ€æ–¹æ³•æ—¶ å‚æ•°ä¼ å…¥ null
Method show2 = clz.getDeclaredMethod("show", int.class);
show2.invoke(null, 25);
```

## è·å–å­—æ®µ(Field)

è·å–å­—æ®µçš„ **API** ï¼š

- getFields()ï¼š è·å–å…¬å…±çš„å­—æ®µï¼Œï¼ˆ**å› ä¸ºå­—æ®µå¤§éƒ¨åˆ†æ˜¯ç§æœ‰çš„ï¼Œè¯¥æ–¹æ³•ä¸å¸¸ç”¨**ï¼‰
- **getDeclaredFields()ï¼š** å¿½ç•¥æƒé™ï¼Œè·å–æ‰€æœ‰å­—æ®µåŒ…æ‹¬ç§æœ‰çš„
- getField(String name)ï¼š è·å–æŒ‡å®šçš„å…¬å…±å­—æ®µ - **ä¸å¸¸ç”¨**ï¼Œargsï¼šå­—æ®µåç§°
- **getDeclaredField(String name)ï¼š** è·å–æŒ‡å®šçš„å­—æ®µï¼Œargsï¼šå­—æ®µåç§°

**Field** ç±» å¸¸ç”¨æ–¹æ³•ï¼š

- **getName()** - è·å–å­—æ®µåç§°
- **get()** - è·å–å­—æ®µå€¼
- **set()** - è®¾ç½®å­—æ®µå€¼

```java
User user = new User("å¼ ä¸‰ ", 20);
// è·å–å­—èŠ‚ç å¯¹è±¡
Class clz = user.getClass();
Field name = clz.getDeclaredField("name");

name.setAccessible(true);
// ä¿®æ”¹å­—æ®µå€¼
name.set(user, "æå››");
name.setAccessible(false);

// è·å–æ‰€æœ‰å­—æ®µï¼Œæ™®éä½¿ç”¨ getDeclaredFields()
Field[] fields = clz.getDeclaredFields();
// éå†å­—æ®µ
for (Field field : fields) {
    // è®¾ç½®ç§æœ‰å­—æ®µå¯è®¿é—®
    field.setAccessible(true);
    // è·å–æŒ‡å®šå­—æ®µå€¼
    System.out.println(field.getName() + "=" + field.get(user));
    // æ¢å¤æƒé™
    field.setAccessible(false);
}
```

## å†…çœ - Introspector

### ä»‹ç»

JavaBeanæ˜¯ä¸€ä¸ªéå¸¸å¸¸ç”¨çš„ç»„ä»¶,æ— å¤–ä¹å°±æ˜¯æ“ä½œé‡Œé¢çš„å±æ€§.è€Œä¹‹å‰å’±ä»¬è¦è·å–JavaBeanä¸­çš„æ–¹æ³•,å¦‚æœä½¿ç”¨åå°„éå¸¸éº»çƒ¦.SUNå…¬å¸ä¸“é—¨æä¾›äº†ä¸€å¥—æ“ä½œ Javabean å±æ€§çš„APIï¼šå†…çœï¼ˆ**Introspector**ï¼‰

### å†…çœçš„ä½œç”¨

1. è·å–åˆ°å±æ€§åå’Œå±æ€§ç±»å‹ç­‰ç›¸å…³çŠ¶æ€ä¿¡æ¯.
2. è·å–å±æ€§å¯¹åº”çš„è¯»å†™æ–¹æ³•æ“ä½œå±æ€§çš„å€¼ç­‰æ“ä½œæ–¹å¼.

### å†…çœç›¸å…³ç±»ä»¥åŠAPI

**Introspector** 

Introspector ç±»ä¼¼äº`BeanInfo`çš„é™æ€å·¥å‚ç±»ï¼Œä¸»è¦æ˜¯æä¾›é™æ€æ–¹æ³•é€šè¿‡`Class`å®ä¾‹è·å–åˆ°`BeanInfo`ï¼Œå¾—åˆ°`BeanInfo`ä¹‹åï¼Œå°±èƒ½å¤Ÿè·å–åˆ°å…¶ä»–æè¿°ç¬¦ã€‚ä¸»è¦æ–¹æ³•ï¼š

- `public static BeanInfo getBeanInfo(Class<?> beanClass)`ï¼šé€šè¿‡`Class`å®ä¾‹è·å–åˆ°`BeanInfo`å®ä¾‹ã€‚

**BeanInfo**

BeanInfo æ˜¯ä¸€ä¸ªæ¥å£ï¼Œå…·ä½“å®ç°æ˜¯ `GenericBeanInfo`ï¼Œé€šè¿‡è¿™ä¸ªæ¥å£å¯ä»¥è·å–ä¸€ä¸ªç±»çš„å„ç§ç±»å‹çš„æè¿°ç¬¦ã€‚ä¸»è¦æ–¹æ³•ï¼š

- `BeanDescriptor getBeanDescriptor()`ï¼šè·å–`JavaBean`æè¿°ç¬¦ã€‚
- `EventSetDescriptor[] getEventSetDescriptors()`ï¼šè·å–`JavaBean`çš„æ‰€æœ‰çš„ `EventSetDescriptor`ã€‚
- `PropertyDescriptor[] getPropertyDescriptors()`ï¼šè·å–`JavaBean`çš„æ‰€æœ‰çš„ `PropertyDescriptor`ã€‚
- `MethodDescriptor[] getMethodDescriptors()`ï¼šè·å–`JavaBean`çš„æ‰€æœ‰çš„ `MethodDescriptor`ã€‚

**PropertyDescriptor**

PropertyDescriptor ç±»è¡¨ç¤º`JavaBean`ç±»é€šè¿‡å­˜å‚¨å™¨ï¼ˆ`Setter`å’Œ`Getter`ï¼‰å¯¼å‡ºä¸€ä¸ªå±æ€§ï¼Œå®ƒåº”è¯¥æ˜¯å†…çœä½“ç³»ä¸­æœ€å¸¸è§çš„ç±»ã€‚ä¸»è¦æ–¹æ³•ï¼š

- `synchronized Class<?> getPropertyType()`ï¼šè·å¾—å±æ€§çš„`Class`å¯¹è±¡ã€‚
- `synchronized Method getReadMethod()`ï¼šè·å¾—ç”¨äºè¯»å–å±æ€§å€¼ï¼ˆ`Getter`ï¼‰çš„æ–¹æ³•ï¼›
- `synchronized Method getWriteMethod()`ï¼šè·å¾—ç”¨äºå†™å…¥å±æ€§å€¼ï¼ˆ`Setter`ï¼‰çš„æ–¹æ³•ã€‚
- `int hashCode()`ï¼šè·å–å¯¹è±¡çš„å“ˆå¸Œå€¼ã€‚
- `synchronized void setReadMethod(Method readMethod)`ï¼šè®¾ç½®ç”¨äºè¯»å–å±æ€§å€¼ï¼ˆ`Getter`ï¼‰çš„æ–¹æ³•ã€‚
- `synchronized void setWriteMethod(Method writeMethod)`ï¼šè®¾ç½®ç”¨äºå†™å…¥å±æ€§å€¼ï¼ˆ`Setter`ï¼‰çš„æ–¹æ³•

## å†…çœå®æˆ˜

:::tip

**æ³¨æ„ï¼šgetBeanInfo(Class beanClass, Class stopClass) æ–¹æ³•ç¬¬äºŒå‚æ•°è¡¨ç¤ºï¼Œä¸å†…çœ stopClass ç±»ï¼Œé€šå¸¸ä¼ å…¥ Object.class**

:::

```java
public static void main(String[] args) {
    try {
        // ç»™å®šå­—èŠ‚ç å¯¹è±¡è·å– beanInfo å¯¹è±¡
        BeanInfo beanInfo = Introspector.getBeanInfo(User.class, Object.class);

        // è·å– beanInfo å¯¹è±¡çš„ä¿¡æ¯
        PropertyDescriptor[] propertyDescriptors = beanInfo.getPropertyDescriptors();

        // å¾ªç¯éå†è¾“å‡º
        for (PropertyDescriptor pd : propertyDescriptors) {
            // è·å–å±æ€§ name
            System.out.println(pd.getName() + "=" + pd.getPropertyType());
            // è·å–å¯è¯»æ–¹æ³•
            Method readMethod = pd.getReadMethod();
            System.out.println(readMethod);

            Method writeMethod = pd.getWriteMethod();
            System.out.println(writeMethod);

            System.out.println("------------------------------");
        }

    } catch (IntrospectionException e) {
        e.printStackTrace();
    }
}
```

**è¾“å‡º**

```
age=int
public int cn.zenghr.advanced.domain.User.getAge()
public void cn.zenghr.advanced.domain.User.setAge(int)
------------------------------
name=class java.lang.String
public java.lang.String cn.zenghr.advanced.domain.User.getName()
public void cn.zenghr.advanced.domain.User.setName(java.lang.String)
```

## JavaBean to Map å®ç°

```java
/**
 * java to map äº’è½¬
 */
public class BeanUtil {
    private BeanUtil() {
    }

    /**
     * JavaBean å†…çœ è½¬ Map
     *
     * @param obj JavaBean
     * @return è¿”å› map
     */
    public static Map<Object, Object> bean2map(Object obj) {
        Map<Object, Object> map = new HashMap<>();

        try {
            // 1. è·å– beanInfo å¯¹è±¡
            BeanInfo beanInfo = Introspector.getBeanInfo(obj.getClass(), Object.class);

            // 2. è·å– beanInfo çš„å±æ€§
            PropertyDescriptor[] propertyDescriptors = beanInfo.getPropertyDescriptors();


            // 3. å¾ªç¯éå†è·å–å±æ€§ key-value
            for (PropertyDescriptor pd : propertyDescriptors) {
                String key = pd.getName();
                Object val = pd.getReadMethod().invoke(obj);

                // æ·»åŠ 
                map.put(key, val);
            }
        } catch (IntrospectionException e) {
            e.printStackTrace();
        } catch (IllegalAccessException e) {
            e.printStackTrace();
        } catch (InvocationTargetException e) {
            e.printStackTrace();
        }


        return map;
    }

    /**
     * é€šè¿‡åå°„è·å–å­—æ®µ è½¬åŒ– map
     * @param obj
     * @return
     */
    public static Map<Object, Object> bean2mapReflect(Object obj) {
        Map<Object, Object> map = new HashMap<>();

        try {
            Class clz = obj.getClass();

            Field[] fields = clz.getDeclaredFields();

            for (Field field : fields) {
                String key = field.getName();
                field.setAccessible(true);
                Object val = field.get(obj);
                field.setAccessible(false);

                map.put(key, val);
            }


        } catch (IllegalAccessException e) {
            e.printStackTrace();
        }


        return map;
    }


    /**
     * map to javabean æ³›å‹
     * @param map mapæ•°æ®
     * @param clz ç±»ç±»å‹
     * @param <T> æ³›å‹
     * @return è¿”å›æ³›å‹å¯¹è±¡
     */
    public static <T> T map2bean(Map<Object, Object> map, Class<T> clz) {
        try {
            // è·å– beanInfo ä¿¡æ¯
            BeanInfo beanInfo = Introspector.getBeanInfo(clz, Object.class);
            // è·å– bean çš„å±æ€§
            PropertyDescriptor[] propertyDescriptors = beanInfo.getPropertyDescriptors();
            // ç”Ÿæˆ æ³›å‹å®ä¾‹
            T t = clz.newInstance();

            for (PropertyDescriptor pd : propertyDescriptors) {
                String key = pd.getName();
                Object val = map.get(key);

                pd.getWriteMethod().invoke(t, val);
            }

            return t;
        } catch (IntrospectionException e) {
            e.printStackTrace();
        } catch (IllegalAccessException e) {
            e.printStackTrace();
        } catch (InstantiationException e) {
            e.printStackTrace();
        } catch (InvocationTargetException e) {
            e.printStackTrace();
        }


        return null;
    }
}
```

