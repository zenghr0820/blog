---
title: "Elasticsearch-å®‰è£…ä¸­æ–‡åˆ†è¯å™¨"
date: "2021-08-16 16:00"
permalink: "2021-08-16-elasticsearch-ik"
---

# Elasticsearch ä¸­æ–‡åˆ†è¯å™¨

Elasticsearch è‡ªå¸¦äº†ä¸€å †çš„åˆ†è¯å™¨ï¼Œæ¯”å¦‚`Standard Analyzer`ã€`Simple Analyzer`ã€`whitespace Analyzer`ç­‰åˆ†è¯å™¨ï¼Œä½†æ˜¯éƒ½å¯¹ä¸­æ–‡åˆ†è¯çš„æ•ˆæœä¸å¤ªå¥½ï¼Œæ­¤å¤„å®‰è£…ç¬¬ä¸‰æ–¹åˆ†è¯å™¨`ik`ï¼Œæ¥å®ç°åˆ†è¯

## Elasticsearch å†…ç½®åˆ†è¯å™¨

- **Standard Analyzer** - é»˜è®¤åˆ†è¯å™¨ï¼ŒæŒ‰è¯åˆ‡åˆ†ï¼Œå°å†™å¤„ç†
- **Simple Analyzer** - æŒ‰ç…§éå­—æ¯åˆ‡åˆ†(ç¬¦å·è¢«è¿‡æ»¤), å°å†™å¤„ç†
- **Whitespace Analyzer** - æŒ‰ç…§ç©ºæ ¼åˆ‡åˆ†ï¼Œä¸è½¬å°å†™
- Stop Analyzer - å°å†™å¤„ç†ï¼Œåœç”¨è¯è¿‡æ»¤(the,a,is)
- Keyword Analyzer - ä¸åˆ†è¯ï¼Œç›´æ¥å°†è¾“å…¥å½“ä½œè¾“å‡º
- Patter Analyzer - æ­£åˆ™è¡¨è¾¾å¼ï¼Œé»˜è®¤\W+(éå­—ç¬¦åˆ†å‰²)
- Language - æä¾›äº†30å¤šç§å¸¸è§è¯­è¨€çš„åˆ†è¯å™¨
- Customer Analyzer è‡ªå®šä¹‰åˆ†è¯å™¨

## å®‰è£… ik åˆ†è¯å™¨

å¼€æºåˆ†è¯å™¨ `Ik` çš„githubï¼š[https://github.com/medcl/elasticsearch-analysis-ik](https://github.com/medcl/elasticsearch-analysis-ik)

> **æ³¨æ„ï¼š** Ik åˆ†è¯å™¨çš„ç‰ˆæœ¬è¦å’Œä½ å®‰è£…çš„ Elasticsearch ç‰ˆæœ¬ä¸€è‡´ï¼Œæˆ‘ä½¿ç”¨çš„ç‰ˆæœ¬æ˜¯ *7.14.0*

åœ¨ github ä¸Šæ‰¾åˆ°å¯¹åº”çš„ç‰ˆæœ¬ï¼Œä½¿ç”¨ Elasticsearch è‡ªå¸¦çš„æ’ä»¶ç®¡ç† **`elasticsearch-plugin`** æ¥è¿›è¡Œå®‰è£…

- ç›´æ¥ä»ç½‘ç»œåœ°å€å®‰è£…

  ```bash
  ./bin/elasticsearch-plugin install https://github.com/medcl/elasticsearch-analysis-ik/releases/download/v7.14.0/elasticsearch-analysis-ik-7.14.0.zip
  # æŸ¥çœ‹æ˜¯å¦å®‰è£…å®Œæˆ
  ./bin/elasticsearch-plugin list
  ```

- ä»æœ¬åœ°å®‰è£…

  ```bash
  # ä¸‹è½½æ’ä»¶(fileåé¢è·Ÿçš„æ˜¯æ’ä»¶åœ¨æœ¬åœ°çš„åœ°å€)
  ./bin/elasticsearch-plugin install file:///xxxx/elasticsearch-analysis-ik-7.14.0.zip
  ```

> æ³¨æ„ï¼šå¦‚æœæœ¬åœ°æ’ä»¶çš„è·¯å¾„ä¸­å­˜åœ¨ç©ºæ ¼ï¼Œéœ€è¦ä½¿ç”¨åŒå¼•å·åŒ…è£…èµ·æ¥

å®‰è£…å®Œæ’ä»¶åéœ€é‡å¯Esï¼Œæ‰èƒ½ç”Ÿæ•ˆ

## IK åˆ†è¯ä½¿ç”¨

IK æœ‰ä¸¤ç§é¢—ç²’åº¦çš„æ‹†åˆ†ï¼š

- **`ik_smart`** : ä¼šåšæœ€ç²—ç²’åº¦çš„æ‹†åˆ†

- **`ik_max_word`** : ä¼šå°†æ–‡æœ¬åšæœ€ç»†ç²’åº¦çš„æ‹†åˆ†

### é»˜è®¤åˆ†è¯æ‹†åˆ†

```sh
GET _analyze
{
  "analyzer": "default",
  "text": "æˆ‘æ˜¯ä¸­å›½äºº"
}
```

æ‰§è¡Œç»“æœå¦‚ä¸‹ğŸ‘‡

![QKrpA8](https://media.zenghr.cn/blog/img/20210818/QKrpA8.png)

### ik_smart åˆ†è¯

```sh
GET _analyze
{
  "analyzer": "ik_smart",
  "text": "æˆ‘æ˜¯ä¸­å›½äºº"
}
```

æ‰§è¡Œç»“æœå¦‚ä¸‹ğŸ‘‡

```json
{
  "tokens" : [
    {
      "token" : "æˆ‘",
      "start_offset" : 0,
      "end_offset" : 1,
      "type" : "CN_CHAR",
      "position" : 0
    },
    {
      "token" : "æ˜¯",
      "start_offset" : 1,
      "end_offset" : 2,
      "type" : "CN_CHAR",
      "position" : 1
    },
    {
      "token" : "ä¸­å›½äºº",
      "start_offset" : 2,
      "end_offset" : 5,
      "type" : "CN_WORD",
      "position" : 2
    }
  ]
}
```

### ik_max_word åˆ†è¯

```sh
GET _analyze
{
  "analyzer": "ik_max_word",
  "text": "æˆ‘æ˜¯ä¸­å›½äºº"
}
```

æ‰§è¡Œç»“æœå¦‚ä¸‹ğŸ‘‡

```json
{
  "tokens" : [
    {
      "token" : "æˆ‘",
      "start_offset" : 0,
      "end_offset" : 1,
      "type" : "CN_CHAR",
      "position" : 0
    },
    {
      "token" : "æ˜¯",
      "start_offset" : 1,
      "end_offset" : 2,
      "type" : "CN_CHAR",
      "position" : 1
    },
    {
      "token" : "ä¸­å›½äºº",
      "start_offset" : 2,
      "end_offset" : 5,
      "type" : "CN_WORD",
      "position" : 2
    },
    {
      "token" : "ä¸­å›½",
      "start_offset" : 2,
      "end_offset" : 4,
      "type" : "CN_WORD",
      "position" : 3
    },
    {
      "token" : "å›½äºº",
      "start_offset" : 3,
      "end_offset" : 5,
      "type" : "CN_WORD",
      "position" : 4
    }
  ]
}
```

:::tip

èƒ½å¤Ÿçœ‹å‡ºä¸åŒçš„åˆ†è¯å™¨ï¼Œåˆ†è¯æœ‰æ˜æ˜¾çš„åŒºåˆ«ï¼Œæ‰€ä»¥ä»¥åå®šä¹‰ä¸€ä¸ªç´¢å¼•ä¸èƒ½å†ä½¿ç”¨é»˜è®¤çš„ **`mapping`** äº†ï¼Œè¦æ‰‹å·¥å»ºç«‹ mappingï¼Œå› ä¸ºè¦é€‰æ‹©åˆ†è¯å™¨

:::

