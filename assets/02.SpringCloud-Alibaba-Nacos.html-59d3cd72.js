import{_ as l,E as o,Y as c,Z as p,$ as n,a2 as a,a1 as s,a3 as r,a0 as t}from"./framework-e52b59a9.js";const d={},u=n("h1",{id:"springcloud-alibaba-nacos",tabindex:"-1"},[n("a",{class:"header-anchor",href:"#springcloud-alibaba-nacos","aria-hidden":"true"},"#"),a(" SpringCloud Alibaba Nacos")],-1),g=n("p",null,[n("strong",null,"Nacos"),a(" 是阿里巴巴开源的一个更易于构建云原生应用的动态服务发现、配置管理和服务管理 平台")],-1),h=n("p",null,[n("strong",null,"参考文档如下👇")],-1),k={href:"https://nacos.io/zh-cn/docs/what-is-nacos.html",target:"_blank",rel:"noopener noreferrer"},b={href:"https://nacos.io/zh-cn/docs/quick-start-spring-cloud.html",target:"_blank",rel:"noopener noreferrer"},m=n("h2",{id:"nacos-搭建",tabindex:"-1"},[n("a",{class:"header-anchor",href:"#nacos-搭建","aria-hidden":"true"},"#"),a(" Nacos 搭建")],-1),v={href:"https://github.com/alibaba/nacos/releases",target:"_blank",rel:"noopener noreferrer"},f={href:"https://github.com/alibaba/spring-cloud-alibaba/wiki/%E7%89%88%E6%9C%AC%E8%AF%B4%E6%98%8E",target:"_blank",rel:"noopener noreferrer"},_=n("h3",{id:"获取-nacos",tabindex:"-1"},[n("a",{class:"header-anchor",href:"#获取-nacos","aria-hidden":"true"},"#"),a(" 获取 Nacos")],-1),x={href:"https://github.com/alibaba/nacos/releases",target:"_blank",rel:"noopener noreferrer"},y={href:"https://nacos.io/zh-cn/docs/quick-start.html",target:"_blank",rel:"noopener noreferrer"},N=t(`<h3 id="启动、关闭服务" tabindex="-1"><a class="header-anchor" href="#启动、关闭服务" aria-hidden="true">#</a> 启动、关闭服务</h3><p><strong>Linux/Unix/Mac</strong></p><div class="language-bash line-numbers-mode" data-ext="sh"><pre class="language-bash"><code><span class="token comment"># Linux/Unix/Mac</span>
<span class="token comment"># 启动命令(standalone代表着单机模式运行，非集群模式):</span>
<span class="token function">sh</span> startup.sh <span class="token parameter variable">-m</span> standalone
<span class="token function">sh</span> shutdown.sh
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p><strong>Window</strong></p><div class="language-bash line-numbers-mode" data-ext="sh"><pre class="language-bash"><code><span class="token comment"># 启动命令(standalone代表着单机模式运行，非集群模式):</span>
startup.cmd <span class="token parameter variable">-m</span> standalone
shutdown.cmd
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h3 id="访问-nacos-后台界面" tabindex="-1"><a class="header-anchor" href="#访问-nacos-后台界面" aria-hidden="true">#</a> 访问 Nacos 后台界面</h3>`,6),E={href:"http://127.0.0.1:8848/nacos",target:"_blank",rel:"noopener noreferrer"},C=n("strong",null,[n("code",null,"nacos")],-1),w=t('<figure><img src="https://media.zenghr.cn/blog/img/20210727/XOjON2.png" alt="XOjON2" tabindex="0" loading="lazy"><figcaption>XOjON2</figcaption></figure><figure><img src="https://media.zenghr.cn/blog/img/20210727/ZoWv68.png" alt="ZoWv68" tabindex="0" loading="lazy"><figcaption>ZoWv68</figcaption></figure><h2 id="环境说明" tabindex="-1"><a class="header-anchor" href="#环境说明" aria-hidden="true">#</a> 环境说明</h2><div class="hint-container tip"><p class="hint-container-title">提示</p><p><strong>Spring Cloud：</strong> 2020.0.3</p><p><strong>Nacos：</strong> 14.2</p><p><strong>spring-cloud-alibaba：</strong> 2021.1</p></div>',4),q={href:"https://github.com/spring-cloud-incubator/spring-cloud-alibaba/wiki/Nacos-config",target:"_blank",rel:"noopener noreferrer"},S={href:"https://github.com/spring-cloud-incubator/spring-cloud-alibaba/wiki/Nacos-discovery",target:"_blank",rel:"noopener noreferrer"},z=t('<ul><li>通过 Nacos Server 和 spring-cloud-starter-alibaba-nacos-config 实现配置的动态变更。</li><li>通过 Nacos Server 和 spring-cloud-starter-alibaba-nacos-discovery 实现服务的注册与发现。</li></ul><h2 id="服务发现是什么" tabindex="-1"><a class="header-anchor" href="#服务发现是什么" aria-hidden="true">#</a> 服务发现是什么</h2><h3 id="服务提供者与服务消费者" tabindex="-1"><a class="header-anchor" href="#服务提供者与服务消费者" aria-hidden="true">#</a> 服务提供者与服务消费者</h3><ul><li>服务提供者：服务的被调用方（即：为其他微服务提供接口的微服务）</li><li>服务消费者：服务的调用方（即：调用其他微服务接口的微服务）</li></ul><h3 id="服务发现原理" tabindex="-1"><a class="header-anchor" href="#服务发现原理" aria-hidden="true">#</a> 服务发现原理</h3><ul><li>服务发现机制就是通过一个中间件去记录服务提供者的ip地址，服务名以及心跳等数据（比如用mysql去存储这些信息），然后服务消费者会去这个中间平台去查询相关信息，然后再去访问对应的地址，这就是服务注册和服务发现。</li><li>当用户地址发生了变化也没有影响，因为服务提供方修改了用户地址，在中间件中会被更新，当服务消费方去访问中间件时就能及时获取最新的用户地址，就不会出现用户地址发生变化导致服务找不到</li></ul><h2 id="启动服务发现" tabindex="-1"><a class="header-anchor" href="#启动服务发现" aria-hidden="true">#</a> 启动服务发现</h2><p>我们通过 spring-cloud-starter-alibaba-nacos-discovery 来实现服务注册和发现</p>',8),I={class:"hint-container warning"},A=n("p",{class:"hint-container-title"},"注意",-1),j=n("strong",null,"bootstrap.yml",-1),B=t(`<h3 id="添加依赖" tabindex="-1"><a class="header-anchor" href="#添加依赖" aria-hidden="true">#</a> 添加依赖</h3><div class="language-xml line-numbers-mode" data-ext="xml"><pre class="language-xml"><code><span class="token comment">&lt;!-- nacos 服务发现 --&gt;</span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>dependency</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>groupId</span><span class="token punctuation">&gt;</span></span>com.alibaba.cloud<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>groupId</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>artifactId</span><span class="token punctuation">&gt;</span></span>spring-cloud-starter-alibaba-nacos-discovery<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>artifactId</span><span class="token punctuation">&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>dependency</span><span class="token punctuation">&gt;</span></span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div>`,2),L={href:"https://github.com/spring-cloud-incubator/spring-cloud-alibaba/wiki/%E7%89%88%E6%9C%AC%E8%AF%B4%E6%98%8E",target:"_blank",rel:"noopener noreferrer"},R=t(`<h3 id="添加配置" tabindex="-1"><a class="header-anchor" href="#添加配置" aria-hidden="true">#</a> 添加配置</h3><p>通过 Nacos 的服务注册发现功能将其服务注册到 Nacos server 上</p><p><strong>在 <code>bootstrap.yml</code> 中配置 Nacos server 的地址</strong></p><div class="language-yaml line-numbers-mode" data-ext="yml"><pre class="language-yaml"><code><span class="token key atrule">spring</span><span class="token punctuation">:</span>
  <span class="token key atrule">cloud</span><span class="token punctuation">:</span>
    <span class="token key atrule">nacos</span><span class="token punctuation">:</span>
      <span class="token key atrule">discovery</span><span class="token punctuation">:</span>
        <span class="token key atrule">server-addr</span><span class="token punctuation">:</span> 127.0.0.1<span class="token punctuation">:</span><span class="token number">8848</span>
  <span class="token key atrule">application</span><span class="token punctuation">:</span>
    <span class="token key atrule">name</span><span class="token punctuation">:</span> mall<span class="token punctuation">-</span>order
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div>`,4),$={href:"http://application.name",target:"_blank",rel:"noopener noreferrer"},D={href:"http://spring.application.name",target:"_blank",rel:"noopener noreferrer"},O=t(`<h3 id="添加注解" tabindex="-1"><a class="header-anchor" href="#添加注解" aria-hidden="true">#</a> 添加注解</h3><p><strong>早期在启动类上需要加上 @EnableDiscoveryClient注解，现在已经可以不需要加了</strong></p><figure><img src="https://media.zenghr.cn/blog/img/20210727/Hpj6v9.png" alt="Hpj6v9" tabindex="0" loading="lazy"><figcaption>Hpj6v9</figcaption></figure><h2 id="启动配置管理" tabindex="-1"><a class="header-anchor" href="#启动配置管理" aria-hidden="true">#</a> 启动配置管理</h2><p>我们通过 Nacos Server 和 <strong>spring-cloud-starter-alibaba-nacos-config</strong> 实现配置的动态变更</p><h3 id="添加依赖-1" tabindex="-1"><a class="header-anchor" href="#添加依赖-1" aria-hidden="true">#</a> 添加依赖</h3><div class="language-xml line-numbers-mode" data-ext="xml"><pre class="language-xml"><code><span class="token comment">&lt;!-- nacos 配置中心 --&gt;</span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>dependency</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>groupId</span><span class="token punctuation">&gt;</span></span>com.alibaba.cloud<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>groupId</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>artifactId</span><span class="token punctuation">&gt;</span></span>spring-cloud-starter-alibaba-nacos-config<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>artifactId</span><span class="token punctuation">&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>dependency</span><span class="token punctuation">&gt;</span></span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div>`,7),W={href:"https://github.com/spring-cloud-incubator/spring-cloud-alibaba/wiki/%E7%89%88%E6%9C%AC%E8%AF%B4%E6%98%8E",target:"_blank",rel:"noopener noreferrer"},G=t(`<h3 id="添加配置-1" tabindex="-1"><a class="header-anchor" href="#添加配置-1" aria-hidden="true">#</a> 添加配置</h3><p><strong>在 <code>bootstrap.properties</code> 中配置 Nacos server 的地址和应用名</strong></p><div class="language-yaml line-numbers-mode" data-ext="yml"><pre class="language-yaml"><code><span class="token key atrule">spring</span><span class="token punctuation">:</span>
  <span class="token key atrule">cloud</span><span class="token punctuation">:</span>
    <span class="token key atrule">nacos</span><span class="token punctuation">:</span>
      <span class="token key atrule">discovery</span><span class="token punctuation">:</span>
        <span class="token key atrule">server-addr</span><span class="token punctuation">:</span> 127.0.0.1<span class="token punctuation">:</span><span class="token number">8848</span>
      <span class="token key atrule">config</span><span class="token punctuation">:</span>
        <span class="token key atrule">server-addr</span><span class="token punctuation">:</span> 127.0.0.1<span class="token punctuation">:</span><span class="token number">8848</span>
        <span class="token key atrule">file-extension</span><span class="token punctuation">:</span> yaml
  <span class="token key atrule">application</span><span class="token punctuation">:</span>
    <span class="token key atrule">name</span><span class="token punctuation">:</span> mall<span class="token punctuation">-</span>order
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><div class="hint-container tip"><p class="hint-container-title">提示</p><p>说明：之所以需要配置 <code>spring.application.name</code> ，是因为它是构成 Nacos 配置管理 <code>dataId</code>字段的一部分</p><p><strong>dataId = \${prefix}-\${spring.profiles.active}.\${file-extension}</strong></p></div>`,4),T=n("li",null,[n("strong",null,"prefix："),a(" 默认为 "),n("code",null,"spring.application.name"),a(" 的值，也可以通过配置项 "),n("code",null,"spring.cloud.nacos.config.prefix"),a("来配置。")],-1),F=n("strong",null,"spring.profiles.active：",-1),M={href:"https://docs.spring.io/spring-boot/docs/current/reference/html/boot-features-profiles.html#boot-features-profiles",target:"_blank",rel:"noopener noreferrer"},V=n("strong",null,[a("注意：当 spring.profiles.active 为空时，对应的连接符 "),n("code",null,"-"),a(" 也将不存在，dataId 的拼接格式变成 "),n("code",null,"${prefix}.${file-extension}")],-1),P=n("li",null,[n("strong",null,"file-exetension："),a(" 为配置内容的数据格式，可以通过配置项 "),n("code",null,"spring.cloud.nacos.config.file-extension"),a(" 来配置。目前只支持 "),n("code",null,"properties"),a(" 和 "),n("code",null,"yaml"),a(" 类型。")],-1),U=t(`<blockquote><p>即，采用上述配置，<code>nacosconfig</code> 会从 Nacos Server 读取 Data Id 为 <code>nacosconfig.yaml</code> 的配置。</p></blockquote><h3 id="nacos-控制台添加配置文件" tabindex="-1"><a class="header-anchor" href="#nacos-控制台添加配置文件" aria-hidden="true">#</a> Nacos 控制台添加配置文件</h3><p>在 Nacos 控制台添加一个新的配置，其中：</p><ul><li>Data Id：<code>nacosconfig</code></li><li>Group：<code>DEFAULT_GROUP</code></li><li>配置格式：<code>YAML</code></li></ul><figure><img src="https://media.zenghr.cn/blog/img/20210727/JnlTaf.png" alt="JnlTaf" tabindex="0" loading="lazy"><figcaption>JnlTaf</figcaption></figure><figure><img src="https://media.zenghr.cn/blog/img/20210727/hlPcGj.png" alt="hlPcGj" tabindex="0" loading="lazy"><figcaption>hlPcGj</figcaption></figure><h3 id="读取-nacos-变量配置" tabindex="-1"><a class="header-anchor" href="#读取-nacos-变量配置" aria-hidden="true">#</a> 读取 Nacos 变量配置</h3><div class="language-java line-numbers-mode" data-ext="java"><pre class="language-java"><code><span class="token annotation punctuation">@RefreshScope</span>
<span class="token annotation punctuation">@RestController</span>
<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">ConfigController</span> <span class="token punctuation">{</span>
    <span class="token keyword">private</span> <span class="token keyword">static</span> <span class="token keyword">final</span> <span class="token class-name">Logger</span> logger <span class="token operator">=</span> <span class="token class-name">LoggerFactory</span><span class="token punctuation">.</span><span class="token function">getLogger</span><span class="token punctuation">(</span><span class="token class-name">ConfigController</span><span class="token punctuation">.</span><span class="token keyword">class</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

    <span class="token annotation punctuation">@Value</span><span class="token punctuation">(</span><span class="token string">&quot;\${order.name:test}&quot;</span><span class="token punctuation">)</span>
    <span class="token keyword">private</span> <span class="token class-name">String</span> name<span class="token punctuation">;</span>

    <span class="token annotation punctuation">@RequestMapping</span><span class="token punctuation">(</span>value <span class="token operator">=</span> <span class="token string">&quot;/config&quot;</span><span class="token punctuation">,</span> method <span class="token operator">=</span> <span class="token class-name">RequestMethod</span><span class="token punctuation">.</span><span class="token constant">GET</span><span class="token punctuation">)</span>
    <span class="token keyword">public</span> <span class="token class-name">String</span> <span class="token function">index</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        logger<span class="token punctuation">.</span><span class="token function">info</span><span class="token punctuation">(</span><span class="token string">&quot;get order config value from nacos: {}&quot;</span><span class="token punctuation">,</span> name<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">return</span> name<span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><ul><li><strong>RefreshScope：</strong> 实现配置自动更新，在 nacos 中修改了配置，会动态更新数据</li></ul>`,9);function Z(H,J){const e=o("ExternalLinkIcon"),i=o("RouterLink");return c(),p("div",null,[u,g,h,n("blockquote",null,[n("p",null,[a("Nacos 官网文档地址："),n("a",k,[a("https://nacos.io/zh-cn/docs/what-is-nacos.html"),s(e)])]),n("p",null,[a("Nacos Spring Cloud 快速开始："),n("a",b,[a("https://nacos.io/zh-cn/docs/quick-start-spring-cloud.html"),s(e)])])]),m,n("p",null,[a("根据 Nacos 官网的版本选择描述中，可以根据 "),n("a",v,[a("releases"),s(e)]),a(" 中找到每个版本的介绍，Spring Cloud 版本对应关系可以查看 "),n("a",f,[a("版本说明Wiki"),s(e)])]),_,n("ul",null,[n("li",null,[a("下载地址："),n("a",x,[a("https://github.com/alibaba/nacos/releases"),s(e)])]),n("li",null,[a("搭建文档："),n("a",y,[a("https://nacos.io/zh-cn/docs/quick-start.html"),s(e)])])]),N,n("p",null,[a("当我们的 Nacos 运行起来时，我们可以访问 "),n("a",E,[a("http://127.0.0.1:8848/nacos"),s(e)]),a(" 地址，输入账号密码："),C,a(" 登录系统")]),w,n("p",null,[a("关于 Nacos Spring Cloud 的详细文档请参看："),n("a",q,[a("Nacos Config"),s(e)]),a(" 和 "),n("a",S,[a("Nacos Discovery"),s(e)]),a("。")]),z,n("div",I,[A,n("p",null,[a("注意：如果你的 Spring Cloud 版本是 2020，那么 配置文件 "),j,a(" 将会不起作用，会导致 nacos 的配置管理、服务发现等配置失效，需要添加依赖，详细方案请看 "),s(i,{to:"/passages/2021-07-27-spring-cloud-error.html#spring-cloud-2020-bootstrap-%E9%85%8D%E7%BD%AE%E6%96%87%E4%BB%B6%E5%A4%B1%E6%95%88"},{default:r(()=>[a("Spring Cloud 趟坑记录")]),_:1})])]),B,n("blockquote",null,[n("p",null,[a("更多版本对应关系参考："),n("a",L,[a("版本说明 Wiki"),s(e)])])]),R,n("blockquote",null,[n("p",null,[a("注意：需要配置 "),n("a",$,[a("application.name"),s(e)]),a(" 属性，因为 Nacos 注册服务默认取 "),n("strong",null,[a("${"),n("a",D,[a("spring.application.name"),s(e)]),a("}")]),a(" 的值")])]),O,n("blockquote",null,[n("p",null,[a("更多版本对应关系参考："),n("a",W,[a("版本说明 Wiki"),s(e)])])]),G,n("ul",null,[T,n("li",null,[F,a(" 即为当前环境对应的 profile，详情可以参考 "),n("a",M,[a("Spring Boot文档"),s(e)]),a("。 "),V]),P]),U])}const Y=l(d,[["render",Z],["__file","02.SpringCloud-Alibaba-Nacos.html.vue"]]);export{Y as default};
