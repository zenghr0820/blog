import{_ as i}from"./plugin-vue_export-helper-c27b6911.js";import{r as l,o as r,c as p,d as s,e as a,b as n,w as c,a as e}from"./app-1b7382bc.js";const d={},u=e(`<h1 id="docker下安装并配置mysql" tabindex="-1"><a class="header-anchor" href="#docker下安装并配置mysql" aria-hidden="true">#</a> docker下安装并配置mysql</h1><p>Mysql 数据库是市面上最受欢迎的数据库，也是使用最多的一种数据库，所以开发者经常需要安装 Mysql 数据库环境，安装 Mysql 的方式有很多，Window、Linux 等系统可以下载 对应的安装文件安装，但是这些安装方式通常比较麻烦，也很容易出现安装错误。</p><p>那么可以选用 docker 来快速构建环境，容器比虚拟机更加轻量化，拥有诸多好处</p><div class="hint-container tip"><p class="hint-container-title">提示</p><p>记录一下 docker 配置 mysql 环境的步骤</p></div><h2 id="拉取-mysql-镜像" tabindex="-1"><a class="header-anchor" href="#拉取-mysql-镜像" aria-hidden="true">#</a> 拉取 Mysql 镜像</h2><blockquote><p>docker 环境的搭建请查看其它文章</p></blockquote><div class="language-bash line-numbers-mode" data-ext="sh"><pre class="language-bash"><code><span class="token function">docker</span> search mysql
<span class="token function">docker</span> pull mysql
<span class="token comment"># 拉取指定版本</span>
<span class="token function">docker</span> pull mysql:5.7
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div>`,7),m={href:"https://hub.docker.com/_/mysql",target:"_blank",rel:"noopener noreferrer"},v=e(`<figure><img src="https://media.zenghr.cn/blog/img/20210628/pSxDir.png" alt="pSxDir" tabindex="0" loading="lazy"><figcaption>pSxDir</figcaption></figure><h2 id="启动-mysql-容器" tabindex="-1"><a class="header-anchor" href="#启动-mysql-容器" aria-hidden="true">#</a> 启动 Mysql 容器</h2><div class="language-bash line-numbers-mode" data-ext="sh"><pre class="language-bash"><code><span class="token function">docker</span> run <span class="token parameter variable">--name</span> mysql <span class="token punctuation">\\</span>
<span class="token parameter variable">--privileged</span><span class="token operator">=</span>true <span class="token punctuation">\\</span>
<span class="token parameter variable">-p</span> <span class="token number">3306</span>:3306 <span class="token punctuation">\\</span>
<span class="token parameter variable">-v</span> /database/mysql/conf:/etc/mysql/conf.d <span class="token punctuation">\\</span>
<span class="token parameter variable">-v</span> /database/mysql/logs:/logs <span class="token punctuation">\\</span>
<span class="token parameter variable">-v</span> /database/mysql/data:/var/lib/mysql <span class="token punctuation">\\</span>
<span class="token parameter variable">-e</span> <span class="token assign-left variable">MYSQL_ROOT_PASSWORD</span><span class="token operator">=</span><span class="token number">123456</span> <span class="token punctuation">\\</span>
<span class="token parameter variable">-d</span> mysql:5.7
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><ul><li>-privileged：加入 -privileged=true 给容器加上特定权限，因为Centos7安全Selinux禁止了一些安全权限</li><li>-name：指定容器名称，必须是唯一</li><li>-p：将容器的 3306 端口映射到主机的 3306 端口。</li><li>-v：将主机的目录挂载到容器的目录</li><li>-e：初始化 root 用户的密码（<em>注意如果没有初始化密码启动容器会失败</em>）</li><li>-d：容器后台运行</li></ul><div class="language-text line-numbers-mode" data-ext="text"><pre class="language-text"><code>-v /database/mysql/conf:/etc/mysql/conf.d 挂载mysql配置文件
-v /database/mysql/logs:/logs 挂载日志文件
-v /database/mysql/data:/var/lib/mysql 挂载mysql数据, 否则容器重启之后数据会丢失
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h2 id="查看容器是否启动" tabindex="-1"><a class="header-anchor" href="#查看容器是否启动" aria-hidden="true">#</a> 查看容器是否启动</h2><div class="language-bash line-numbers-mode" data-ext="sh"><pre class="language-bash"><code><span class="token function">docker</span> <span class="token function">ps</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div></div></div><p>如果发现容器未能正常启动成功，则需要查看日志排查异常：<strong><code>docker logs mysql</code></strong></p><h2 id="mysql-相关设置" tabindex="-1"><a class="header-anchor" href="#mysql-相关设置" aria-hidden="true">#</a> Mysql 相关设置</h2><h3 id="_1-进入-mysql-容器" tabindex="-1"><a class="header-anchor" href="#_1-进入-mysql-容器" aria-hidden="true">#</a> 1. 进入 mysql 容器</h3><div class="language-bash line-numbers-mode" data-ext="sh"><pre class="language-bash"><code><span class="token function">docker</span> <span class="token builtin class-name">exec</span> <span class="token parameter variable">-it</span> mysql /bin/bash
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div></div></div><figure><img src="https://media.zenghr.cn/blog/img/20210628/ajeCjb.png" alt="ajeCjb" tabindex="0" loading="lazy"><figcaption>ajeCjb</figcaption></figure><h3 id="_2-连接-mysql" tabindex="-1"><a class="header-anchor" href="#_2-连接-mysql" aria-hidden="true">#</a> 2. 连接 mysql</h3><div class="language-bash line-numbers-mode" data-ext="sh"><pre class="language-bash"><code>mysql <span class="token parameter variable">-u</span> root <span class="token parameter variable">-p</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div></div></div><p>输入启动容器时指定的密码</p><figure><img src="https://media.zenghr.cn/blog/img/20210628/Hsrhxe.png" alt="Hsrhxe" tabindex="0" loading="lazy"><figcaption>Hsrhxe</figcaption></figure><h3 id="_3-查询-user-表" tabindex="-1"><a class="header-anchor" href="#_3-查询-user-表" aria-hidden="true">#</a> 3. 查询 user 表</h3><div class="language-sql line-numbers-mode" data-ext="sql"><pre class="language-sql"><code>mysql<span class="token operator">&gt;</span> <span class="token keyword">select</span> host<span class="token punctuation">,</span><span class="token keyword">user</span><span class="token punctuation">,</span>plugin<span class="token punctuation">,</span>authentication_string <span class="token keyword">from</span> mysql<span class="token punctuation">.</span><span class="token keyword">user</span><span class="token punctuation">;</span>
<span class="token operator">+</span><span class="token comment">-------------+---------------+-----------------------+-------------------------------------------+</span>
<span class="token operator">|</span> host        <span class="token operator">|</span> <span class="token keyword">user</span>          <span class="token operator">|</span> plugin                <span class="token operator">|</span> authentication_string                     <span class="token operator">|</span>
<span class="token operator">+</span><span class="token comment">-------------+---------------+-----------------------+-------------------------------------------+</span>
<span class="token operator">|</span> localhost   <span class="token operator">|</span> root          <span class="token operator">|</span> mysql_native_password <span class="token operator">|</span> <span class="token operator">*</span><span class="token number">39</span>EF1E4F4220858A4F0D30FE91AAD7E4C4AB0812 <span class="token operator">|</span>
<span class="token operator">|</span> localhost   <span class="token operator">|</span> mysql<span class="token punctuation">.</span><span class="token keyword">session</span> <span class="token operator">|</span> mysql_native_password <span class="token operator">|</span> <span class="token operator">*</span>THISISNOTAVALIDPASSWORDTHATCANBEUSEDHERE <span class="token operator">|</span>
<span class="token operator">|</span> localhost   <span class="token operator">|</span> mysql<span class="token punctuation">.</span>sys     <span class="token operator">|</span> mysql_native_password <span class="token operator">|</span> <span class="token operator">*</span>THISISNOTAVALIDPASSWORDTHATCANBEUSEDHERE <span class="token operator">|</span>
<span class="token operator">+</span><span class="token comment">-------------+---------------+-----------------------+-------------------------------------------+</span>
<span class="token number">4</span> <span class="token keyword">rows</span> <span class="token operator">in</span> <span class="token keyword">set</span> <span class="token punctuation">(</span><span class="token number">0.00</span> sec<span class="token punctuation">)</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><ul><li>host：localhost表示本机使用，也可以指定IP访问，为 % 表示不限制ip。</li><li>如果这里plugin非mysql_native_password 则需要修改密码</li></ul><h3 id="_4-修改-root-账号" tabindex="-1"><a class="header-anchor" href="#_4-修改-root-账号" aria-hidden="true">#</a> 4. 修改 root 账号</h3><ul><li>修改root账号host</li></ul><div class="language-sql line-numbers-mode" data-ext="sql"><pre class="language-sql"><code><span class="token keyword">update</span> <span class="token keyword">user</span> <span class="token keyword">set</span> host <span class="token operator">=</span> <span class="token string">&quot;%&quot;</span> <span class="token keyword">where</span> <span class="token keyword">user</span> <span class="token operator">=</span> <span class="token string">&quot;root&quot;</span> <span class="token operator">and</span> host <span class="token operator">=</span> <span class="token string">&quot;localhost&quot;</span>；
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div></div></div><ul><li>修改root账号密码</li></ul><div class="language-sql line-numbers-mode" data-ext="sql"><pre class="language-sql"><code><span class="token keyword">update</span> <span class="token keyword">user</span> <span class="token keyword">set</span> password<span class="token operator">=</span>password<span class="token punctuation">(</span><span class="token string">&#39;admin&#39;</span><span class="token punctuation">)</span> <span class="token keyword">where</span> <span class="token keyword">user</span><span class="token operator">=</span><span class="token string">&#39;root&#39;</span><span class="token punctuation">;</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div></div></div>`,24),k={class:"hint-container tip"},b=s("p",{class:"hint-container-title"},"提示",-1),h={href:"https://dev.mysql.com/doc/relnotes/mysql/5.7/en/news-5-7-6.html",target:"_blank",rel:"noopener noreferrer"},g=e(`<ul><li>换种方式修改</li></ul><div class="language-sql line-numbers-mode" data-ext="sql"><pre class="language-sql"><code><span class="token keyword">alter</span> <span class="token keyword">user</span> <span class="token string">&#39;root&#39;</span><span class="token variable">@&#39;%&#39;</span> identified <span class="token keyword">by</span> <span class="token string">&#39;admin&#39;</span><span class="token punctuation">;</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div></div></div><ul><li>刷新权限</li></ul><div class="language-sql line-numbers-mode" data-ext="sql"><pre class="language-sql"><code>flush <span class="token keyword">privileges</span><span class="token punctuation">;</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div></div></div><h2 id="查看并修改mysql编码" tabindex="-1"><a class="header-anchor" href="#查看并修改mysql编码" aria-hidden="true">#</a> 查看并修改mysql编码</h2><ul><li>在容器中查看mysql配置文件</li></ul><div class="language-bash line-numbers-mode" data-ext="sh"><pre class="language-bash"><code><span class="token function">cat</span> /etc/mysql/my.cnf
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div></div></div><div class="language-text line-numbers-mode" data-ext="text"><pre class="language-text"><code># Copyright (c) 2016, 2021, Oracle and/or its affiliates.
#
# This program is free software; you can redistribute it and/or modify
# it under the terms of the GNU General Public License, version 2.0,
# as published by the Free Software Foundation.
#
# This program is also distributed with certain software (including
# but not limited to OpenSSL) that is licensed under separate terms,
# as designated in a particular file or component or in included license
# documentation.  The authors of MySQL hereby grant you an additional
# permission to link the program and your derivative works with the
# separately licensed software that they have included with MySQL.
#
# This program is distributed in the hope that it will be useful,
# but WITHOUT ANY WARRANTY; without even the implied warranty of
# MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the
# GNU General Public License, version 2.0, for more details.
#
# You should have received a copy of the GNU General Public License
# along with this program; if not, write to the Free Software
# Foundation, Inc., 51 Franklin St, Fifth Floor, Boston, MA  02110-1301 USA

!includedir /etc/mysql/conf.d/
!includedir /etc/mysql/mysql.conf.d/
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>我们的配置文件可以放到容器中的 <strong>/etc/mysql/conf.d/</strong> 文件夹下，因为我们启动容器是已经挂载了目录到该目录下，所以我们只需要在那个文件夹里新建一个 <strong>my.cnf</strong> 文件即可</p><ul><li>在配置文件中写入配置</li></ul><div class="language-ini line-numbers-mode" data-ext="ini"><pre class="language-ini"><code><span class="token section"><span class="token punctuation">[</span><span class="token section-name selector">mysqld</span><span class="token punctuation">]</span></span>
<span class="token key attr-name">character_set_server</span><span class="token punctuation">=</span><span class="token value attr-value">utf8mb4</span>
<span class="token section"><span class="token punctuation">[</span><span class="token section-name selector">client</span><span class="token punctuation">]</span></span>
<span class="token key attr-name">default-character-set</span><span class="token punctuation">=</span><span class="token value attr-value">utf8mb4</span>
<span class="token section"><span class="token punctuation">[</span><span class="token section-name selector">mysql</span><span class="token punctuation">]</span></span>
<span class="token key attr-name">default-character-set</span><span class="token punctuation">=</span><span class="token value attr-value">utf8mb4</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><ul><li>重启 mysql</li></ul><div class="language-bash line-numbers-mode" data-ext="sh"><pre class="language-bash"><code><span class="token function">docker</span> restart mysql
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div></div></div><ul><li>查看 mysql 编码</li></ul><div class="language-sql line-numbers-mode" data-ext="sql"><pre class="language-sql"><code>mysql<span class="token operator">&gt;</span> <span class="token keyword">SHOW</span> VARIABLES <span class="token operator">LIKE</span> <span class="token string">&#39;collation_%&#39;</span><span class="token punctuation">;</span>
<span class="token operator">+</span><span class="token comment">----------------------+--------------------+</span>
<span class="token operator">|</span> Variable_name        <span class="token operator">|</span> <span class="token keyword">Value</span>              <span class="token operator">|</span>
<span class="token operator">+</span><span class="token comment">----------------------+--------------------+</span>
<span class="token operator">|</span> collation_connection <span class="token operator">|</span> utf8mb4_general_ci <span class="token operator">|</span>
<span class="token operator">|</span> collation_database   <span class="token operator">|</span> utf8mb4_general_ci <span class="token operator">|</span>
<span class="token operator">|</span> collation_server     <span class="token operator">|</span> utf8mb4_general_ci <span class="token operator">|</span>
<span class="token operator">+</span><span class="token comment">----------------------+--------------------+</span>
<span class="token number">3</span> <span class="token keyword">rows</span> <span class="token operator">in</span> <span class="token keyword">set</span> <span class="token punctuation">(</span><span class="token number">0.00</span> sec<span class="token punctuation">)</span>

</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><div class="language-sql line-numbers-mode" data-ext="sql"><pre class="language-sql"><code>mysql<span class="token operator">&gt;</span> <span class="token keyword">SHOW</span> VARIABLES <span class="token operator">LIKE</span> <span class="token string">&#39;char%&#39;</span><span class="token punctuation">;</span>
<span class="token operator">+</span><span class="token comment">--------------------------+----------------------------+</span>
<span class="token operator">|</span> Variable_name            <span class="token operator">|</span> <span class="token keyword">Value</span>                      <span class="token operator">|</span>
<span class="token operator">+</span><span class="token comment">--------------------------+----------------------------+</span>
<span class="token operator">|</span> character_set_client     <span class="token operator">|</span> utf8mb4                    <span class="token operator">|</span>
<span class="token operator">|</span> character_set_connection <span class="token operator">|</span> utf8mb4                    <span class="token operator">|</span>
<span class="token operator">|</span> character_set_database   <span class="token operator">|</span> utf8mb4                    <span class="token operator">|</span>
<span class="token operator">|</span> character_set_filesystem <span class="token operator">|</span> <span class="token keyword">binary</span>                     <span class="token operator">|</span>
<span class="token operator">|</span> character_set_results    <span class="token operator">|</span> utf8mb4                    <span class="token operator">|</span>
<span class="token operator">|</span> character_set_server     <span class="token operator">|</span> utf8mb4                    <span class="token operator">|</span>
<span class="token operator">|</span> character_set_system     <span class="token operator">|</span> utf8                       <span class="token operator">|</span>
<span class="token operator">|</span> character_sets_dir       <span class="token operator">|</span> <span class="token operator">/</span>usr<span class="token operator">/</span><span class="token keyword">share</span><span class="token operator">/</span>mysql<span class="token operator">/</span>charsets<span class="token operator">/</span> <span class="token operator">|</span>
<span class="token operator">+</span><span class="token comment">--------------------------+----------------------------+</span>
<span class="token number">8</span> <span class="token keyword">rows</span> <span class="token operator">in</span> <span class="token keyword">set</span> <span class="token punctuation">(</span><span class="token number">0.01</span> sec<span class="token punctuation">)</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h2 id="创建mysql-新用户" tabindex="-1"><a class="header-anchor" href="#创建mysql-新用户" aria-hidden="true">#</a> 创建mysql 新用户</h2>`,17),y={class:"hint-container tip"},q=s("p",{class:"hint-container-title"},"提示",-1);function _(f,w){const t=l("ExternalLinkIcon"),o=l("RouterLink");return r(),p("div",null,[u,s("p",null,[a("也可以去"),s("a",m,[a("官网查看镜像tag"),n(t)]),a("，选择自己需要的版本，否则会下载最新版本")]),v,s("div",k,[b,s("p",null,[a("注意：如果提示无法修改，这是因为 mysql从5.7.6 "),s("a",h,[a("开始删除了password字段"),n(t)]),a(" 需要换另一种方式修改密码")])]),g,s("div",y,[q,s("p",null,[a("关于 mysql 创建用户、数据库、以及给用户赋权等操作命令，请查看 "),n(o,{to:"/passages/"},{default:c(()=>[a("mysql 系列文章 - 创建用户以及赋权")]),_:1})])])])}const A=i(d,[["render",_],["__file","03.docker下安装并配置mysql.html.vue"]]);export{A as default};
