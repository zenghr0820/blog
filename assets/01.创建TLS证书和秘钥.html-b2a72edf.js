import{_ as c,D as l,Y as o,Z as p,$ as s,a1 as a,a3 as t,a2 as n,a0 as r}from"./framework-1b75f830.js";const u={},d=s("h1",{id:"åˆ›å»ºtlsè¯ä¹¦å’Œç§˜é’¥",tabindex:"-1"},[s("a",{class:"header-anchor",href:"#åˆ›å»ºtlsè¯ä¹¦å’Œç§˜é’¥","aria-hidden":"true"},"#"),n(" åˆ›å»ºTLSè¯ä¹¦å’Œç§˜é’¥")],-1),m=s("p",null,[s("strong",null,"å¦‚æœæ‚¨ä¸æƒ³çœ‹è®¤è¯æˆæƒçš„è§£é‡Šï¼Œè¯·ç›´æ¥çœ‹"),n(),s("a",{href:"#%E4%B8%89%E3%80%81%E5%AE%89%E8%A3%85-cfssl"},"å®‰è£… CFSSL")],-1),v={class:"table-of-contents"},k=s("h2",{id:"ä¸€ã€ç†è§£è®¤è¯æˆæƒ",tabindex:"-1"},[s("a",{class:"header-anchor",href:"#ä¸€ã€ç†è§£è®¤è¯æˆæƒ","aria-hidden":"true"},"#"),n(" ä¸€ã€ç†è§£è®¤è¯æˆæƒ")],-1),b={href:"https://github.com/liuyi01/kubernetes-starter/blob/master/docs/3-kubernetes-with-ca.md",target:"_blank",rel:"noopener noreferrer"},g=s("h3",{id:"_1-1-ä¸ºä»€ä¹ˆè¦è®¤è¯",tabindex:"-1"},[s("a",{class:"header-anchor",href:"#_1-1-ä¸ºä»€ä¹ˆè¦è®¤è¯","aria-hidden":"true"},"#"),n(" 1.1 ä¸ºä»€ä¹ˆè¦è®¤è¯")],-1),h=s("p",null,"æƒ³ç†è§£è®¤è¯ï¼Œæˆ‘ä»¬å¾—ä»è®¤è¯è§£å†³ä»€ä¹ˆé—®é¢˜ã€é˜²æ­¢ä»€ä¹ˆé—®é¢˜çš„å‘ç”Ÿå…¥æ‰‹ã€‚ é˜²æ­¢ä»€ä¹ˆé—®é¢˜å‘¢ï¼Ÿæ˜¯é˜²æ­¢æœ‰äººå…¥ä¾µä½ çš„é›†ç¾¤ï¼Œrootä½ çš„æœºå™¨åè®©æˆ‘ä»¬é›†ç¾¤ä¾ç„¶å®‰å…¨å—ï¼Ÿä¸æ˜¯å§ï¼Œrootéƒ½åˆ°æ‰‹äº†ï¼Œé‚£å°±ä¸ºæ‰€æ¬²ä¸ºï¼Œé˜²ä¸èƒœé˜²äº†ã€‚ å…¶å®ç½‘ç»œå®‰å…¨æœ¬èº«å°±æ˜¯ä¸ºäº†è§£å†³åœ¨æŸäº›å‡è®¾æˆç«‹çš„æ¡ä»¶ä¸‹å¦‚ä½•é˜²èŒƒçš„é—®é¢˜ã€‚æ¯”å¦‚ä¸€ä¸ªéå¸¸é‡è¦çš„å‡è®¾å°±æ˜¯ä¸¤ä¸ªèŠ‚ç‚¹æˆ–è€…ipä¹‹é—´çš„é€šè®¯ç½‘ç»œæ˜¯ä¸å¯ä¿¡ä»»çš„ï¼Œå¯èƒ½ä¼šè¢«ç¬¬ä¸‰æ–¹çªƒå–ï¼Œä¹Ÿå¯èƒ½ä¼šè¢«ç¬¬ä¸‰æ–¹ç¯¡æ”¹ã€‚å°±åƒæˆ‘ä»¬ä¸Šå­¦æ—¶å€™ç»™å¿ƒä»ªçš„å¥³å­©ä¼ çº¸æ¡ï¼Œä¼ é€çš„è¿‡ç¨‹å¯èƒ½ä¼šè¢«åˆ«çš„åŒå­¦å·çœ‹ï¼Œç”šè‡³å†…å®¹å¯èƒ½ä¼šä»æˆ‘å–œæ¬¢ä½ ä¿®æ”¹æˆæˆ‘ä¸å–œæ¬¢ä½ äº†ã€‚å½“ç„¶è¿™ç§å‡è®¾ä¸æ˜¯éšä¾¿æƒ³å‡ºæ¥çš„ï¼Œè€Œæ˜¯ä»ç½‘ç»œæŠ€æœ¯ç°çŠ¶å’Œå®é™…å‘ç”Ÿçš„é—®é¢˜ä¸­å‘ç°ã€æ€»ç»“å‡ºæ¥çš„ã€‚kubernetesçš„è®¤è¯ä¹Ÿæ˜¯ä»è¿™ä¸ªé—®é¢˜å‡ºå‘æ¥å®ç°çš„ã€‚",-1),q=s("h3",{id:"_1-2-æ¦‚å¿µæ¢³ç†",tabindex:"-1"},[s("a",{class:"header-anchor",href:"#_1-2-æ¦‚å¿µæ¢³ç†","aria-hidden":"true"},"#"),n(" 1.2 æ¦‚å¿µæ¢³ç†")],-1),f=s("p",null,"ä¸ºäº†è§£å†³ä¸Šé¢è¯´çš„é—®é¢˜ï¼Œkuberneteså¹¶ä¸éœ€è¦è‡ªå·±æƒ³åŠæ³•ï¼Œæ¯•ç«Ÿæ˜¯ç½‘ç»œå®‰å…¨å±‚é¢çš„é—®é¢˜ï¼Œæ˜¯æ¯ä¸ªæœåŠ¡éƒ½ä¼šé‡åˆ°çš„é—®é¢˜ï¼Œä¸šå†…ä¹Ÿæœ‰æˆç†Ÿçš„æ–¹æ¡ˆæ¥è§£å†³ã€‚è¿™é‡Œæˆ‘ä»¬ä¸€èµ·äº†è§£ä¸€ä¸‹ä¸šå†…æ–¹æ¡ˆå’Œç›¸å…³çš„æ¦‚å¿µã€‚",-1),_=s("strong",null,"å¯¹ç§°åŠ å¯†/éå¯¹ç§°åŠ å¯†",-1),x={href:"https://www.zhihu.com/question/33645891/answer/57721969",target:"_blank",rel:"noopener noreferrer"},y=s("strong",null,"SSL/TLS",-1),S={href:"http://www.ruanyifeng.com/blog/2014/02/ssl_tls.html",target:"_blank",rel:"noopener noreferrer"},A=r(`<h3 id="_1-3-ä»€ä¹ˆæ˜¯æˆæƒ" tabindex="-1"><a class="header-anchor" href="#_1-3-ä»€ä¹ˆæ˜¯æˆæƒ" aria-hidden="true">#</a> 1.3 ä»€ä¹ˆæ˜¯æˆæƒ</h3><p>æˆæƒçš„æ¦‚å¿µå°±ç®€å•å¤šäº†ï¼Œå°±æ˜¯ä»€ä¹ˆäººå…·æœ‰ä»€ä¹ˆæ ·çš„æƒé™ï¼Œä¸€èˆ¬é€šè¿‡è§’è‰²ä½œä¸ºçº½å¸¦æŠŠä»–ä»¬ç»„åˆåœ¨ä¸€èµ·ã€‚ä¹Ÿå°±æ˜¯ä¸€ä¸ªè§’è‰²ä¸€è¾¹æ‹¥æœ‰å¤šç§æƒé™ï¼Œä¸€è¾¹æ‹¥æœ‰å¤šä¸ªäººã€‚è¿™æ ·å°±æŠŠäººå’Œæƒé™å»ºç«‹äº†ä¸€ä¸ªå…³ç³»ã€‚</p><h2 id="äºŒã€kubernetesçš„è®¤è¯æˆæƒ" tabindex="-1"><a class="header-anchor" href="#äºŒã€kubernetesçš„è®¤è¯æˆæƒ" aria-hidden="true">#</a> äºŒã€kubernetesçš„è®¤è¯æˆæƒ</h2><p>Kubernetesé›†ç¾¤çš„æ‰€æœ‰æ“ä½œåŸºæœ¬ä¸Šéƒ½æ˜¯é€šè¿‡kube-apiserverè¿™ä¸ªç»„ä»¶è¿›è¡Œçš„ï¼Œå®ƒæä¾›HTTP RESTfulå½¢å¼çš„APIä¾›é›†ç¾¤å†…å¤–å®¢æˆ·ç«¯è°ƒç”¨ã€‚éœ€è¦æ³¨æ„çš„æ˜¯ï¼šè®¤è¯æˆæƒè¿‡ç¨‹åªå­˜åœ¨HTTPSå½¢å¼çš„APIä¸­ã€‚ä¹Ÿå°±æ˜¯è¯´ï¼Œå¦‚æœå®¢æˆ·ç«¯ä½¿ç”¨HTTPè¿æ¥åˆ°kube-apiserverï¼Œé‚£ä¹ˆæ˜¯ä¸ä¼šè¿›è¡Œè®¤è¯æˆæƒçš„ã€‚æ‰€ä»¥è¯´ï¼Œå¯ä»¥è¿™ä¹ˆè®¾ç½®ï¼Œåœ¨é›†ç¾¤å†…éƒ¨ç»„ä»¶é—´é€šä¿¡ä½¿ç”¨HTTPï¼Œé›†ç¾¤å¤–éƒ¨å°±ä½¿ç”¨HTTPSï¼Œè¿™æ ·æ—¢å¢åŠ äº†å®‰å…¨æ€§ï¼Œä¹Ÿä¸è‡³äºå¤ªå¤æ‚ã€‚ å¯¹APIServerçš„è®¿é—®è¦ç»è¿‡çš„ä¸‰ä¸ªæ­¥éª¤ï¼Œå‰é¢ä¸¤ä¸ªæ˜¯è®¤è¯å’Œæˆæƒï¼Œç¬¬ä¸‰ä¸ªæ˜¯ Admission Controlï¼Œå®ƒä¹Ÿèƒ½åœ¨ä¸€å®šç¨‹åº¦ä¸Šæé«˜å®‰å…¨æ€§ï¼Œä¸è¿‡æ›´å¤šæ˜¯èµ„æºç®¡ç†æ–¹é¢çš„ä½œç”¨ã€‚</p><h3 id="_2-1-kubernetesçš„è®¤è¯" tabindex="-1"><a class="header-anchor" href="#_2-1-kubernetesçš„è®¤è¯" aria-hidden="true">#</a> 2.1 kubernetesçš„è®¤è¯</h3><p>kubernetesæä¾›äº†å¤šç§è®¤è¯æ–¹å¼ï¼Œæ¯”å¦‚å®¢æˆ·ç«¯è¯ä¹¦ã€é™æ€tokenã€é™æ€å¯†ç æ–‡ä»¶ã€ServiceAccountTokensç­‰ç­‰ã€‚ä½ å¯ä»¥åŒæ—¶ä½¿ç”¨ä¸€ç§æˆ–å¤šç§è®¤è¯æ–¹å¼ã€‚åªè¦é€šè¿‡ä»»ä½•ä¸€ä¸ªéƒ½è¢«è®¤ä½œæ˜¯è®¤è¯é€šè¿‡ã€‚ä¸‹é¢æˆ‘ä»¬å°±è®¤è¯†å‡ ä¸ªå¸¸è§çš„è®¤è¯æ–¹å¼ã€‚</p><ul><li><strong>å®¢æˆ·ç«¯è¯ä¹¦è®¤è¯</strong> å®¢æˆ·ç«¯è¯ä¹¦è®¤è¯å«ä½œTLSåŒå‘è®¤è¯ï¼Œä¹Ÿå°±æ˜¯æœåŠ¡å™¨å®¢æˆ·ç«¯äº’ç›¸éªŒè¯è¯ä¹¦çš„æ­£ç¡®æ€§ï¼Œåœ¨éƒ½æ­£ç¡®çš„æƒ…å†µä¸‹åè°ƒé€šä¿¡åŠ å¯†æ–¹æ¡ˆã€‚ ä¸ºäº†ä½¿ç”¨è¿™ä¸ªæ–¹æ¡ˆï¼Œapi-serveréœ€è¦ç”¨--client-ca-fileé€‰é¡¹æ¥å¼€å¯ã€‚</li><li><strong>å¼•å¯¼Token</strong> å½“æˆ‘ä»¬æœ‰éå¸¸å¤šçš„nodeèŠ‚ç‚¹æ—¶ï¼Œæ‰‹åŠ¨ä¸ºæ¯ä¸ªnodeèŠ‚ç‚¹é…ç½®TLSè®¤è¯æ¯”è¾ƒéº»çƒ¦ï¼Œè¿™æ—¶å°±å¯ä»¥ç”¨åˆ°å¼•å¯¼tokençš„è®¤è¯æ–¹å¼ï¼Œå‰ææ˜¯éœ€è¦åœ¨api-serverå¼€å¯ experimental-bootstrap-token-auth ç‰¹æ€§ï¼Œå®¢æˆ·ç«¯çš„tokenä¿¡æ¯ä¸é¢„å…ˆå®šä¹‰çš„tokenåŒ¹é…è®¤è¯é€šè¿‡åï¼Œè‡ªåŠ¨ä¸ºnodeé¢å‘è¯ä¹¦ã€‚å½“ç„¶å¼•å¯¼tokenæ˜¯ä¸€ç§æœºåˆ¶ï¼Œå¯ä»¥ç”¨åˆ°å„ç§åœºæ™¯ä¸­ã€‚</li><li><strong>Service Account Tokens è®¤è¯</strong> æœ‰äº›æƒ…å†µä¸‹ï¼Œæˆ‘ä»¬å¸Œæœ›åœ¨podå†…éƒ¨è®¿é—®api-serverï¼Œè·å–é›†ç¾¤çš„ä¿¡æ¯ï¼Œç”šè‡³å¯¹é›†ç¾¤è¿›è¡Œæ”¹åŠ¨ã€‚é’ˆå¯¹è¿™ç§æƒ…å†µï¼Œkubernetesæä¾›äº†ä¸€ç§ç‰¹æ®Šçš„è®¤è¯æ–¹å¼ï¼šService Accountã€‚ Service Account å’Œ podã€serviceã€deployment ä¸€æ ·æ˜¯ kubernetes é›†ç¾¤ä¸­çš„ä¸€ç§èµ„æºï¼Œç”¨æˆ·ä¹Ÿå¯ä»¥åˆ›å»ºè‡ªå·±çš„ Service Accountã€‚ ServiceAccount ä¸»è¦åŒ…å«äº†ä¸‰ä¸ªå†…å®¹ï¼šnamespaceã€Token å’Œ CAã€‚namespace æŒ‡å®šäº† pod æ‰€åœ¨çš„ namespaceï¼ŒCA ç”¨äºéªŒè¯ apiserver çš„è¯ä¹¦ï¼Œtoken ç”¨ä½œèº«ä»½éªŒè¯ã€‚å®ƒä»¬éƒ½é€šè¿‡ mount çš„æ–¹å¼ä¿å­˜åœ¨ pod çš„æ–‡ä»¶ç³»ç»Ÿä¸­ã€‚</li></ul><h3 id="_2-2-kubernetesçš„æˆæƒ" tabindex="-1"><a class="header-anchor" href="#_2-2-kubernetesçš„æˆæƒ" aria-hidden="true">#</a> 2.2 kubernetesçš„æˆæƒ</h3><p>åœ¨Kubernetes1.6ç‰ˆæœ¬ä¸­æ–°å¢è§’è‰²è®¿é—®æ§åˆ¶æœºåˆ¶ï¼ˆRole-Based Accessï¼ŒRBACï¼‰è®©é›†ç¾¤ç®¡ç†å‘˜å¯ä»¥é’ˆå¯¹ç‰¹å®šä½¿ç”¨è€…æˆ–æœåŠ¡è´¦å·çš„è§’è‰²ï¼Œè¿›è¡Œæ›´ç²¾ç¡®çš„èµ„æºè®¿é—®æ§åˆ¶ã€‚åœ¨RBACä¸­ï¼Œæƒé™ä¸è§’è‰²ç›¸å…³è”ï¼Œç”¨æˆ·é€šè¿‡æˆä¸ºé€‚å½“è§’è‰²çš„æˆå‘˜è€Œå¾—åˆ°è¿™äº›è§’è‰²çš„æƒé™ã€‚è¿™å°±æå¤§åœ°ç®€åŒ–äº†æƒé™çš„ç®¡ç†ã€‚åœ¨ä¸€ä¸ªç»„ç»‡ä¸­ï¼Œè§’è‰²æ˜¯ä¸ºäº†å®Œæˆå„ç§å·¥ä½œè€Œåˆ›é€ ï¼Œç”¨æˆ·åˆ™ä¾æ®å®ƒçš„è´£ä»»å’Œèµ„æ ¼æ¥è¢«æŒ‡æ´¾ç›¸åº”çš„è§’è‰²ï¼Œç”¨æˆ·å¯ä»¥å¾ˆå®¹æ˜“åœ°ä»ä¸€ä¸ªè§’è‰²è¢«æŒ‡æ´¾åˆ°å¦ä¸€ä¸ªè§’è‰²ã€‚ ç›®å‰ Kubernetes ä¸­æœ‰ä¸€ç³»åˆ—çš„é‰´æƒæœºåˆ¶ï¼Œå› ä¸ºKubernetesç¤¾åŒºçš„æŠ•å…¥å’Œåå¥½ï¼Œç›¸å¯¹äºå…¶å®ƒé‰´æƒæœºåˆ¶è€Œè¨€ï¼ŒRBACæ˜¯æ›´å¥½çš„é€‰æ‹©ã€‚å…·ä½“RBACæ˜¯å¦‚ä½•ä½“ç°åœ¨kubernetesç³»ç»Ÿä¸­çš„æˆ‘ä»¬ä¼šåœ¨åé¢çš„éƒ¨ç½²ä¸­é€æ­¥çš„æ·±å…¥äº†è§£ã€‚</p><h3 id="_2-3-kubernetesçš„admissioncontrol" tabindex="-1"><a class="header-anchor" href="#_2-3-kubernetesçš„admissioncontrol" aria-hidden="true">#</a> 2.3 kubernetesçš„AdmissionControl</h3><p>AdmissionControl - å‡†å…¥æ§åˆ¶æœ¬è´¨ä¸Šä¸ºä¸€æ®µå‡†å…¥ä»£ç ï¼Œåœ¨å¯¹kubernetes apiçš„è¯·æ±‚è¿‡ç¨‹ä¸­ï¼Œé¡ºåºä¸ºï¼šå…ˆç»è¿‡è®¤è¯ &amp; æˆæƒï¼Œç„¶åæ‰§è¡Œå‡†å…¥æ“ä½œï¼Œæœ€åå¯¹ç›®æ ‡å¯¹è±¡è¿›è¡Œæ“ä½œã€‚è¿™ä¸ªå‡†å…¥ä»£ç åœ¨api-serverä¸­ï¼Œè€Œä¸”å¿…é¡»è¢«ç¼–è¯‘åˆ°äºŒè¿›åˆ¶æ–‡ä»¶ä¸­æ‰èƒ½è¢«æ‰§è¡Œã€‚ åœ¨å¯¹é›†ç¾¤è¿›è¡Œè¯·æ±‚æ—¶ï¼Œæ¯ä¸ªå‡†å…¥æ§åˆ¶ä»£ç éƒ½æŒ‰ç…§ä¸€å®šé¡ºåºæ‰§è¡Œã€‚å¦‚æœæœ‰ä¸€ä¸ªå‡†å…¥æ§åˆ¶æ‹’ç»äº†æ­¤æ¬¡è¯·æ±‚ï¼Œé‚£ä¹ˆæ•´ä¸ªè¯·æ±‚çš„ç»“æœå°†ä¼šç«‹å³è¿”å›ï¼Œå¹¶æç¤ºç”¨æˆ·ç›¸åº”çš„errorä¿¡æ¯ã€‚ å¸¸ç”¨ç»„ä»¶ï¼ˆæ§åˆ¶ä»£ç ï¼‰å¦‚ä¸‹ï¼š</p><ul><li>AlwaysAdmitï¼šå…è®¸æ‰€æœ‰è¯·æ±‚</li><li>AlwaysDenyï¼šç¦æ­¢æ‰€æœ‰è¯·æ±‚ï¼Œå¤šç”¨äºæµ‹è¯•ç¯å¢ƒ</li><li>ServiceAccountï¼šå®ƒå°†serviceAccountså®ç°äº†è‡ªåŠ¨åŒ–ï¼Œå®ƒä¼šè¾…åŠ©serviceAccountåšä¸€äº›äº‹æƒ…ï¼Œæ¯”å¦‚å¦‚æœpodæ²¡æœ‰serviceAccountå±æ€§ï¼Œå®ƒä¼šè‡ªåŠ¨æ·»åŠ ä¸€ä¸ªdefaultï¼Œå¹¶ç¡®ä¿podçš„serviceAccountå§‹ç»ˆå­˜åœ¨</li><li>LimitRangerï¼šä»–ä¼šè§‚å¯Ÿæ‰€æœ‰çš„è¯·æ±‚ï¼Œç¡®ä¿æ²¡æœ‰è¿åå·²ç»å®šä¹‰å¥½çš„çº¦æŸæ¡ä»¶ï¼Œè¿™äº›æ¡ä»¶å®šä¹‰åœ¨namespaceä¸­LimitRangeå¯¹è±¡ä¸­ã€‚å¦‚æœåœ¨kubernetesä¸­ä½¿ç”¨LimitRangeå¯¹è±¡ï¼Œåˆ™å¿…é¡»ä½¿ç”¨è¿™ä¸ªæ’ä»¶ã€‚</li><li>NamespaceExistsï¼šå®ƒä¼šè§‚å¯Ÿæ‰€æœ‰çš„è¯·æ±‚ï¼Œå¦‚æœè¯·æ±‚å°è¯•åˆ›å»ºä¸€ä¸ªä¸å­˜åœ¨çš„namespaceï¼Œåˆ™è¿™ä¸ªè¯·æ±‚è¢«æ‹’ç»ã€‚</li></ul><h2 id="ä¸‰ã€å®‰è£…-cfssl" tabindex="-1"><a class="header-anchor" href="#ä¸‰ã€å®‰è£…-cfssl" aria-hidden="true">#</a> ä¸‰ã€å®‰è£… CFSSL</h2><p><strong>éœ€è¦å‡†å¤‡çš„è¯ä¹¦ï¼š</strong></p><ul><li>ca-key.pem</li><li>ca.pem</li><li>etcd-key.pem</li><li>etcd.pem</li><li>server-key.pem</li><li>server.pem</li><li>admin.pem</li><li>admin-key.pem</li><li>kube-proxy-key.pem</li><li>kube-proxy.pem</li></ul><p><strong>ä½¿ç”¨è¯ä¹¦çš„ç»„ä»¶å¦‚ä¸‹ï¼š</strong></p><ul><li>etcdï¼šä½¿ç”¨ ca.pemã€server-key.pemã€server.pem</li><li>kube-apiserverï¼šä½¿ç”¨ ca.pemã€server-key.pemã€server.pem</li><li>kubeletï¼šä½¿ç”¨ ca.pem</li><li>kube-proxyï¼šä½¿ç”¨ ca.pemã€kube-proxy-key.pemã€kube-proxy.pem</li><li>kubectlï¼šä½¿ç”¨ ca.pemã€admin-key.pemã€admin.pem</li><li>kube-controller-managerï¼šä½¿ç”¨ ca-key.pemã€ca.pem</li></ul><p>æˆ‘ä»¬ä½¿ç”¨CFSSLæ¥åˆ¶ä½œè¯ä¹¦ï¼Œå®ƒæ˜¯cloudflareå¼€å‘çš„ä¸€ä¸ªå¼€æºçš„PKIå·¥å…·ï¼Œæ˜¯ä¸€ä¸ªå®Œå¤‡çš„CAæœåŠ¡ç³»ç»Ÿï¼Œå¯ä»¥ç­¾ç½²ã€æ’¤é”€è¯ä¹¦ç­‰ï¼Œè¦†ç›–äº†ä¸€ä¸ªè¯ä¹¦çš„æ•´ä¸ªç”Ÿå‘½å‘¨æœŸï¼Œåé¢åªç”¨åˆ°äº†å®ƒçš„å‘½ä»¤è¡Œå·¥å…·ã€‚</p><div class="hint-container tip"><p class="hint-container-title">æç¤º</p><p>æ³¨ï¼šä¸€èˆ¬æƒ…å†µä¸‹ï¼ŒK8Sä¸­è¯ä¹¦åªéœ€è¦åˆ›å»ºä¸€æ¬¡ï¼Œä»¥ååœ¨å‘é›†ç¾¤ä¸­æ·»åŠ æ–°èŠ‚ç‚¹æ—¶åªè¦å°†/etc/kubernetes/caç›®å½•ä¸‹çš„è¯ä¹¦æ‹·è´åˆ°æ–°èŠ‚ç‚¹ä¸Šå³å¯ã€‚</p></div><p>cfsslæ˜¯éå¸¸å¥½ç”¨çš„CAå·¥å…·ï¼Œæˆ‘ä»¬ç”¨å®ƒæ¥ç”Ÿæˆè¯ä¹¦å’Œç§˜é’¥æ–‡ä»¶ï¼Œ<strong>ç›´æ¥ä½¿ç”¨äºŒè¿›åˆ¶æºç åŒ…å®‰è£…ï¼š</strong></p><div class="language-bash line-numbers-mode" data-ext="sh"><pre class="language-bash"><code><span class="token comment">#ä¸‹è½½</span>
$ <span class="token function">wget</span> <span class="token parameter variable">-q</span> --show-progress --https-only <span class="token parameter variable">--timestamping</span> <span class="token punctuation">\\</span>
  https://pkg.cfssl.org/R1.2/cfssl_linux-amd64 <span class="token punctuation">\\</span>
  https://pkg.cfssl.org/R1.2/cfssljson_linux-amd64
  
<span class="token comment">#ä¿®æ”¹ä¸ºå¯æ‰§è¡Œæƒé™</span>
$ <span class="token function">chmod</span> +x cfssl_linux-amd64 cfssljson_linux-amd64

<span class="token comment">#ç§»åŠ¨åˆ°binç›®å½•</span>
$ <span class="token function">mv</span> cfssl_linux-amd64 /usr/local/bin/cfssl
$ <span class="token function">mv</span> cfssljson_linux-amd64 /usr/local/bin/cfssljson

<span class="token comment">#éªŒè¯</span>
$ cfssl version
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h2 id="è¯ä¹¦ä½ç½®" tabindex="-1"><a class="header-anchor" href="#è¯ä¹¦ä½ç½®" aria-hidden="true">#</a> è¯ä¹¦ä½ç½®</h2><div class="language-bash line-numbers-mode" data-ext="sh"><pre class="language-bash"><code><span class="token comment">#æ‰€æœ‰è¯ä¹¦ç›¸å…³çš„ä¸œè¥¿éƒ½æ”¾åœ¨è¿™, åé¢æ‰€æœ‰çš„è¯ä¹¦éƒ½æ”¾åœ¨è¯¥ç›®å½•ä¸‹, ä½ å¯ä»¥è‡ªå®šä¹‰</span>
<span class="token function">mkdir</span> <span class="token parameter variable">-p</span> /etc/kubernetes/ca
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div></div></div><h2 id="å››ã€åˆ›å»º-ca-æ ¹è¯ä¹¦" tabindex="-1"><a class="header-anchor" href="#å››ã€åˆ›å»º-ca-æ ¹è¯ä¹¦" aria-hidden="true">#</a> å››ã€åˆ›å»º CA (æ ¹è¯ä¹¦)</h2><h3 id="_4-1-åˆ›å»º-ca-é…ç½®æ–‡ä»¶" tabindex="-1"><a class="header-anchor" href="#_4-1-åˆ›å»º-ca-é…ç½®æ–‡ä»¶" aria-hidden="true">#</a> 4.1 åˆ›å»º CA é…ç½®æ–‡ä»¶</h3><div class="language-bash line-numbers-mode" data-ext="sh"><pre class="language-bash"><code><span class="token builtin class-name">cd</span> /etc/kubernetes/ca
<span class="token comment"># åˆ›å»ºå¦‚ä¸‹çš„ca-config.jsonæ–‡ä»¶(* ä¹Ÿå¯ä»¥ä¸æ‰§è¡Œè¯¥å‘½ä»¤ï¼Œç›´æ¥åˆ›å»ºä¸‹é¢ğŸ‘‡çš„æ–‡ä»¶)</span>
cfssl print-defaults config <span class="token operator">&gt;</span> ca-config.json
<span class="token comment"># ä¿®æ”¹ ca-config.json æ–‡ä»¶ï¼Œå¦‚ä¸‹ï¼š</span>
<span class="token function">vim</span> ca-config.json
<span class="token comment"># è¿‡æœŸæ—¶é—´è®¾ç½®æˆäº† 87600h</span>
<span class="token punctuation">{</span>
  <span class="token string">&quot;signing&quot;</span><span class="token builtin class-name">:</span> <span class="token punctuation">{</span>
    <span class="token string">&quot;default&quot;</span><span class="token builtin class-name">:</span> <span class="token punctuation">{</span>
      <span class="token string">&quot;expiry&quot;</span><span class="token builtin class-name">:</span> <span class="token string">&quot;87600h&quot;</span>
    <span class="token punctuation">}</span>,
    <span class="token string">&quot;profiles&quot;</span><span class="token builtin class-name">:</span> <span class="token punctuation">{</span>
      <span class="token string">&quot;kubernetes&quot;</span><span class="token builtin class-name">:</span> <span class="token punctuation">{</span>
        <span class="token string">&quot;usages&quot;</span><span class="token builtin class-name">:</span> <span class="token punctuation">[</span>
            <span class="token string">&quot;signing&quot;</span>,
            <span class="token string">&quot;key encipherment&quot;</span>,
            <span class="token string">&quot;server auth&quot;</span>,
            <span class="token string">&quot;client auth&quot;</span>
        <span class="token punctuation">]</span>,
        <span class="token string">&quot;expiry&quot;</span><span class="token builtin class-name">:</span> <span class="token string">&quot;87600h&quot;</span>
      <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>

</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>å­—æ®µè¯´æ˜</p><ul><li><code>ca-config.json</code>ï¼šå¯ä»¥å®šä¹‰å¤šä¸ª profilesï¼Œåˆ†åˆ«æŒ‡å®šä¸åŒçš„è¿‡æœŸæ—¶é—´ã€ä½¿ç”¨åœºæ™¯ç­‰å‚æ•°ï¼›åç»­åœ¨ç­¾åè¯ä¹¦æ—¶ä½¿ç”¨æŸä¸ª profileï¼›</li><li><code>signing</code>ï¼šè¡¨ç¤ºè¯¥è¯ä¹¦å¯ç”¨äºç­¾åå…¶å®ƒè¯ä¹¦ï¼›ç”Ÿæˆçš„ ca.pem è¯ä¹¦ä¸­ <code>CA=TRUE</code>ï¼›</li><li><code>server auth</code>ï¼šè¡¨ç¤ºclientå¯ä»¥ç”¨è¯¥ CA å¯¹serveræä¾›çš„è¯ä¹¦è¿›è¡ŒéªŒè¯ï¼›</li><li><code>client auth</code>ï¼šè¡¨ç¤ºserverå¯ä»¥ç”¨è¯¥CAå¯¹clientæä¾›çš„è¯ä¹¦è¿›è¡ŒéªŒè¯ï¼›</li></ul><h3 id="_4-2-åˆ›å»º-ca-è¯ä¹¦ç­¾åè¯·æ±‚" tabindex="-1"><a class="header-anchor" href="#_4-2-åˆ›å»º-ca-è¯ä¹¦ç­¾åè¯·æ±‚" aria-hidden="true">#</a> 4.2 åˆ›å»º CA è¯ä¹¦ç­¾åè¯·æ±‚</h3><div class="language-bash line-numbers-mode" data-ext="sh"><pre class="language-bash"><code><span class="token comment"># åˆ›å»ºå¦‚ä¸‹çš„ca-csr.jsonæ–‡ä»¶</span>
cfssl print-defaults csr <span class="token operator">&gt;</span> ca-csr.json
<span class="token comment"># ä¿®æ”¹ ca-csr.json æ–‡ä»¶ï¼Œå¦‚ä¸‹ï¼š</span>
<span class="token function">vim</span> ca-csr.json
<span class="token comment"># ca-csr.josn æ–‡ä»¶å†…å®¹å¦‚ä¸‹</span>
<span class="token punctuation">{</span>
  <span class="token string">&quot;CN&quot;</span><span class="token builtin class-name">:</span> <span class="token string">&quot;kubernetes&quot;</span>,
  <span class="token string">&quot;key&quot;</span><span class="token builtin class-name">:</span> <span class="token punctuation">{</span>
    <span class="token string">&quot;algo&quot;</span><span class="token builtin class-name">:</span> <span class="token string">&quot;rsa&quot;</span>,
    <span class="token string">&quot;size&quot;</span><span class="token builtin class-name">:</span> <span class="token number">2048</span>
  <span class="token punctuation">}</span>,
  <span class="token string">&quot;names&quot;</span><span class="token builtin class-name">:</span> <span class="token punctuation">[</span>
    <span class="token punctuation">{</span>
      <span class="token string">&quot;C&quot;</span><span class="token builtin class-name">:</span> <span class="token string">&quot;CN&quot;</span>,
      <span class="token string">&quot;ST&quot;</span><span class="token builtin class-name">:</span> <span class="token string">&quot;BeiJing&quot;</span>,
      <span class="token string">&quot;L&quot;</span><span class="token builtin class-name">:</span> <span class="token string">&quot;BeiJing&quot;</span>,
      <span class="token string">&quot;O&quot;</span><span class="token builtin class-name">:</span> <span class="token string">&quot;k8s&quot;</span>,
      <span class="token string">&quot;OU&quot;</span><span class="token builtin class-name">:</span> <span class="token string">&quot;System&quot;</span>
    <span class="token punctuation">}</span>
  <span class="token punctuation">]</span>,
    <span class="token string">&quot;ca&quot;</span><span class="token builtin class-name">:</span> <span class="token punctuation">{</span>
       <span class="token string">&quot;expiry&quot;</span><span class="token builtin class-name">:</span> <span class="token string">&quot;87600h&quot;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>å­—æ®µè¯´æ˜</p><ul><li>&quot;CN&quot;ï¼š<code>Common Name</code>ï¼Œkube-apiserver ä»è¯ä¹¦ä¸­æå–è¯¥å­—æ®µä½œä¸ºè¯·æ±‚çš„ç”¨æˆ·å (User Name)ï¼›æµè§ˆå™¨ä½¿ç”¨è¯¥å­—æ®µéªŒè¯ç½‘ç«™æ˜¯å¦åˆæ³•ï¼›</li><li>&quot;O&quot;ï¼š<code>Organization</code>ï¼Œkube-apiserver ä»è¯ä¹¦ä¸­æå–è¯¥å­—æ®µä½œä¸ºè¯·æ±‚ç”¨æˆ·æ‰€å±çš„ç»„ (Group)ï¼›</li></ul><h3 id="_4-3-ç”Ÿæˆ-ca-è¯ä¹¦å’Œç§é’¥" tabindex="-1"><a class="header-anchor" href="#_4-3-ç”Ÿæˆ-ca-è¯ä¹¦å’Œç§é’¥" aria-hidden="true">#</a> 4.3 ç”Ÿæˆ CA è¯ä¹¦å’Œç§é’¥</h3><div class="language-bash line-numbers-mode" data-ext="sh"><pre class="language-bash"><code>cfssl gencert <span class="token parameter variable">-initca</span> ca-csr.json <span class="token operator">|</span> cfssljson <span class="token parameter variable">-bare</span> ca
<span class="token comment"># ç”Ÿæˆå®Œæˆåä¼šæœ‰ä»¥ä¸‹æ–‡ä»¶ï¼ˆæˆ‘ä»¬æœ€ç»ˆæƒ³è¦çš„å°±æ˜¯ca-key.pemå’Œca.pemï¼Œä¸€ä¸ªç§˜é’¥ï¼Œä¸€ä¸ªè¯ä¹¦ï¼‰</span>
<span class="token operator">&gt;</span> <span class="token function">ls</span>
<span class="token operator">&gt;</span> ca-config.json  ca.csr  ca-csr.json  ca-key.pem  ca.pem
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h2 id="äº”ã€åˆ›å»º-etcd-è¯ä¹¦" tabindex="-1"><a class="header-anchor" href="#äº”ã€åˆ›å»º-etcd-è¯ä¹¦" aria-hidden="true">#</a> äº”ã€åˆ›å»º ETCD è¯ä¹¦</h2><h3 id="_5-1-ç”Ÿæˆ-etcd-è¯ä¹¦é…ç½®" tabindex="-1"><a class="header-anchor" href="#_5-1-ç”Ÿæˆ-etcd-è¯ä¹¦é…ç½®" aria-hidden="true">#</a> 5.1 ç”Ÿæˆ etcd è¯ä¹¦é…ç½®</h3><div class="language-bash line-numbers-mode" data-ext="sh"><pre class="language-bash"><code><span class="token comment"># etcdè¯ä¹¦æ”¾åœ¨è¿™</span>
<span class="token function">mkdir</span> <span class="token parameter variable">-p</span> /etc/kubernetes/ca/etcd
<span class="token builtin class-name">cd</span> /etc/kubernetes/ca/etcd
<span class="token function">vim</span> etcd-csr.json
<span class="token comment"># æ–‡ä»¶å†…å®¹å¦‚ä¸‹</span>
<span class="token punctuation">{</span>
  <span class="token string">&quot;CN&quot;</span><span class="token builtin class-name">:</span> <span class="token string">&quot;etcd&quot;</span>,
  <span class="token string">&quot;hosts&quot;</span><span class="token builtin class-name">:</span> <span class="token punctuation">[</span>
    <span class="token string">&quot;127.0.0.1&quot;</span>,
    <span class="token string">&quot;192.168.10.102&quot;</span>
  <span class="token punctuation">]</span>,
  <span class="token string">&quot;key&quot;</span><span class="token builtin class-name">:</span> <span class="token punctuation">{</span>
    <span class="token string">&quot;algo&quot;</span><span class="token builtin class-name">:</span> <span class="token string">&quot;rsa&quot;</span>,
    <span class="token string">&quot;size&quot;</span><span class="token builtin class-name">:</span> <span class="token number">2048</span>
  <span class="token punctuation">}</span>,
  <span class="token string">&quot;names&quot;</span><span class="token builtin class-name">:</span> <span class="token punctuation">[</span>
    <span class="token punctuation">{</span>
      <span class="token string">&quot;C&quot;</span><span class="token builtin class-name">:</span> <span class="token string">&quot;CN&quot;</span>,
      <span class="token string">&quot;ST&quot;</span><span class="token builtin class-name">:</span> <span class="token string">&quot;Beijing&quot;</span>,
      <span class="token string">&quot;L&quot;</span><span class="token builtin class-name">:</span> <span class="token string">&quot;XS&quot;</span>,
      <span class="token string">&quot;O&quot;</span><span class="token builtin class-name">:</span> <span class="token string">&quot;k8s&quot;</span>,
      <span class="token string">&quot;OU&quot;</span><span class="token builtin class-name">:</span> <span class="token string">&quot;System&quot;</span>
    <span class="token punctuation">}</span>
  <span class="token punctuation">]</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>å­—æ®µè¯´æ˜</p><ul><li><code>hosts</code>ï¼šæŒ‡å®šæˆæƒä½¿ç”¨è¯¥è¯ä¹¦çš„ <strong>IP æˆ–åŸŸååˆ—è¡¨</strong>ï¼Œå¦‚æœæœ‰éƒ¨ç½²å¤šä¸ª etcdï¼Œé‚£ä¹ˆå°±éœ€è¦å¡«å…¥å…¶ä»– etcd çš„ <strong>IP æˆ–åŸŸååˆ—è¡¨</strong>ï¼Œæˆ‘è¿™é‡Œåªéƒ¨ç½²ä¸€å°æ‰€ä»¥å°±å†™ä¸€ä¸ªâ˜ï¸</li></ul><div class="hint-container tip"><p class="hint-container-title">æç¤º</p><p>æ³¨ï¼šä¸Šè¿°æ–‡ä»¶hostså­—æ®µä¸­IPä¸ºæ‰€æœ‰etcdèŠ‚ç‚¹çš„é›†ç¾¤å†…éƒ¨é€šä¿¡IPï¼Œä¸€ä¸ªéƒ½ä¸èƒ½å°‘ï¼ä¸ºäº†æ–¹ä¾¿åæœŸæ‰©å®¹å¯ä»¥å¤šå†™å‡ ä¸ªé¢„ç•™çš„IPã€‚</p></div><h3 id="_5-2-ä½¿ç”¨æ ¹è¯ä¹¦-ca-pem-ç­¾å‘etcdè¯ä¹¦" tabindex="-1"><a class="header-anchor" href="#_5-2-ä½¿ç”¨æ ¹è¯ä¹¦-ca-pem-ç­¾å‘etcdè¯ä¹¦" aria-hidden="true">#</a> 5.2 ä½¿ç”¨æ ¹è¯ä¹¦(ca.pem)ç­¾å‘etcdè¯ä¹¦</h3><div class="language-bash line-numbers-mode" data-ext="sh"><pre class="language-bash"><code>cfssl gencert <span class="token punctuation">\\</span>
        <span class="token parameter variable">-ca</span><span class="token operator">=</span>/etc/kubernetes/ca/ca.pem <span class="token punctuation">\\</span>
        -ca-key<span class="token operator">=</span>/etc/kubernetes/ca/ca-key.pem <span class="token punctuation">\\</span>
        <span class="token parameter variable">-config</span><span class="token operator">=</span>/etc/kubernetes/ca/ca-config.json <span class="token punctuation">\\</span>
        <span class="token parameter variable">-profile</span><span class="token operator">=</span>kubernetes etcd-csr.json <span class="token operator">|</span> cfssljson <span class="token parameter variable">-bare</span> etcd
   
<span class="token comment"># è·Ÿä¹‹å‰ç±»ä¼¼ç”Ÿæˆä¸‰ä¸ªæ–‡ä»¶etcd.csræ˜¯ä¸ªä¸­é—´è¯ä¹¦è¯·æ±‚æ–‡ä»¶ï¼Œæˆ‘ä»¬æœ€ç»ˆè¦çš„æ˜¯etcd-key.pemå’Œetcd.pem</span>
<span class="token operator">&gt;</span> <span class="token function">ls</span>
<span class="token operator">&gt;</span> etcd.csr  etcd-csr.json  etcd-key.pem  etcd.pem
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h2 id="å…­ã€åˆ›å»º-api-server-è¯ä¹¦" tabindex="-1"><a class="header-anchor" href="#å…­ã€åˆ›å»º-api-server-è¯ä¹¦" aria-hidden="true">#</a> å…­ã€åˆ›å»º Api-server è¯ä¹¦</h2><ul><li><strong>controller-managerï¼š</strong> ä¸€èˆ¬ä¸api-serveråœ¨åŒä¸€å°æœºå™¨ä¸Šï¼Œæ‰€ä»¥å¯ä»¥ä½¿ç”¨éå®‰å…¨ç«¯å£ä¸api-serveré€šè®¯ï¼Œä¸éœ€è¦ç”Ÿæˆè¯ä¹¦å’Œç§é’¥</li><li><strong>schedulerï¼š</strong> ä¸€èˆ¬ä¸apiserveråœ¨åŒä¸€å°æœºå™¨ä¸Šï¼Œæ‰€ä»¥å¯ä»¥ä½¿ç”¨éå®‰å…¨ç«¯å£ä¸apiserveré€šè®¯ã€‚ä¸éœ€è¦ç”Ÿæˆè¯ä¹¦å’Œç§é’¥ã€‚</li></ul><h3 id="_6-1-ç”Ÿæˆ-api-server-è¯ä¹¦é…ç½®" tabindex="-1"><a class="header-anchor" href="#_6-1-ç”Ÿæˆ-api-server-è¯ä¹¦é…ç½®" aria-hidden="true">#</a> 6.1 ç”Ÿæˆ Api-server è¯ä¹¦é…ç½®</h3><div class="language-bash line-numbers-mode" data-ext="sh"><pre class="language-bash"><code><span class="token comment"># api-serverè¯ä¹¦æ”¾åœ¨è¿™</span>
<span class="token function">mkdir</span> <span class="token parameter variable">-p</span> /etc/kubernetes/ca/server
<span class="token builtin class-name">cd</span> /etc/kubernetes/ca/server
<span class="token function">vim</span> server-csr.json
<span class="token comment"># å†…å®¹å¦‚ä¸‹</span>
<span class="token punctuation">{</span>
  <span class="token string">&quot;CN&quot;</span><span class="token builtin class-name">:</span> <span class="token string">&quot;kubernetes&quot;</span>,
  <span class="token string">&quot;hosts&quot;</span><span class="token builtin class-name">:</span> <span class="token punctuation">[</span>
    <span class="token string">&quot;127.0.0.1&quot;</span>,
    <span class="token string">&quot;10.0.0.1&quot;</span>,
    <span class="token string">&quot;192.168.10.101&quot;</span>,
    <span class="token string">&quot;192.168.10.102&quot;</span>,
    <span class="token string">&quot;192.168.10.103&quot;</span>,
    <span class="token string">&quot;kubernetes&quot;</span>,
    <span class="token string">&quot;kubernetes.default&quot;</span>,
    <span class="token string">&quot;kubernetes.default.svc&quot;</span>,
    <span class="token string">&quot;kubernetes.default.svc.cluster&quot;</span>,
    <span class="token string">&quot;kubernetes.default.svc.cluster.local&quot;</span>
  <span class="token punctuation">]</span>,
  <span class="token string">&quot;key&quot;</span><span class="token builtin class-name">:</span> <span class="token punctuation">{</span>
    <span class="token string">&quot;algo&quot;</span><span class="token builtin class-name">:</span> <span class="token string">&quot;rsa&quot;</span>,
    <span class="token string">&quot;size&quot;</span><span class="token builtin class-name">:</span> <span class="token number">2048</span>
  <span class="token punctuation">}</span>,
  <span class="token string">&quot;names&quot;</span><span class="token builtin class-name">:</span> <span class="token punctuation">[</span>
    <span class="token punctuation">{</span>
      <span class="token string">&quot;C&quot;</span><span class="token builtin class-name">:</span> <span class="token string">&quot;CN&quot;</span>,
      <span class="token string">&quot;ST&quot;</span><span class="token builtin class-name">:</span> <span class="token string">&quot;Beijing&quot;</span>,
      <span class="token string">&quot;L&quot;</span><span class="token builtin class-name">:</span> <span class="token string">&quot;XS&quot;</span>,
      <span class="token string">&quot;O&quot;</span><span class="token builtin class-name">:</span> <span class="token string">&quot;k8s&quot;</span>,
      <span class="token string">&quot;OU&quot;</span><span class="token builtin class-name">:</span> <span class="token string">&quot;System&quot;</span>
    <span class="token punctuation">}</span>
  <span class="token punctuation">]</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><ul><li><strong><code>kubernetes</code> æœåŠ¡çš„æœåŠ¡ IP</strong>ï¼ˆä¸€èˆ¬æ˜¯ <code>kube-apiserver</code> æŒ‡å®šçš„ <code>service-cluster-ip-range</code> ç½‘æ®µçš„ç¬¬ä¸€ä¸ªIPï¼Œå¦‚ 10.0.0.1ï¼‰</li></ul><h3 id="_6-2-ä½¿ç”¨æ ¹è¯ä¹¦-ca-pem-ç­¾å‘-apiserver-è¯ä¹¦" tabindex="-1"><a class="header-anchor" href="#_6-2-ä½¿ç”¨æ ¹è¯ä¹¦-ca-pem-ç­¾å‘-apiserver-è¯ä¹¦" aria-hidden="true">#</a> 6.2 ä½¿ç”¨æ ¹è¯ä¹¦(ca.pem)ç­¾å‘ apiserver è¯ä¹¦</h3><div class="language-bash line-numbers-mode" data-ext="sh"><pre class="language-bash"><code>cfssl gencert <span class="token punctuation">\\</span>
        <span class="token parameter variable">-ca</span><span class="token operator">=</span>/etc/kubernetes/ca/ca.pem <span class="token punctuation">\\</span>
        -ca-key<span class="token operator">=</span>/etc/kubernetes/ca/ca-key.pem <span class="token punctuation">\\</span>
        <span class="token parameter variable">-config</span><span class="token operator">=</span>/etc/kubernetes/ca/ca-config.json <span class="token punctuation">\\</span>
        <span class="token parameter variable">-profile</span><span class="token operator">=</span>kubernetes server-csr.json <span class="token operator">|</span> cfssljson <span class="token parameter variable">-bare</span> server
        
<span class="token comment"># è·Ÿä¹‹å‰ç±»ä¼¼ç”Ÿæˆä¸‰ä¸ªæ–‡ä»¶server.csræ˜¯ä¸ªä¸­é—´è¯ä¹¦è¯·æ±‚æ–‡ä»¶ï¼Œæˆ‘ä»¬æœ€ç»ˆè¦çš„æ˜¯server-key.pemå’Œserver.pem</span>
<span class="token operator">&gt;</span> <span class="token function">ls</span>
<span class="token operator">&gt;</span> server-csr.json server.csr server.pem server-key.pem
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h2 id="ä¸ƒã€åˆ›å»º-admin-è¯ä¹¦" tabindex="-1"><a class="header-anchor" href="#ä¸ƒã€åˆ›å»º-admin-è¯ä¹¦" aria-hidden="true">#</a> ä¸ƒã€åˆ›å»º Admin è¯ä¹¦</h2><h3 id="_7-1-ç”Ÿæˆ-admin-è¯ä¹¦é…ç½®" tabindex="-1"><a class="header-anchor" href="#_7-1-ç”Ÿæˆ-admin-è¯ä¹¦é…ç½®" aria-hidden="true">#</a> 7.1 ç”Ÿæˆ Admin è¯ä¹¦é…ç½®</h3><div class="language-bash line-numbers-mode" data-ext="sh"><pre class="language-bash"><code><span class="token comment"># kubectlè¯ä¹¦æ”¾åœ¨è¿™ï¼Œç”±äºkubectlç›¸å½“äºç³»ç»Ÿç®¡ç†å‘˜ï¼Œæˆ‘ä»¬ä½¿ç”¨adminå‘½å</span>
<span class="token function">mkdir</span> <span class="token parameter variable">-p</span> /etc/kubernetes/ca/admin
<span class="token builtin class-name">cd</span> /etc/kubernetes/ca/admin
<span class="token function">vim</span> admin-csr.json
<span class="token comment"># å†…å®¹å¦‚ä¸‹</span>
<span class="token punctuation">{</span>
  <span class="token string">&quot;CN&quot;</span><span class="token builtin class-name">:</span> <span class="token string">&quot;admin&quot;</span>,
  <span class="token string">&quot;hosts&quot;</span><span class="token builtin class-name">:</span> <span class="token punctuation">[</span><span class="token punctuation">]</span>,
  <span class="token string">&quot;key&quot;</span><span class="token builtin class-name">:</span> <span class="token punctuation">{</span>
    <span class="token string">&quot;algo&quot;</span><span class="token builtin class-name">:</span> <span class="token string">&quot;rsa&quot;</span>,
    <span class="token string">&quot;size&quot;</span><span class="token builtin class-name">:</span> <span class="token number">2048</span>
  <span class="token punctuation">}</span>,
  <span class="token string">&quot;names&quot;</span><span class="token builtin class-name">:</span> <span class="token punctuation">[</span>
    <span class="token punctuation">{</span>
      <span class="token string">&quot;C&quot;</span><span class="token builtin class-name">:</span> <span class="token string">&quot;CN&quot;</span>,
      <span class="token string">&quot;ST&quot;</span><span class="token builtin class-name">:</span> <span class="token string">&quot;BeiJing&quot;</span>,
      <span class="token string">&quot;L&quot;</span><span class="token builtin class-name">:</span> <span class="token string">&quot;BeiJing&quot;</span>,
      <span class="token string">&quot;O&quot;</span><span class="token builtin class-name">:</span> <span class="token string">&quot;system:masters&quot;</span>,
      <span class="token string">&quot;OU&quot;</span><span class="token builtin class-name">:</span> <span class="token string">&quot;System&quot;</span>
    <span class="token punctuation">}</span>
  <span class="token punctuation">]</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h3 id="_7-2-ä½¿ç”¨æ ¹è¯ä¹¦-ca-pem-ç­¾å‘adminè¯ä¹¦" tabindex="-1"><a class="header-anchor" href="#_7-2-ä½¿ç”¨æ ¹è¯ä¹¦-ca-pem-ç­¾å‘adminè¯ä¹¦" aria-hidden="true">#</a> 7.2 ä½¿ç”¨æ ¹è¯ä¹¦(ca.pem)ç­¾å‘adminè¯ä¹¦</h3><div class="language-bash line-numbers-mode" data-ext="sh"><pre class="language-bash"><code>cfssl gencert <span class="token punctuation">\\</span>
        <span class="token parameter variable">-ca</span><span class="token operator">=</span>/etc/kubernetes/ca/ca.pem <span class="token punctuation">\\</span>
        -ca-key<span class="token operator">=</span>/etc/kubernetes/ca/ca-key.pem <span class="token punctuation">\\</span>
        <span class="token parameter variable">-config</span><span class="token operator">=</span>/etc/kubernetes/ca/ca-config.json <span class="token punctuation">\\</span>
        <span class="token parameter variable">-profile</span><span class="token operator">=</span>kubernetes admin-csr.json <span class="token operator">|</span> cfssljson <span class="token parameter variable">-bare</span> admin
        
<span class="token comment"># æˆ‘ä»¬æœ€ç»ˆè¦çš„æ˜¯admin-key.pemå’Œadmin.pem</span>
<span class="token operator">&gt;</span> <span class="token function">ls</span>
<span class="token operator">&gt;</span> admin.csr  admin-csr.json  admin-key.pem  admin.pem
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h2 id="å…«ã€åˆ›å»º-kube-proxy-è¯ä¹¦" tabindex="-1"><a class="header-anchor" href="#å…«ã€åˆ›å»º-kube-proxy-è¯ä¹¦" aria-hidden="true">#</a> å…«ã€åˆ›å»º kube-proxy è¯ä¹¦</h2><h3 id="_8-1-ç”Ÿæˆ-kube-proxy-è¯ä¹¦é…ç½®" tabindex="-1"><a class="header-anchor" href="#_8-1-ç”Ÿæˆ-kube-proxy-è¯ä¹¦é…ç½®" aria-hidden="true">#</a> 8.1 ç”Ÿæˆ kube-proxy è¯ä¹¦é…ç½®</h3><div class="language-bash line-numbers-mode" data-ext="sh"><pre class="language-bash"><code><span class="token comment"># proxyè¯ä¹¦æ”¾åœ¨è¿™</span>
<span class="token function">mkdir</span> <span class="token parameter variable">-p</span> /etc/kubernetes/ca/kube-proxy
<span class="token builtin class-name">cd</span> /etc/kubernetes/ca/kube-proxy
<span class="token function">vim</span> kube-proxy-csr.json
<span class="token comment"># å†…å®¹å¦‚ä¸‹</span>
<span class="token punctuation">{</span>
  <span class="token string">&quot;CN&quot;</span><span class="token builtin class-name">:</span> <span class="token string">&quot;system:kube-proxy&quot;</span>,
  <span class="token string">&quot;hosts&quot;</span><span class="token builtin class-name">:</span> <span class="token punctuation">[</span><span class="token punctuation">]</span>,
  <span class="token string">&quot;key&quot;</span><span class="token builtin class-name">:</span> <span class="token punctuation">{</span>
    <span class="token string">&quot;algo&quot;</span><span class="token builtin class-name">:</span> <span class="token string">&quot;rsa&quot;</span>,
    <span class="token string">&quot;size&quot;</span><span class="token builtin class-name">:</span> <span class="token number">2048</span>
  <span class="token punctuation">}</span>,
  <span class="token string">&quot;names&quot;</span><span class="token builtin class-name">:</span> <span class="token punctuation">[</span>
    <span class="token punctuation">{</span>
      <span class="token string">&quot;C&quot;</span><span class="token builtin class-name">:</span> <span class="token string">&quot;CN&quot;</span>,
      <span class="token string">&quot;ST&quot;</span><span class="token builtin class-name">:</span> <span class="token string">&quot;Beijing&quot;</span>,
      <span class="token string">&quot;L&quot;</span><span class="token builtin class-name">:</span> <span class="token string">&quot;BeiJing&quot;</span>,
      <span class="token string">&quot;O&quot;</span><span class="token builtin class-name">:</span> <span class="token string">&quot;k8s&quot;</span>,
      <span class="token string">&quot;OU&quot;</span><span class="token builtin class-name">:</span> <span class="token string">&quot;System&quot;</span>
    <span class="token punctuation">}</span>
  <span class="token punctuation">]</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>å­—æ®µè¯´æ˜ï¼š</p><ul><li><p>CN æŒ‡å®šè¯¥è¯ä¹¦çš„ User ä¸º <code>system:kube-proxy</code></p></li><li><p><code>kube-apiserver</code> é¢„å®šä¹‰çš„ RoleBinding <code>system:node-proxy</code> å°†User <code>system:kube-proxy</code> ä¸ Role <code>system:node-proxier</code> ç»‘å®šï¼Œæˆäºˆäº†è°ƒç”¨ <code>kube-api-server</code> proxyçš„ç›¸å…³ API çš„æƒé™</p></li></ul><h3 id="_8-2-ä½¿ç”¨æ ¹è¯ä¹¦-ca-pem-ç­¾å‘proxyè¯ä¹¦" tabindex="-1"><a class="header-anchor" href="#_8-2-ä½¿ç”¨æ ¹è¯ä¹¦-ca-pem-ç­¾å‘proxyè¯ä¹¦" aria-hidden="true">#</a> 8.2 ä½¿ç”¨æ ¹è¯ä¹¦(ca.pem)ç­¾å‘proxyè¯ä¹¦</h3><div class="language-bash line-numbers-mode" data-ext="sh"><pre class="language-bash"><code>cfssl gencert <span class="token punctuation">\\</span>
        <span class="token parameter variable">-ca</span><span class="token operator">=</span>/etc/kubernetes/ca/ca.pem <span class="token punctuation">\\</span>
        -ca-key<span class="token operator">=</span>/etc/kubernetes/ca/ca-key.pem <span class="token punctuation">\\</span>
        <span class="token parameter variable">-config</span><span class="token operator">=</span>/etc/kubernetes/ca/ca-config.json <span class="token punctuation">\\</span>
        <span class="token parameter variable">-profile</span><span class="token operator">=</span>kubernetes kube-proxy-csr.json <span class="token operator">|</span> cfssljson <span class="token parameter variable">-bare</span> kube-proxy
        
<span class="token comment"># æˆ‘ä»¬æœ€ç»ˆè¦çš„æ˜¯kube-proxy-key.pemå’Œkube-proxy.pem</span>
<span class="token operator">&gt;</span> <span class="token function">ls</span>
<span class="token operator">&gt;</span> kube-proxy.csr  kube-proxy-csr.json  kube-proxy-key.pem  kube-proxy.pem
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h2 id="ä¹ã€åˆ†å‘è¯ä¹¦" tabindex="-1"><a class="header-anchor" href="#ä¹ã€åˆ†å‘è¯ä¹¦" aria-hidden="true">#</a> ä¹ã€åˆ†å‘è¯ä¹¦</h2><p>å°†ç”Ÿæˆçš„è¯ä¹¦å’Œç§˜é’¥æ–‡ä»¶ï¼ˆåç¼€åä¸º<code>.pem</code>ï¼‰æ‹·è´åˆ°æ‰€æœ‰æœºå™¨çš„ <code>/etc/kubernetes/ca</code> ç›®å½•ä¸‹å¤‡ç”¨ï¼›</p><div class="language-bash line-numbers-mode" data-ext="sh"><pre class="language-bash"><code><span class="token comment"># æœ€åæŸ¥çœ‹ç”Ÿæˆçš„è¯ä¹¦ç›®å½•</span>
<span class="token operator">&gt;</span> <span class="token function">ls</span> /etc/kubernetes/ca
<span class="token operator">&gt;</span> admin  ca-config.json  ca.csr  ca-csr.json  ca-key.pem  ca.pem  etcd  kube-proxy  apiserver
<span class="token comment"># åˆ†å‘è¯ä¹¦</span>
<span class="token function">scp</span> <span class="token parameter variable">-r</span> /etc/kubernetes/ca root@å…¶ä»–èŠ‚ç‚¹ip:/etc/kubernetes/
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h2 id="åã€å¯ç”¨-tls-bootstrapping-æœºåˆ¶" tabindex="-1"><a class="header-anchor" href="#åã€å¯ç”¨-tls-bootstrapping-æœºåˆ¶" aria-hidden="true">#</a> åã€å¯ç”¨ TLS Bootstrapping æœºåˆ¶</h2><p>TLS Bootstrapingï¼šMaster apiserverå¯ç”¨TLSè®¤è¯åï¼ŒNodeèŠ‚ç‚¹kubeletå’Œkube-proxyè¦ä¸kube-apiserverè¿›è¡Œé€šä¿¡ï¼Œå¿…é¡»ä½¿ç”¨CAç­¾å‘çš„æœ‰æ•ˆè¯ä¹¦æ‰å¯ä»¥ï¼Œå½“NodeèŠ‚ç‚¹å¾ˆå¤šæ—¶ï¼Œè¿™ç§å®¢æˆ·ç«¯è¯ä¹¦é¢å‘éœ€è¦å¤§é‡å·¥ä½œï¼ŒåŒæ ·ä¹Ÿä¼šå¢åŠ é›†ç¾¤æ‰©å±•å¤æ‚åº¦ã€‚ä¸ºäº†ç®€åŒ–æµç¨‹ï¼ŒKuberneteså¼•å…¥äº†TLS bootstrapingæœºåˆ¶æ¥è‡ªåŠ¨é¢å‘å®¢æˆ·ç«¯è¯ä¹¦ï¼Œkubeletä¼šä»¥ä¸€ä¸ªä½æƒé™ç”¨æˆ·è‡ªåŠ¨å‘apiserverç”³è¯·è¯ä¹¦ï¼Œkubeletçš„è¯ä¹¦ç”±apiserveråŠ¨æ€ç­¾ç½²ã€‚æ‰€ä»¥å¼ºçƒˆå»ºè®®åœ¨Nodeä¸Šä½¿ç”¨è¿™ç§æ–¹å¼ï¼Œç›®å‰ä¸»è¦ç”¨äºkubeletï¼Œkube-proxyè¿˜æ˜¯ç”±æˆ‘ä»¬ç»Ÿä¸€é¢å‘ä¸€ä¸ªè¯ä¹¦ã€‚</p><p><strong>TLS bootstraping å·¥ä½œæµç¨‹ï¼š</strong></p><img src="https://media.zenghr.cn/blog/img/TLS bootstraping å·¥ä½œæµç¨‹.png" alt="TLSbootstrapingå·¥ä½œæµç¨‹" style="zoom:67%;"><h3 id="_10-1-ç”Ÿæˆtokenè®¤è¯æ–‡ä»¶" tabindex="-1"><a class="header-anchor" href="#_10-1-ç”Ÿæˆtokenè®¤è¯æ–‡ä»¶" aria-hidden="true">#</a> 10.1 ç”Ÿæˆtokenè®¤è¯æ–‡ä»¶</h3><div class="language-bash line-numbers-mode" data-ext="sh"><pre class="language-bash"><code><span class="token comment"># ç”Ÿæˆéšæœºtoken</span>
<span class="token function">head</span> <span class="token parameter variable">-c</span> <span class="token number">16</span> /dev/urandom <span class="token operator">|</span> od <span class="token parameter variable">-An</span> <span class="token parameter variable">-t</span> x <span class="token operator">|</span> <span class="token function">tr</span> <span class="token parameter variable">-d</span> <span class="token string">&#39; &#39;</span>
<span class="token comment"># æŒ‰ç…§å›ºå®šæ ¼å¼å†™å…¥token.csvï¼Œæ³¨æ„æ›¿æ¢tokenå†…å®¹</span>
<span class="token builtin class-name">echo</span> <span class="token string">&quot;734883758a7159caba1d9501c22f1408,kubelet-bootstrap,10001,<span class="token entity" title="\\&quot;">\\&quot;</span>system:kubelet-bootstrap<span class="token entity" title="\\&quot;">\\&quot;</span>&quot;</span> <span class="token operator">&gt;</span> /etc/kubernetes/ca/server/token.csv
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div>`,70);function C(j,T){const e=l("router-link"),i=l("ExternalLinkIcon");return o(),p("div",null,[d,m,s("nav",v,[s("ul",null,[s("li",null,[a(e,{to:"#ä¸€ã€ç†è§£è®¤è¯æˆæƒ"},{default:t(()=>[n("ä¸€ã€ç†è§£è®¤è¯æˆæƒ")]),_:1}),s("ul",null,[s("li",null,[a(e,{to:"#_1-1-ä¸ºä»€ä¹ˆè¦è®¤è¯"},{default:t(()=>[n("1.1 ä¸ºä»€ä¹ˆè¦è®¤è¯")]),_:1})]),s("li",null,[a(e,{to:"#_1-2-æ¦‚å¿µæ¢³ç†"},{default:t(()=>[n("1.2 æ¦‚å¿µæ¢³ç†")]),_:1})]),s("li",null,[a(e,{to:"#_1-3-ä»€ä¹ˆæ˜¯æˆæƒ"},{default:t(()=>[n("1.3 ä»€ä¹ˆæ˜¯æˆæƒ")]),_:1})])])]),s("li",null,[a(e,{to:"#äºŒã€kubernetesçš„è®¤è¯æˆæƒ"},{default:t(()=>[n("äºŒã€kubernetesçš„è®¤è¯æˆæƒ")]),_:1}),s("ul",null,[s("li",null,[a(e,{to:"#_2-1-kubernetesçš„è®¤è¯"},{default:t(()=>[n("2.1 kubernetesçš„è®¤è¯")]),_:1})]),s("li",null,[a(e,{to:"#_2-2-kubernetesçš„æˆæƒ"},{default:t(()=>[n("2.2 kubernetesçš„æˆæƒ")]),_:1})]),s("li",null,[a(e,{to:"#_2-3-kubernetesçš„admissioncontrol"},{default:t(()=>[n("2.3 kubernetesçš„AdmissionControl")]),_:1})])])]),s("li",null,[a(e,{to:"#ä¸‰ã€å®‰è£…-cfssl"},{default:t(()=>[n("ä¸‰ã€å®‰è£… CFSSL")]),_:1})]),s("li",null,[a(e,{to:"#è¯ä¹¦ä½ç½®"},{default:t(()=>[n("è¯ä¹¦ä½ç½®")]),_:1})]),s("li",null,[a(e,{to:"#å››ã€åˆ›å»º-ca-æ ¹è¯ä¹¦"},{default:t(()=>[n("å››ã€åˆ›å»º CA (æ ¹è¯ä¹¦)")]),_:1}),s("ul",null,[s("li",null,[a(e,{to:"#_4-1-åˆ›å»º-ca-é…ç½®æ–‡ä»¶"},{default:t(()=>[n("4.1 åˆ›å»º CA é…ç½®æ–‡ä»¶")]),_:1})]),s("li",null,[a(e,{to:"#_4-2-åˆ›å»º-ca-è¯ä¹¦ç­¾åè¯·æ±‚"},{default:t(()=>[n("4.2 åˆ›å»º CA è¯ä¹¦ç­¾åè¯·æ±‚")]),_:1})]),s("li",null,[a(e,{to:"#_4-3-ç”Ÿæˆ-ca-è¯ä¹¦å’Œç§é’¥"},{default:t(()=>[n("4.3 ç”Ÿæˆ CA è¯ä¹¦å’Œç§é’¥")]),_:1})])])]),s("li",null,[a(e,{to:"#äº”ã€åˆ›å»º-etcd-è¯ä¹¦"},{default:t(()=>[n("äº”ã€åˆ›å»º ETCD è¯ä¹¦")]),_:1}),s("ul",null,[s("li",null,[a(e,{to:"#_5-1-ç”Ÿæˆ-etcd-è¯ä¹¦é…ç½®"},{default:t(()=>[n("5.1 ç”Ÿæˆ etcd è¯ä¹¦é…ç½®")]),_:1})]),s("li",null,[a(e,{to:"#_5-2-ä½¿ç”¨æ ¹è¯ä¹¦-ca-pem-ç­¾å‘etcdè¯ä¹¦"},{default:t(()=>[n("5.2 ä½¿ç”¨æ ¹è¯ä¹¦(ca.pem)ç­¾å‘etcdè¯ä¹¦")]),_:1})])])]),s("li",null,[a(e,{to:"#å…­ã€åˆ›å»º-api-server-è¯ä¹¦"},{default:t(()=>[n("å…­ã€åˆ›å»º Api-server è¯ä¹¦")]),_:1}),s("ul",null,[s("li",null,[a(e,{to:"#_6-1-ç”Ÿæˆ-api-server-è¯ä¹¦é…ç½®"},{default:t(()=>[n("6.1 ç”Ÿæˆ Api-server è¯ä¹¦é…ç½®")]),_:1})]),s("li",null,[a(e,{to:"#_6-2-ä½¿ç”¨æ ¹è¯ä¹¦-ca-pem-ç­¾å‘-apiserver-è¯ä¹¦"},{default:t(()=>[n("6.2 ä½¿ç”¨æ ¹è¯ä¹¦(ca.pem)ç­¾å‘ apiserver è¯ä¹¦")]),_:1})])])]),s("li",null,[a(e,{to:"#ä¸ƒã€åˆ›å»º-admin-è¯ä¹¦"},{default:t(()=>[n("ä¸ƒã€åˆ›å»º Admin è¯ä¹¦")]),_:1}),s("ul",null,[s("li",null,[a(e,{to:"#_7-1-ç”Ÿæˆ-admin-è¯ä¹¦é…ç½®"},{default:t(()=>[n("7.1 ç”Ÿæˆ Admin è¯ä¹¦é…ç½®")]),_:1})]),s("li",null,[a(e,{to:"#_7-2-ä½¿ç”¨æ ¹è¯ä¹¦-ca-pem-ç­¾å‘adminè¯ä¹¦"},{default:t(()=>[n("7.2 ä½¿ç”¨æ ¹è¯ä¹¦(ca.pem)ç­¾å‘adminè¯ä¹¦")]),_:1})])])]),s("li",null,[a(e,{to:"#å…«ã€åˆ›å»º-kube-proxy-è¯ä¹¦"},{default:t(()=>[n("å…«ã€åˆ›å»º kube-proxy è¯ä¹¦")]),_:1}),s("ul",null,[s("li",null,[a(e,{to:"#_8-1-ç”Ÿæˆ-kube-proxy-è¯ä¹¦é…ç½®"},{default:t(()=>[n("8.1 ç”Ÿæˆ kube-proxy è¯ä¹¦é…ç½®")]),_:1})]),s("li",null,[a(e,{to:"#_8-2-ä½¿ç”¨æ ¹è¯ä¹¦-ca-pem-ç­¾å‘proxyè¯ä¹¦"},{default:t(()=>[n("8.2 ä½¿ç”¨æ ¹è¯ä¹¦(ca.pem)ç­¾å‘proxyè¯ä¹¦")]),_:1})])])]),s("li",null,[a(e,{to:"#ä¹ã€åˆ†å‘è¯ä¹¦"},{default:t(()=>[n("ä¹ã€åˆ†å‘è¯ä¹¦")]),_:1})]),s("li",null,[a(e,{to:"#åã€å¯ç”¨-tls-bootstrapping-æœºåˆ¶"},{default:t(()=>[n("åã€å¯ç”¨ TLS Bootstrapping æœºåˆ¶")]),_:1}),s("ul",null,[s("li",null,[a(e,{to:"#_10-1-ç”Ÿæˆtokenè®¤è¯æ–‡ä»¶"},{default:t(()=>[n("10.1 ç”Ÿæˆtokenè®¤è¯æ–‡ä»¶")]),_:1})])])])])]),k,s("blockquote",null,[s("p",null,[n("è¯¥æ®µç†è§£å¼•ç”¨ "),s("a",b,[n("kubernetes-with-ca"),a(i)])])]),g,h,q,f,s("ul",null,[s("li",null,[_,n(" è¿™ä¸¤ä¸ªæ¦‚å¿µå±äºå¯†ç å­¦çš„ä¸œè¥¿ï¼Œå¯¹äºæ²¡æ¥è§¦è¿‡çš„åŒå­¦ä¸å¤ªå®¹æ˜“ç†è§£ã€‚å¯ä»¥å‚è€ƒçŸ¥ä¹å¤§ç¥çš„ç”ŸåŠ¨è®²è§£ï¼š"),s("a",x,[n("ã€Šå¦‚ä½•ç”¨é€šä¿—æ˜“æ‡‚çš„è¯æ¥è§£é‡Šéå¯¹ç§°åŠ å¯†ã€‹"),a(i)])]),s("li",null,[y,n(" äº†è§£äº†å¯¹ç§°åŠ å¯†å’Œéå¯¹ç§°åŠ å¯†åï¼Œæˆ‘ä»¬å°±å¯ä»¥äº†è§£ä¸€ä¸‹SSL/TLSäº†ã€‚åŒæ ·ï¼Œå·²ç»æœ‰å¤§ç¥æ€»ç»“äº†éå¸¸å¥½çš„å…¥é—¨æ–‡ç« ï¼š"),s("a",S,[n("ã€ŠSSL/TLSåè®®è¿è¡Œæœºåˆ¶çš„æ¦‚è¿°ã€‹"),a(i)])])]),A])}const N=c(u,[["render",C],["__file","01.åˆ›å»ºTLSè¯ä¹¦å’Œç§˜é’¥.html.vue"]]);export{N as default};
