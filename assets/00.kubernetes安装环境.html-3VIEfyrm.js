import{_ as n}from"./plugin-vue_export-helper-DlAUqK2U.js";import{c as t,a as i,b as e,d as l,w as r,r as p,o as h,i as d}from"./app-CLBazqBO.js";const k={};function c(o,s){const a=p("RouteLink");return h(),t("div",null,[s[2]||(s[2]=i(`<h1 id="在ubuntu上部署kubernetes集群" tabindex="-1"><a class="header-anchor" href="#在ubuntu上部署kubernetes集群"><span>在Ubuntu上部署kubernetes集群</span></a></h1><h2 id="_1-1-安装方式" tabindex="-1"><a class="header-anchor" href="#_1-1-安装方式"><span>1.1 安装方式</span></a></h2><ul><li><p>基于二进制的安装方式</p></li><li><p>基于官方工具kubeadm的安装方式 <a href="https://kubernetes.io/docs/reference/setup-tools/kubeadm/kubeadm/" target="_blank" rel="noopener noreferrer">官方地址</a></p></li><li><p>基于第三方工具的安装</p></li></ul><p>由于国内的网络环境问题，使用官方工具 kubeadm 需要解决网络问题，所以本系列文档将从 github 下载发行版的二进制包，手动部署每个组件，组成Kubernetes集群，同时开启了集群的TLS安全认证。而不是使用 <code>kubeadm</code> 等自动化方式来部署集群。</p><h2 id="_1-2-准备环境" tabindex="-1"><a class="header-anchor" href="#_1-2-准备环境"><span>1.2 准备环境</span></a></h2><p>这里准备了三台ubuntu虚拟机，每台一核cpu和2G内存，配置好root账户，并安装好了docker，后续的所有操作都是使用root账户。</p><p><strong>单Master架构图：</strong></p><img src="https://media.zenghr.cn/blog/img/单 Master 集群架构图.jpg" alt="单Master集群架构图"><p><strong>单Master服务器规划：</strong></p><table><thead><tr><th style="text-align:center;">系统类型</th><th style="text-align:center;">IP地址</th><th style="text-align:center;">节点角色</th><th style="text-align:center;">Hostname</th><th style="text-align:center;">组件</th></tr></thead><tbody><tr><td style="text-align:center;">Ubuntu18.04</td><td style="text-align:center;">192.168.10.101</td><td style="text-align:center;">worker</td><td style="text-align:center;">server01</td><td style="text-align:center;">kubelet，kube-proxy，docker, etcd</td></tr><tr><td style="text-align:center;">Ubuntu18.04</td><td style="text-align:center;">192.168.10.102</td><td style="text-align:center;">worker</td><td style="text-align:center;">server02</td><td style="text-align:center;">kube-apiserver，kube-controller-manager，kube-scheduler，docker, etcd</td></tr><tr><td style="text-align:center;">Ubuntu18.04</td><td style="text-align:center;">192.168.10.103</td><td style="text-align:center;">worker</td><td style="text-align:center;">server03</td><td style="text-align:center;">kubelet，kube-proxy，docker, etcd</td></tr></tbody></table><blockquote><p><strong>先部署一套单Master架构（192.168.10.101/102/103）</strong></p></blockquote><h2 id="_1-3-操作系统初始化配置-每个虚拟机" tabindex="-1"><a class="header-anchor" href="#_1-3-操作系统初始化配置-每个虚拟机"><span>1.3 操作系统初始化配置(每个虚拟机)</span></a></h2><div class="language-bash line-numbers-mode" data-highlighter="shiki" data-ext="bash" style="--shiki-light:#abb2bf;--shiki-dark:#abb2bf;--shiki-light-bg:#282c34;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes one-dark-pro one-dark-pro vp-code"><code><span class="line"><span style="--shiki-light:#7F848E;--shiki-light-font-style:italic;--shiki-dark:#7F848E;--shiki-dark-font-style:italic;"># 关闭防火墙</span></span>
<span class="line"><span style="--shiki-light:#61AFEF;--shiki-dark:#61AFEF;">ufw</span><span style="--shiki-light:#98C379;--shiki-dark:#98C379;"> disable</span></span>
<span class="line"><span style="--shiki-light:#7F848E;--shiki-light-font-style:italic;--shiki-dark:#7F848E;--shiki-dark-font-style:italic;"># 查看状态</span></span>
<span class="line"><span style="--shiki-light:#61AFEF;--shiki-dark:#61AFEF;">ufw</span><span style="--shiki-light:#98C379;--shiki-dark:#98C379;"> status</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#7F848E;--shiki-light-font-style:italic;--shiki-dark:#7F848E;--shiki-dark-font-style:italic;"># 关闭swap</span></span>
<span class="line"><span style="--shiki-light:#61AFEF;--shiki-dark:#61AFEF;">swapoff</span><span style="--shiki-light:#D19A66;--shiki-dark:#D19A66;"> -a</span><span style="--shiki-light:#7F848E;--shiki-light-font-style:italic;--shiki-dark:#7F848E;--shiki-dark-font-style:italic;">  # 临时</span></span>
<span class="line"><span style="--shiki-light:#61AFEF;--shiki-dark:#61AFEF;">sed</span><span style="--shiki-light:#D19A66;--shiki-dark:#D19A66;"> -ri</span><span style="--shiki-light:#98C379;--shiki-dark:#98C379;"> &#39;s/.*swap.*/#&amp;/&#39;</span><span style="--shiki-light:#98C379;--shiki-dark:#98C379;"> /etc/fstab</span><span style="--shiki-light:#7F848E;--shiki-light-font-style:italic;--shiki-dark:#7F848E;--shiki-dark-font-style:italic;">    # 永久</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#7F848E;--shiki-light-font-style:italic;--shiki-dark:#7F848E;--shiki-dark-font-style:italic;"># 根据规划设置主机名</span></span>
<span class="line"><span style="--shiki-light:#61AFEF;--shiki-dark:#61AFEF;">hostnamectl</span><span style="--shiki-light:#98C379;--shiki-dark:#98C379;"> set-hostname</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;"> &lt;</span><span style="--shiki-light:#98C379;--shiki-dark:#98C379;">hostnam</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">e&gt;</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#7F848E;--shiki-light-font-style:italic;--shiki-dark:#7F848E;--shiki-dark-font-style:italic;"># 设置固定 IP ==================</span></span>
<span class="line"><span style="--shiki-light:#7F848E;--shiki-light-font-style:italic;--shiki-dark:#7F848E;--shiki-dark-font-style:italic;"># 网卡信息配置在/etc/netplan/xxx.yaml文件，需做如下配置，如下配置</span></span>
<span class="line"><span style="--shiki-light:#61AFEF;--shiki-dark:#61AFEF;">network:</span></span>
<span class="line"><span style="--shiki-light:#61AFEF;--shiki-dark:#61AFEF;">  ethernets:</span></span>
<span class="line"><span style="--shiki-light:#61AFEF;--shiki-dark:#61AFEF;">    enp0s5:</span></span>
<span class="line"><span style="--shiki-light:#61AFEF;--shiki-dark:#61AFEF;">      dhcp4:</span><span style="--shiki-light:#D19A66;--shiki-dark:#D19A66;"> false</span></span>
<span class="line"><span style="--shiki-light:#61AFEF;--shiki-dark:#61AFEF;">      addresses:</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;"> [192.168.10.103/24]</span></span>
<span class="line"><span style="--shiki-light:#61AFEF;--shiki-dark:#61AFEF;">      gateway4:</span><span style="--shiki-light:#D19A66;--shiki-dark:#D19A66;"> 192.168.10.1</span></span>
<span class="line"><span style="--shiki-light:#61AFEF;--shiki-dark:#61AFEF;">      nameservers:</span></span>
<span class="line"><span style="--shiki-light:#61AFEF;--shiki-dark:#61AFEF;">        addresses:</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;"> [192.168.10.1]</span></span>
<span class="line"><span style="--shiki-light:#61AFEF;--shiki-dark:#61AFEF;">  version:</span><span style="--shiki-light:#D19A66;--shiki-dark:#D19A66;"> 2</span></span>
<span class="line"><span style="--shiki-light:#7F848E;--shiki-light-font-style:italic;--shiki-dark:#7F848E;--shiki-dark-font-style:italic;"># 然后使用以下命令使配置即时生效</span></span>
<span class="line"><span style="--shiki-light:#61AFEF;--shiki-dark:#61AFEF;">netplan</span><span style="--shiki-light:#98C379;--shiki-dark:#98C379;"> apply</span></span>
<span class="line"><span style="--shiki-light:#7F848E;--shiki-light-font-style:italic;--shiki-dark:#7F848E;--shiki-dark-font-style:italic;"># ===========================</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#7F848E;--shiki-light-font-style:italic;--shiki-dark:#7F848E;--shiki-dark-font-style:italic;"># 添加hosts</span></span>
<span class="line"><span style="--shiki-light:#61AFEF;--shiki-dark:#61AFEF;">cat</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;"> &gt;&gt; </span><span style="--shiki-light:#98C379;--shiki-dark:#98C379;">/etc/hosts</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;"> &lt;&lt; </span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">EOF</span></span>
<span class="line"><span style="--shiki-light:#98C379;--shiki-dark:#98C379;">192.168.10.101 server01</span></span>
<span class="line"><span style="--shiki-light:#98C379;--shiki-dark:#98C379;">192.168.10.102 server02</span></span>
<span class="line"><span style="--shiki-light:#98C379;--shiki-dark:#98C379;">192.168.10.103 server03</span></span>
<span class="line"><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">EOF</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#7F848E;--shiki-light-font-style:italic;--shiki-dark:#7F848E;--shiki-dark-font-style:italic;"># 将桥接的IPv4流量传递到iptables的链</span></span>
<span class="line"><span style="--shiki-light:#61AFEF;--shiki-dark:#61AFEF;">cat</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;"> &lt;&lt;</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">EOF</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;"> &gt; </span><span style="--shiki-light:#98C379;--shiki-dark:#98C379;">/etc/sysctl.d/k8s.conf</span></span>
<span class="line"><span style="--shiki-light:#98C379;--shiki-dark:#98C379;">net.ipv4.ip_forward = 1</span></span>
<span class="line"><span style="--shiki-light:#98C379;--shiki-dark:#98C379;">net.bridge.bridge-nf-call-ip6tables = 1</span></span>
<span class="line"><span style="--shiki-light:#98C379;--shiki-dark:#98C379;">net.bridge.bridge-nf-call-iptables = 1</span></span>
<span class="line"><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">EOF</span></span>
<span class="line"><span style="--shiki-light:#7F848E;--shiki-light-font-style:italic;--shiki-dark:#7F848E;--shiki-dark-font-style:italic;"># 生效配置文件</span></span>
<span class="line"><span style="--shiki-light:#61AFEF;--shiki-dark:#61AFEF;">sysctl</span><span style="--shiki-light:#D19A66;--shiki-dark:#D19A66;"> -p</span><span style="--shiki-light:#98C379;--shiki-dark:#98C379;"> /etc/sysctl.d/k8s.conf</span></span>
<span class="line"><span style="--shiki-light:#7F848E;--shiki-light-font-style:italic;--shiki-dark:#7F848E;--shiki-dark-font-style:italic;"># 或者</span></span>
<span class="line"><span style="--shiki-light:#61AFEF;--shiki-dark:#61AFEF;">sysctl</span><span style="--shiki-light:#D19A66;--shiki-dark:#D19A66;"> --system</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#7F848E;--shiki-light-font-style:italic;--shiki-dark:#7F848E;--shiki-dark-font-style:italic;"># 时间同步</span></span>
<span class="line"><span style="--shiki-light:#61AFEF;--shiki-dark:#61AFEF;">apt</span><span style="--shiki-light:#98C379;--shiki-dark:#98C379;"> install</span><span style="--shiki-light:#98C379;--shiki-dark:#98C379;"> ntpdate</span></span>
<span class="line"><span style="--shiki-light:#61AFEF;--shiki-dark:#61AFEF;">ntpdate</span><span style="--shiki-light:#98C379;--shiki-dark:#98C379;"> time.windows.com</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h2 id="步骤介绍" tabindex="-1"><a class="header-anchor" href="#步骤介绍"><span>步骤介绍</span></a></h2>`,14)),e("ol",null,[e("li",null,[l(a,{to:"/passages/2020-08-12-kubernetes-generate-tls.html"},{default:r(()=>s[0]||(s[0]=[d("创建 TLS 证书和秘钥")])),_:1})]),s[1]||(s[1]=i('<li><a href="/passages/2020-02-24-docker-install">安装 docker</a></li><li><a href="/passages/2020-08-12-kubernetes-deploy-etcd">创建高可用etcd集群</a></li><li><a href="/passages/2020-08-12-kubernetes-deploy-master">部署master节点</a></li><li><a href="/passages/2020-08-13-kubernetes-deploy-worker">部署Node节点</a></li><li><a href="/passages/2020-08-13-kubernetes-deploy-cni">部署CNI 网络</a></li><li><a href="/passages/2020-08-13-kubernetes-deploy-dns">部署CoreDns</a></li>',6))])])}const u=n(k,[["render",c]]),b=JSON.parse('{"path":"/tool/kubernetes/00.kubernetes%E5%AE%89%E8%A3%85%E7%8E%AF%E5%A2%83.html","title":"准备环境","lang":"zh-CN","frontmatter":{"title":"准备环境","date":"2020-08-12T16:14:00.000Z","re":"2020-08-12-kubernetes-deploy-ready","category":["kubernetes"],"description":"在Ubuntu上部署kubernetes集群 1.1 安装方式 基于二进制的安装方式 基于官方工具kubeadm的安装方式 官方地址 基于第三方工具的安装 由于国内的网络环境问题，使用官方工具 kubeadm 需要解决网络问题，所以本系列文档将从 github 下载发行版的二进制包，手动部署每个组件，组成Kubernetes集群，同时开启了集群的TLS...","permalink":"/passages/2020-08-12-kubernetes-deploy-ready.html","head":[["meta",{"property":"og:url","content":"https://blog.zenghr.cn/passages/2020-08-12-kubernetes-deploy-ready.html"}],["meta",{"property":"og:site_name","content":"Zenghr"}],["meta",{"property":"og:title","content":"准备环境"}],["meta",{"property":"og:description","content":"在Ubuntu上部署kubernetes集群 1.1 安装方式 基于二进制的安装方式 基于官方工具kubeadm的安装方式 官方地址 基于第三方工具的安装 由于国内的网络环境问题，使用官方工具 kubeadm 需要解决网络问题，所以本系列文档将从 github 下载发行版的二进制包，手动部署每个组件，组成Kubernetes集群，同时开启了集群的TLS..."}],["meta",{"property":"og:type","content":"article"}],["meta",{"property":"og:locale","content":"zh-CN"}],["meta",{"property":"og:updated_time","content":"2025-04-07T19:41:43.000Z"}],["meta",{"property":"article:published_time","content":"2020-08-12T16:14:00.000Z"}],["meta",{"property":"article:modified_time","content":"2025-04-07T19:41:43.000Z"}],["script",{"type":"application/ld+json"},"{\\"@context\\":\\"https://schema.org\\",\\"@type\\":\\"Article\\",\\"headline\\":\\"准备环境\\",\\"image\\":[\\"\\"],\\"datePublished\\":\\"2020-08-12T16:14:00.000Z\\",\\"dateModified\\":\\"2025-04-07T19:41:43.000Z\\",\\"author\\":[{\\"@type\\":\\"Person\\",\\"name\\":\\"Zenghr\\"}]}"]]},"git":{"createdTime":1744054903000,"updatedTime":1744054903000,"contributors":[{"name":"zenghr","username":"zenghr","email":"zenghr","commits":1,"url":"https://github.com/zenghr"}]},"readingTime":{"minutes":1.89,"words":568},"filePathRelative":"tool/kubernetes/00.kubernetes安装环境.md","localizedDate":"2020年8月12日","excerpt":"\\n<h2>1.1 安装方式</h2>\\n<ul>\\n<li>\\n<p>基于二进制的安装方式</p>\\n</li>\\n<li>\\n<p>基于官方工具kubeadm的安装方式 <a href=\\"https://kubernetes.io/docs/reference/setup-tools/kubeadm/kubeadm/\\" target=\\"_blank\\" rel=\\"noopener noreferrer\\">官方地址</a></p>\\n</li>\\n<li>\\n<p>基于第三方工具的安装</p>\\n</li>\\n</ul>\\n<p>由于国内的网络环境问题，使用官方工具 kubeadm 需要解决网络问题，所以本系列文档将从 github 下载发行版的二进制包，手动部署每个组件，组成Kubernetes集群，同时开启了集群的TLS安全认证。而不是使用 <code>kubeadm</code> 等自动化方式来部署集群。</p>","autoDesc":true}');export{u as comp,b as data};
