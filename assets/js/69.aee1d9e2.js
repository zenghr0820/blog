(window.webpackJsonp=window.webpackJsonp||[]).push([[69],{416:function(t,e,s){"use strict";s.r(e);var a=s(2),n=Object(a.a)({},(function(){var t=this,e=t._self._c;return e("ContentSlotsDistributor",{attrs:{"slot-key":t.$parent.slotKey}},[e("h1",{attrs:{id:"在ubuntu上部署kubernetes集群"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#在ubuntu上部署kubernetes集群"}},[t._v("#")]),t._v(" 在Ubuntu上部署kubernetes集群")]),t._v(" "),e("h2",{attrs:{id:"_1-1-安装方式"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#_1-1-安装方式"}},[t._v("#")]),t._v(" 1.1 安装方式")]),t._v(" "),e("ul",[e("li",[e("p",[t._v("基于二进制的安装方式")])]),t._v(" "),e("li",[e("p",[t._v("基于官方工具kubeadm的安装方式 "),e("a",{attrs:{href:"https://kubernetes.io/docs/reference/setup-tools/kubeadm/kubeadm/",target:"_blank",rel:"noopener noreferrer"}},[t._v("官方地址"),e("OutboundLink")],1)])]),t._v(" "),e("li",[e("p",[t._v("基于第三方工具的安装")])])]),t._v(" "),e("p",[t._v("由于国内的网络环境问题，使用官方工具 kubeadm 需要解决网络问题，所以本系列文档将从 github 下载发行版的二进制包，手动部署每个组件，组成Kubernetes集群，同时开启了集群的TLS安全认证。而不是使用 "),e("code",[t._v("kubeadm")]),t._v(" 等自动化方式来部署集群。")]),t._v(" "),e("h2",{attrs:{id:"_1-2-准备环境"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#_1-2-准备环境"}},[t._v("#")]),t._v(" 1.2 准备环境")]),t._v(" "),e("p",[t._v("这里准备了三台ubuntu虚拟机，每台一核cpu和2G内存，配置好root账户，并安装好了docker，后续的所有操作都是使用root账户。")]),t._v(" "),e("p",[e("strong",[t._v("单Master架构图：")])]),t._v(" "),e("img",{attrs:{src:"https://media.zenghr.cn/blog/img/单 Master 集群架构图.jpg",alt:"单Master集群架构图"}}),t._v(" "),e("p",[e("strong",[t._v("单Master服务器规划：")])]),t._v(" "),e("table",[e("thead",[e("tr",[e("th",{staticStyle:{"text-align":"center"}},[t._v("系统类型")]),t._v(" "),e("th",{staticStyle:{"text-align":"center"}},[t._v("IP地址")]),t._v(" "),e("th",{staticStyle:{"text-align":"center"}},[t._v("节点角色")]),t._v(" "),e("th",{staticStyle:{"text-align":"center"}},[t._v("Hostname")]),t._v(" "),e("th",{staticStyle:{"text-align":"center"}},[t._v("组件")])])]),t._v(" "),e("tbody",[e("tr",[e("td",{staticStyle:{"text-align":"center"}},[t._v("Ubuntu18.04")]),t._v(" "),e("td",{staticStyle:{"text-align":"center"}},[t._v("192.168.10.101")]),t._v(" "),e("td",{staticStyle:{"text-align":"center"}},[t._v("worker")]),t._v(" "),e("td",{staticStyle:{"text-align":"center"}},[t._v("server01")]),t._v(" "),e("td",{staticStyle:{"text-align":"center"}},[t._v("kubelet，kube-proxy，docker,  etcd")])]),t._v(" "),e("tr",[e("td",{staticStyle:{"text-align":"center"}},[t._v("Ubuntu18.04")]),t._v(" "),e("td",{staticStyle:{"text-align":"center"}},[t._v("192.168.10.102")]),t._v(" "),e("td",{staticStyle:{"text-align":"center"}},[t._v("worker")]),t._v(" "),e("td",{staticStyle:{"text-align":"center"}},[t._v("server02")]),t._v(" "),e("td",{staticStyle:{"text-align":"center"}},[t._v("kube-apiserver，kube-controller-manager，kube-scheduler，docker, etcd")])]),t._v(" "),e("tr",[e("td",{staticStyle:{"text-align":"center"}},[t._v("Ubuntu18.04")]),t._v(" "),e("td",{staticStyle:{"text-align":"center"}},[t._v("192.168.10.103")]),t._v(" "),e("td",{staticStyle:{"text-align":"center"}},[t._v("worker")]),t._v(" "),e("td",{staticStyle:{"text-align":"center"}},[t._v("server03")]),t._v(" "),e("td",{staticStyle:{"text-align":"center"}},[t._v("kubelet，kube-proxy，docker,  etcd")])])])]),t._v(" "),e("blockquote",[e("p",[e("strong",[t._v("先部署一套单Master架构（192.168.10.101/102/103）")])])]),t._v(" "),e("h2",{attrs:{id:"_1-3-操作系统初始化配置-每个虚拟机"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#_1-3-操作系统初始化配置-每个虚拟机"}},[t._v("#")]),t._v(" 1.3 操作系统初始化配置(每个虚拟机)")]),t._v(" "),e("div",{staticClass:"language-bash extra-class"},[e("pre",{pre:!0,attrs:{class:"language-bash"}},[e("code",[e("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# 关闭防火墙")]),t._v("\nufw disable\n"),e("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# 查看状态")]),t._v("\nufw status\n\n"),e("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# 关闭swap")]),t._v("\nswapoff "),e("span",{pre:!0,attrs:{class:"token parameter variable"}},[t._v("-a")]),t._v("  "),e("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# 临时")]),t._v("\n"),e("span",{pre:!0,attrs:{class:"token function"}},[t._v("sed")]),t._v(" "),e("span",{pre:!0,attrs:{class:"token parameter variable"}},[t._v("-ri")]),t._v(" "),e("span",{pre:!0,attrs:{class:"token string"}},[t._v("'s/.*swap.*/#&/'")]),t._v(" /etc/fstab    "),e("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# 永久")]),t._v("\n\n"),e("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# 根据规划设置主机名")]),t._v("\nhostnamectl set-hostname "),e("span",{pre:!0,attrs:{class:"token operator"}},[t._v("<")]),t._v("hostname"),e("span",{pre:!0,attrs:{class:"token operator"}},[t._v(">")]),t._v("\n\n"),e("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# 设置固定 IP ==================")]),t._v("\n"),e("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# 网卡信息配置在/etc/netplan/xxx.yaml文件，需做如下配置，如下配置")]),t._v("\nnetwork:\n  ethernets:\n    enp0s5:\n      dhcp4: "),e("span",{pre:!0,attrs:{class:"token boolean"}},[t._v("false")]),t._v("\n      addresses: "),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),e("span",{pre:!0,attrs:{class:"token number"}},[t._v("192.168")]),t._v(".10.103/24"),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),t._v("\n      gateway4: "),e("span",{pre:!0,attrs:{class:"token number"}},[t._v("192.168")]),t._v(".10.1\n      nameservers:\n        addresses: "),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),e("span",{pre:!0,attrs:{class:"token number"}},[t._v("192.168")]),t._v(".10.1"),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),t._v("\n  version: "),e("span",{pre:!0,attrs:{class:"token number"}},[t._v("2")]),t._v("\n"),e("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# 然后使用以下命令使配置即时生效")]),t._v("\nnetplan apply\n"),e("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# ===========================")]),t._v("\n\n"),e("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# 添加hosts")]),t._v("\n"),e("span",{pre:!0,attrs:{class:"token function"}},[t._v("cat")]),t._v(" "),e("span",{pre:!0,attrs:{class:"token operator"}},[t._v(">>")]),t._v(" /etc/hosts "),e("span",{pre:!0,attrs:{class:"token operator"}},[t._v("<<")]),t._v(" "),e("span",{pre:!0,attrs:{class:"token string"}},[t._v("EOF\n192.168.10.101 server01\n192.168.10.102 server02\n192.168.10.103 server03\nEOF")]),t._v("\n\n"),e("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# 将桥接的IPv4流量传递到iptables的链")]),t._v("\n"),e("span",{pre:!0,attrs:{class:"token function"}},[t._v("cat")]),t._v(" "),e("span",{pre:!0,attrs:{class:"token operator"}},[t._v("<<")]),e("span",{pre:!0,attrs:{class:"token string"}},[t._v("EOF"),e("span",{pre:!0,attrs:{class:"token bash punctuation"}},[t._v(" "),e("span",{pre:!0,attrs:{class:"token operator"}},[t._v(">")]),t._v(" /etc/sysctl.d/k8s.conf")]),t._v("\nnet.ipv4.ip_forward = 1\nnet.bridge.bridge-nf-call-ip6tables = 1\nnet.bridge.bridge-nf-call-iptables = 1\nEOF")]),t._v("\n"),e("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# 生效配置文件")]),t._v("\n"),e("span",{pre:!0,attrs:{class:"token function"}},[t._v("sysctl")]),t._v(" "),e("span",{pre:!0,attrs:{class:"token parameter variable"}},[t._v("-p")]),t._v(" /etc/sysctl.d/k8s.conf\n"),e("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# 或者")]),t._v("\n"),e("span",{pre:!0,attrs:{class:"token function"}},[t._v("sysctl")]),t._v(" "),e("span",{pre:!0,attrs:{class:"token parameter variable"}},[t._v("--system")]),t._v("\n\n"),e("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# 时间同步")]),t._v("\n"),e("span",{pre:!0,attrs:{class:"token function"}},[t._v("apt")]),t._v(" "),e("span",{pre:!0,attrs:{class:"token function"}},[t._v("install")]),t._v(" ntpdate\nntpdate time.windows.com\n")])])]),e("h2",{attrs:{id:"步骤介绍"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#步骤介绍"}},[t._v("#")]),t._v(" 步骤介绍")]),t._v(" "),e("ol",[e("li",[e("RouterLink",{attrs:{to:"/passages/2020-08-12-kubernetes-generate-tls.html"}},[t._v("创建 TLS 证书和秘钥")])],1),t._v(" "),e("li",[e("a",{attrs:{href:"/passages/2020-02-24-docker-install"}},[t._v("安装 docker")])]),t._v(" "),e("li",[e("a",{attrs:{href:"/passages/2020-08-12-kubernetes-deploy-etcd"}},[t._v("创建高可用etcd集群")])]),t._v(" "),e("li",[e("a",{attrs:{href:"/passages/2020-08-12-kubernetes-deploy-master"}},[t._v("部署master节点")])]),t._v(" "),e("li",[e("a",{attrs:{href:"/passages/2020-08-13-kubernetes-deploy-worker"}},[t._v("部署Node节点")])]),t._v(" "),e("li",[e("a",{attrs:{href:"/passages/2020-08-13-kubernetes-deploy-cni"}},[t._v("部署CNI 网络")])]),t._v(" "),e("li",[e("a",{attrs:{href:"/passages/2020-08-13-kubernetes-deploy-dns"}},[t._v("部署CoreDns")])])])])}),[],!1,null,null,null);e.default=n.exports}}]);