(window.webpackJsonp=window.webpackJsonp||[]).push([[63],{411:function(s,t,a){"use strict";a.r(t);var e=a(2),n=Object(e.a)({},(function(){var s=this,t=s._self._c;return t("ContentSlotsDistributor",{attrs:{"slot-key":s.$parent.slotKey}},[t("h1",{attrs:{id:"åˆ›å»ºtlsè¯ä¹¦å’Œç§˜é’¥"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#åˆ›å»ºtlsè¯ä¹¦å’Œç§˜é’¥"}},[s._v("#")]),s._v(" åˆ›å»ºTLSè¯ä¹¦å’Œç§˜é’¥")]),s._v(" "),t("p",[t("strong",[s._v("å¦‚æœæ‚¨ä¸æƒ³çœ‹è®¤è¯æˆæƒçš„è§£é‡Šï¼Œè¯·ç›´æ¥çœ‹")]),s._v(" "),t("a",{attrs:{href:"#%E4%B8%89%E3%80%81%E5%AE%89%E8%A3%85-cfssl"}},[s._v("å®‰è£… CFSSL")])]),s._v(" "),t("p"),t("div",{staticClass:"table-of-contents"},[t("ul",[t("li",[t("a",{attrs:{href:"#åˆ›å»ºtlsè¯ä¹¦å’Œç§˜é’¥"}},[s._v("åˆ›å»ºTLSè¯ä¹¦å’Œç§˜é’¥")]),t("ul",[t("li",[t("a",{attrs:{href:"#ä¸€ã€ç†è§£è®¤è¯æˆæƒ"}},[s._v("ä¸€ã€ç†è§£è®¤è¯æˆæƒ")]),t("ul",[t("li",[t("a",{attrs:{href:"#_1-1-ä¸ºä»€ä¹ˆè¦è®¤è¯"}},[s._v("1.1 ä¸ºä»€ä¹ˆè¦è®¤è¯")])]),t("li",[t("a",{attrs:{href:"#_1-2-æ¦‚å¿µæ¢³ç†"}},[s._v("1.2 æ¦‚å¿µæ¢³ç†")])]),t("li",[t("a",{attrs:{href:"#_1-3-ä»€ä¹ˆæ˜¯æˆæƒ"}},[s._v("1.3 ä»€ä¹ˆæ˜¯æˆæƒ")])])])]),t("li",[t("a",{attrs:{href:"#äºŒã€kubernetesçš„è®¤è¯æˆæƒ"}},[s._v("äºŒã€kubernetesçš„è®¤è¯æˆæƒ")]),t("ul",[t("li",[t("a",{attrs:{href:"#_2-1-kubernetesçš„è®¤è¯"}},[s._v("2.1 kubernetesçš„è®¤è¯")])]),t("li",[t("a",{attrs:{href:"#_2-2-kubernetesçš„æˆæƒ"}},[s._v("2.2 kubernetesçš„æˆæƒ")])]),t("li",[t("a",{attrs:{href:"#_2-3-kubernetesçš„admissioncontrol"}},[s._v("2.3 kubernetesçš„AdmissionControl")])])])]),t("li",[t("a",{attrs:{href:"#ä¸‰ã€å®‰è£…-cfssl"}},[s._v("ä¸‰ã€å®‰è£… CFSSL")])]),t("li",[t("a",{attrs:{href:"#è¯ä¹¦ä½ç½®"}},[s._v("è¯ä¹¦ä½ç½®")])]),t("li",[t("a",{attrs:{href:"#å››ã€åˆ›å»º-ca-æ ¹è¯ä¹¦"}},[s._v("å››ã€åˆ›å»º CA (æ ¹è¯ä¹¦)")]),t("ul",[t("li",[t("a",{attrs:{href:"#_4-1-åˆ›å»º-ca-é…ç½®æ–‡ä»¶"}},[s._v("4.1 åˆ›å»º CA é…ç½®æ–‡ä»¶")])]),t("li",[t("a",{attrs:{href:"#_4-2-åˆ›å»º-ca-è¯ä¹¦ç­¾åè¯·æ±‚"}},[s._v("4.2 åˆ›å»º CA è¯ä¹¦ç­¾åè¯·æ±‚")])]),t("li",[t("a",{attrs:{href:"#_4-3-ç”Ÿæˆ-ca-è¯ä¹¦å’Œç§é’¥"}},[s._v("4.3 ç”Ÿæˆ CA è¯ä¹¦å’Œç§é’¥")])])])]),t("li",[t("a",{attrs:{href:"#äº”ã€åˆ›å»º-etcd-è¯ä¹¦"}},[s._v("äº”ã€åˆ›å»º ETCD è¯ä¹¦")]),t("ul",[t("li",[t("a",{attrs:{href:"#_5-1-ç”Ÿæˆ-etcd-è¯ä¹¦é…ç½®"}},[s._v("5.1 ç”Ÿæˆ etcd è¯ä¹¦é…ç½®")])]),t("li",[t("a",{attrs:{href:"#_5-2-ä½¿ç”¨æ ¹è¯ä¹¦-ca-pem-ç­¾å‘etcdè¯ä¹¦"}},[s._v("5.2 ä½¿ç”¨æ ¹è¯ä¹¦(ca.pem)ç­¾å‘etcdè¯ä¹¦")])])])]),t("li",[t("a",{attrs:{href:"#å…­ã€åˆ›å»º-api-server-è¯ä¹¦"}},[s._v("å…­ã€åˆ›å»º Api-server è¯ä¹¦")]),t("ul",[t("li",[t("a",{attrs:{href:"#_6-1-ç”Ÿæˆ-api-server-è¯ä¹¦é…ç½®"}},[s._v("6.1 ç”Ÿæˆ Api-server è¯ä¹¦é…ç½®")])]),t("li",[t("a",{attrs:{href:"#_6-2-ä½¿ç”¨æ ¹è¯ä¹¦-ca-pem-ç­¾å‘-apiserver-è¯ä¹¦"}},[s._v("6.2 ä½¿ç”¨æ ¹è¯ä¹¦(ca.pem)ç­¾å‘ apiserver è¯ä¹¦")])])])]),t("li",[t("a",{attrs:{href:"#ä¸ƒã€åˆ›å»º-admin-è¯ä¹¦"}},[s._v("ä¸ƒã€åˆ›å»º Admin è¯ä¹¦")]),t("ul",[t("li",[t("a",{attrs:{href:"#_7-1-ç”Ÿæˆ-admin-è¯ä¹¦é…ç½®"}},[s._v("7.1 ç”Ÿæˆ Admin è¯ä¹¦é…ç½®")])]),t("li",[t("a",{attrs:{href:"#_7-2-ä½¿ç”¨æ ¹è¯ä¹¦-ca-pem-ç­¾å‘adminè¯ä¹¦"}},[s._v("7.2 ä½¿ç”¨æ ¹è¯ä¹¦(ca.pem)ç­¾å‘adminè¯ä¹¦")])])])]),t("li",[t("a",{attrs:{href:"#å…«ã€åˆ›å»º-kube-proxy-è¯ä¹¦"}},[s._v("å…«ã€åˆ›å»º kube-proxy è¯ä¹¦")]),t("ul",[t("li",[t("a",{attrs:{href:"#_8-1-ç”Ÿæˆ-kube-proxy-è¯ä¹¦é…ç½®"}},[s._v("8.1 ç”Ÿæˆ kube-proxy è¯ä¹¦é…ç½®")])]),t("li",[t("a",{attrs:{href:"#_8-2-ä½¿ç”¨æ ¹è¯ä¹¦-ca-pem-ç­¾å‘proxyè¯ä¹¦"}},[s._v("8.2 ä½¿ç”¨æ ¹è¯ä¹¦(ca.pem)ç­¾å‘proxyè¯ä¹¦")])])])]),t("li",[t("a",{attrs:{href:"#ä¹ã€åˆ†å‘è¯ä¹¦"}},[s._v("ä¹ã€åˆ†å‘è¯ä¹¦")])]),t("li",[t("a",{attrs:{href:"#åã€å¯ç”¨-tls-bootstrapping-æœºåˆ¶"}},[s._v("åã€å¯ç”¨ TLS Bootstrapping æœºåˆ¶")]),t("ul",[t("li",[t("a",{attrs:{href:"#_10-1-ç”Ÿæˆtokenè®¤è¯æ–‡ä»¶"}},[s._v("10.1 ç”Ÿæˆtokenè®¤è¯æ–‡ä»¶")])])])])])])])]),t("p"),s._v(" "),t("h2",{attrs:{id:"ä¸€ã€ç†è§£è®¤è¯æˆæƒ"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#ä¸€ã€ç†è§£è®¤è¯æˆæƒ"}},[s._v("#")]),s._v(" ä¸€ã€ç†è§£è®¤è¯æˆæƒ")]),s._v(" "),t("blockquote",[t("p",[s._v("è¯¥æ®µç†è§£å¼•ç”¨ "),t("a",{attrs:{href:"https://github.com/liuyi01/kubernetes-starter/blob/master/docs/3-kubernetes-with-ca.md",target:"_blank",rel:"noopener noreferrer"}},[s._v("kubernetes-with-ca"),t("OutboundLink")],1)])]),s._v(" "),t("h3",{attrs:{id:"_1-1-ä¸ºä»€ä¹ˆè¦è®¤è¯"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#_1-1-ä¸ºä»€ä¹ˆè¦è®¤è¯"}},[s._v("#")]),s._v(" 1.1 ä¸ºä»€ä¹ˆè¦è®¤è¯")]),s._v(" "),t("p",[s._v("æƒ³ç†è§£è®¤è¯ï¼Œæˆ‘ä»¬å¾—ä»è®¤è¯è§£å†³ä»€ä¹ˆé—®é¢˜ã€é˜²æ­¢ä»€ä¹ˆé—®é¢˜çš„å‘ç”Ÿå…¥æ‰‹ã€‚\né˜²æ­¢ä»€ä¹ˆé—®é¢˜å‘¢ï¼Ÿæ˜¯é˜²æ­¢æœ‰äººå…¥ä¾µä½ çš„é›†ç¾¤ï¼Œrootä½ çš„æœºå™¨åè®©æˆ‘ä»¬é›†ç¾¤ä¾ç„¶å®‰å…¨å—ï¼Ÿä¸æ˜¯å§ï¼Œrootéƒ½åˆ°æ‰‹äº†ï¼Œé‚£å°±ä¸ºæ‰€æ¬²ä¸ºï¼Œé˜²ä¸èƒœé˜²äº†ã€‚\nå…¶å®ç½‘ç»œå®‰å…¨æœ¬èº«å°±æ˜¯ä¸ºäº†è§£å†³åœ¨æŸäº›å‡è®¾æˆç«‹çš„æ¡ä»¶ä¸‹å¦‚ä½•é˜²èŒƒçš„é—®é¢˜ã€‚æ¯”å¦‚ä¸€ä¸ªéå¸¸é‡è¦çš„å‡è®¾å°±æ˜¯ä¸¤ä¸ªèŠ‚ç‚¹æˆ–è€…ipä¹‹é—´çš„é€šè®¯ç½‘ç»œæ˜¯ä¸å¯ä¿¡ä»»çš„ï¼Œå¯èƒ½ä¼šè¢«ç¬¬ä¸‰æ–¹çªƒå–ï¼Œä¹Ÿå¯èƒ½ä¼šè¢«ç¬¬ä¸‰æ–¹ç¯¡æ”¹ã€‚å°±åƒæˆ‘ä»¬ä¸Šå­¦æ—¶å€™ç»™å¿ƒä»ªçš„å¥³å­©ä¼ çº¸æ¡ï¼Œä¼ é€çš„è¿‡ç¨‹å¯èƒ½ä¼šè¢«åˆ«çš„åŒå­¦å·çœ‹ï¼Œç”šè‡³å†…å®¹å¯èƒ½ä¼šä»æˆ‘å–œæ¬¢ä½ ä¿®æ”¹æˆæˆ‘ä¸å–œæ¬¢ä½ äº†ã€‚å½“ç„¶è¿™ç§å‡è®¾ä¸æ˜¯éšä¾¿æƒ³å‡ºæ¥çš„ï¼Œè€Œæ˜¯ä»ç½‘ç»œæŠ€æœ¯ç°çŠ¶å’Œå®é™…å‘ç”Ÿçš„é—®é¢˜ä¸­å‘ç°ã€æ€»ç»“å‡ºæ¥çš„ã€‚kubernetesçš„è®¤è¯ä¹Ÿæ˜¯ä»è¿™ä¸ªé—®é¢˜å‡ºå‘æ¥å®ç°çš„ã€‚")]),s._v(" "),t("h3",{attrs:{id:"_1-2-æ¦‚å¿µæ¢³ç†"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#_1-2-æ¦‚å¿µæ¢³ç†"}},[s._v("#")]),s._v(" 1.2 æ¦‚å¿µæ¢³ç†")]),s._v(" "),t("p",[s._v("ä¸ºäº†è§£å†³ä¸Šé¢è¯´çš„é—®é¢˜ï¼Œkuberneteså¹¶ä¸éœ€è¦è‡ªå·±æƒ³åŠæ³•ï¼Œæ¯•ç«Ÿæ˜¯ç½‘ç»œå®‰å…¨å±‚é¢çš„é—®é¢˜ï¼Œæ˜¯æ¯ä¸ªæœåŠ¡éƒ½ä¼šé‡åˆ°çš„é—®é¢˜ï¼Œä¸šå†…ä¹Ÿæœ‰æˆç†Ÿçš„æ–¹æ¡ˆæ¥è§£å†³ã€‚è¿™é‡Œæˆ‘ä»¬ä¸€èµ·äº†è§£ä¸€ä¸‹ä¸šå†…æ–¹æ¡ˆå’Œç›¸å…³çš„æ¦‚å¿µã€‚")]),s._v(" "),t("ul",[t("li",[t("strong",[s._v("å¯¹ç§°åŠ å¯†/éå¯¹ç§°åŠ å¯†")]),s._v(" è¿™ä¸¤ä¸ªæ¦‚å¿µå±äºå¯†ç å­¦çš„ä¸œè¥¿ï¼Œå¯¹äºæ²¡æ¥è§¦è¿‡çš„åŒå­¦ä¸å¤ªå®¹æ˜“ç†è§£ã€‚å¯ä»¥å‚è€ƒçŸ¥ä¹å¤§ç¥çš„ç”ŸåŠ¨è®²è§£ï¼š"),t("a",{attrs:{href:"https://www.zhihu.com/question/33645891/answer/57721969",target:"_blank",rel:"noopener noreferrer"}},[s._v("ã€Šå¦‚ä½•ç”¨é€šä¿—æ˜“æ‡‚çš„è¯æ¥è§£é‡Šéå¯¹ç§°åŠ å¯†ã€‹"),t("OutboundLink")],1)]),s._v(" "),t("li",[t("strong",[s._v("SSL/TLS")]),s._v(" äº†è§£äº†å¯¹ç§°åŠ å¯†å’Œéå¯¹ç§°åŠ å¯†åï¼Œæˆ‘ä»¬å°±å¯ä»¥äº†è§£ä¸€ä¸‹SSL/TLSäº†ã€‚åŒæ ·ï¼Œå·²ç»æœ‰å¤§ç¥æ€»ç»“äº†éå¸¸å¥½çš„å…¥é—¨æ–‡ç« ï¼š"),t("a",{attrs:{href:"http://www.ruanyifeng.com/blog/2014/02/ssl_tls.html",target:"_blank",rel:"noopener noreferrer"}},[s._v("ã€ŠSSL/TLSåè®®è¿è¡Œæœºåˆ¶çš„æ¦‚è¿°ã€‹"),t("OutboundLink")],1)])]),s._v(" "),t("h3",{attrs:{id:"_1-3-ä»€ä¹ˆæ˜¯æˆæƒ"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#_1-3-ä»€ä¹ˆæ˜¯æˆæƒ"}},[s._v("#")]),s._v(" 1.3 ä»€ä¹ˆæ˜¯æˆæƒ")]),s._v(" "),t("p",[s._v("æˆæƒçš„æ¦‚å¿µå°±ç®€å•å¤šäº†ï¼Œå°±æ˜¯ä»€ä¹ˆäººå…·æœ‰ä»€ä¹ˆæ ·çš„æƒé™ï¼Œä¸€èˆ¬é€šè¿‡è§’è‰²ä½œä¸ºçº½å¸¦æŠŠä»–ä»¬ç»„åˆåœ¨ä¸€èµ·ã€‚ä¹Ÿå°±æ˜¯ä¸€ä¸ªè§’è‰²ä¸€è¾¹æ‹¥æœ‰å¤šç§æƒé™ï¼Œä¸€è¾¹æ‹¥æœ‰å¤šä¸ªäººã€‚è¿™æ ·å°±æŠŠäººå’Œæƒé™å»ºç«‹äº†ä¸€ä¸ªå…³ç³»ã€‚")]),s._v(" "),t("h2",{attrs:{id:"äºŒã€kubernetesçš„è®¤è¯æˆæƒ"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#äºŒã€kubernetesçš„è®¤è¯æˆæƒ"}},[s._v("#")]),s._v(" äºŒã€kubernetesçš„è®¤è¯æˆæƒ")]),s._v(" "),t("p",[s._v("Kubernetesé›†ç¾¤çš„æ‰€æœ‰æ“ä½œåŸºæœ¬ä¸Šéƒ½æ˜¯é€šè¿‡kube-apiserverè¿™ä¸ªç»„ä»¶è¿›è¡Œçš„ï¼Œå®ƒæä¾›HTTP RESTfulå½¢å¼çš„APIä¾›é›†ç¾¤å†…å¤–å®¢æˆ·ç«¯è°ƒç”¨ã€‚éœ€è¦æ³¨æ„çš„æ˜¯ï¼šè®¤è¯æˆæƒè¿‡ç¨‹åªå­˜åœ¨HTTPSå½¢å¼çš„APIä¸­ã€‚ä¹Ÿå°±æ˜¯è¯´ï¼Œå¦‚æœå®¢æˆ·ç«¯ä½¿ç”¨HTTPè¿æ¥åˆ°kube-apiserverï¼Œé‚£ä¹ˆæ˜¯ä¸ä¼šè¿›è¡Œè®¤è¯æˆæƒçš„ã€‚æ‰€ä»¥è¯´ï¼Œå¯ä»¥è¿™ä¹ˆè®¾ç½®ï¼Œåœ¨é›†ç¾¤å†…éƒ¨ç»„ä»¶é—´é€šä¿¡ä½¿ç”¨HTTPï¼Œé›†ç¾¤å¤–éƒ¨å°±ä½¿ç”¨HTTPSï¼Œè¿™æ ·æ—¢å¢åŠ äº†å®‰å…¨æ€§ï¼Œä¹Ÿä¸è‡³äºå¤ªå¤æ‚ã€‚\nå¯¹APIServerçš„è®¿é—®è¦ç»è¿‡çš„ä¸‰ä¸ªæ­¥éª¤ï¼Œå‰é¢ä¸¤ä¸ªæ˜¯è®¤è¯å’Œæˆæƒï¼Œç¬¬ä¸‰ä¸ªæ˜¯ Admission Controlï¼Œå®ƒä¹Ÿèƒ½åœ¨ä¸€å®šç¨‹åº¦ä¸Šæé«˜å®‰å…¨æ€§ï¼Œä¸è¿‡æ›´å¤šæ˜¯èµ„æºç®¡ç†æ–¹é¢çš„ä½œç”¨ã€‚")]),s._v(" "),t("h3",{attrs:{id:"_2-1-kubernetesçš„è®¤è¯"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#_2-1-kubernetesçš„è®¤è¯"}},[s._v("#")]),s._v(" 2.1 kubernetesçš„è®¤è¯")]),s._v(" "),t("p",[s._v("kubernetesæä¾›äº†å¤šç§è®¤è¯æ–¹å¼ï¼Œæ¯”å¦‚å®¢æˆ·ç«¯è¯ä¹¦ã€é™æ€tokenã€é™æ€å¯†ç æ–‡ä»¶ã€ServiceAccountTokensç­‰ç­‰ã€‚ä½ å¯ä»¥åŒæ—¶ä½¿ç”¨ä¸€ç§æˆ–å¤šç§è®¤è¯æ–¹å¼ã€‚åªè¦é€šè¿‡ä»»ä½•ä¸€ä¸ªéƒ½è¢«è®¤ä½œæ˜¯è®¤è¯é€šè¿‡ã€‚ä¸‹é¢æˆ‘ä»¬å°±è®¤è¯†å‡ ä¸ªå¸¸è§çš„è®¤è¯æ–¹å¼ã€‚")]),s._v(" "),t("ul",[t("li",[t("strong",[s._v("å®¢æˆ·ç«¯è¯ä¹¦è®¤è¯")]),s._v(" å®¢æˆ·ç«¯è¯ä¹¦è®¤è¯å«ä½œTLSåŒå‘è®¤è¯ï¼Œä¹Ÿå°±æ˜¯æœåŠ¡å™¨å®¢æˆ·ç«¯äº’ç›¸éªŒè¯è¯ä¹¦çš„æ­£ç¡®æ€§ï¼Œåœ¨éƒ½æ­£ç¡®çš„æƒ…å†µä¸‹åè°ƒé€šä¿¡åŠ å¯†æ–¹æ¡ˆã€‚ ä¸ºäº†ä½¿ç”¨è¿™ä¸ªæ–¹æ¡ˆï¼Œapi-serveréœ€è¦ç”¨--client-ca-fileé€‰é¡¹æ¥å¼€å¯ã€‚")]),s._v(" "),t("li",[t("strong",[s._v("å¼•å¯¼Token")]),s._v(" å½“æˆ‘ä»¬æœ‰éå¸¸å¤šçš„nodeèŠ‚ç‚¹æ—¶ï¼Œæ‰‹åŠ¨ä¸ºæ¯ä¸ªnodeèŠ‚ç‚¹é…ç½®TLSè®¤è¯æ¯”è¾ƒéº»çƒ¦ï¼Œè¿™æ—¶å°±å¯ä»¥ç”¨åˆ°å¼•å¯¼tokençš„è®¤è¯æ–¹å¼ï¼Œå‰ææ˜¯éœ€è¦åœ¨api-serverå¼€å¯ experimental-bootstrap-token-auth ç‰¹æ€§ï¼Œå®¢æˆ·ç«¯çš„tokenä¿¡æ¯ä¸é¢„å…ˆå®šä¹‰çš„tokenåŒ¹é…è®¤è¯é€šè¿‡åï¼Œè‡ªåŠ¨ä¸ºnodeé¢å‘è¯ä¹¦ã€‚å½“ç„¶å¼•å¯¼tokenæ˜¯ä¸€ç§æœºåˆ¶ï¼Œå¯ä»¥ç”¨åˆ°å„ç§åœºæ™¯ä¸­ã€‚")]),s._v(" "),t("li",[t("strong",[s._v("Service Account Tokens è®¤è¯")]),s._v(" æœ‰äº›æƒ…å†µä¸‹ï¼Œæˆ‘ä»¬å¸Œæœ›åœ¨podå†…éƒ¨è®¿é—®api-serverï¼Œè·å–é›†ç¾¤çš„ä¿¡æ¯ï¼Œç”šè‡³å¯¹é›†ç¾¤è¿›è¡Œæ”¹åŠ¨ã€‚é’ˆå¯¹è¿™ç§æƒ…å†µï¼Œkubernetesæä¾›äº†ä¸€ç§ç‰¹æ®Šçš„è®¤è¯æ–¹å¼ï¼šService Accountã€‚ Service Account å’Œ podã€serviceã€deployment ä¸€æ ·æ˜¯ kubernetes é›†ç¾¤ä¸­çš„ä¸€ç§èµ„æºï¼Œç”¨æˆ·ä¹Ÿå¯ä»¥åˆ›å»ºè‡ªå·±çš„ Service Accountã€‚ ServiceAccount ä¸»è¦åŒ…å«äº†ä¸‰ä¸ªå†…å®¹ï¼šnamespaceã€Token å’Œ CAã€‚namespace æŒ‡å®šäº† pod æ‰€åœ¨çš„ namespaceï¼ŒCA ç”¨äºéªŒè¯ apiserver çš„è¯ä¹¦ï¼Œtoken ç”¨ä½œèº«ä»½éªŒè¯ã€‚å®ƒä»¬éƒ½é€šè¿‡ mount çš„æ–¹å¼ä¿å­˜åœ¨ pod çš„æ–‡ä»¶ç³»ç»Ÿä¸­ã€‚")])]),s._v(" "),t("h3",{attrs:{id:"_2-2-kubernetesçš„æˆæƒ"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#_2-2-kubernetesçš„æˆæƒ"}},[s._v("#")]),s._v(" 2.2 kubernetesçš„æˆæƒ")]),s._v(" "),t("p",[s._v("åœ¨Kubernetes1.6ç‰ˆæœ¬ä¸­æ–°å¢è§’è‰²è®¿é—®æ§åˆ¶æœºåˆ¶ï¼ˆRole-Based Accessï¼ŒRBACï¼‰è®©é›†ç¾¤ç®¡ç†å‘˜å¯ä»¥é’ˆå¯¹ç‰¹å®šä½¿ç”¨è€…æˆ–æœåŠ¡è´¦å·çš„è§’è‰²ï¼Œè¿›è¡Œæ›´ç²¾ç¡®çš„èµ„æºè®¿é—®æ§åˆ¶ã€‚åœ¨RBACä¸­ï¼Œæƒé™ä¸è§’è‰²ç›¸å…³è”ï¼Œç”¨æˆ·é€šè¿‡æˆä¸ºé€‚å½“è§’è‰²çš„æˆå‘˜è€Œå¾—åˆ°è¿™äº›è§’è‰²çš„æƒé™ã€‚è¿™å°±æå¤§åœ°ç®€åŒ–äº†æƒé™çš„ç®¡ç†ã€‚åœ¨ä¸€ä¸ªç»„ç»‡ä¸­ï¼Œè§’è‰²æ˜¯ä¸ºäº†å®Œæˆå„ç§å·¥ä½œè€Œåˆ›é€ ï¼Œç”¨æˆ·åˆ™ä¾æ®å®ƒçš„è´£ä»»å’Œèµ„æ ¼æ¥è¢«æŒ‡æ´¾ç›¸åº”çš„è§’è‰²ï¼Œç”¨æˆ·å¯ä»¥å¾ˆå®¹æ˜“åœ°ä»ä¸€ä¸ªè§’è‰²è¢«æŒ‡æ´¾åˆ°å¦ä¸€ä¸ªè§’è‰²ã€‚ ç›®å‰ Kubernetes ä¸­æœ‰ä¸€ç³»åˆ—çš„é‰´æƒæœºåˆ¶ï¼Œå› ä¸ºKubernetesç¤¾åŒºçš„æŠ•å…¥å’Œåå¥½ï¼Œç›¸å¯¹äºå…¶å®ƒé‰´æƒæœºåˆ¶è€Œè¨€ï¼ŒRBACæ˜¯æ›´å¥½çš„é€‰æ‹©ã€‚å…·ä½“RBACæ˜¯å¦‚ä½•ä½“ç°åœ¨kubernetesç³»ç»Ÿä¸­çš„æˆ‘ä»¬ä¼šåœ¨åé¢çš„éƒ¨ç½²ä¸­é€æ­¥çš„æ·±å…¥äº†è§£ã€‚")]),s._v(" "),t("h3",{attrs:{id:"_2-3-kubernetesçš„admissioncontrol"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#_2-3-kubernetesçš„admissioncontrol"}},[s._v("#")]),s._v(" 2.3 kubernetesçš„AdmissionControl")]),s._v(" "),t("p",[s._v("AdmissionControl - å‡†å…¥æ§åˆ¶æœ¬è´¨ä¸Šä¸ºä¸€æ®µå‡†å…¥ä»£ç ï¼Œåœ¨å¯¹kubernetes apiçš„è¯·æ±‚è¿‡ç¨‹ä¸­ï¼Œé¡ºåºä¸ºï¼šå…ˆç»è¿‡è®¤è¯ & æˆæƒï¼Œç„¶åæ‰§è¡Œå‡†å…¥æ“ä½œï¼Œæœ€åå¯¹ç›®æ ‡å¯¹è±¡è¿›è¡Œæ“ä½œã€‚è¿™ä¸ªå‡†å…¥ä»£ç åœ¨api-serverä¸­ï¼Œè€Œä¸”å¿…é¡»è¢«ç¼–è¯‘åˆ°äºŒè¿›åˆ¶æ–‡ä»¶ä¸­æ‰èƒ½è¢«æ‰§è¡Œã€‚ åœ¨å¯¹é›†ç¾¤è¿›è¡Œè¯·æ±‚æ—¶ï¼Œæ¯ä¸ªå‡†å…¥æ§åˆ¶ä»£ç éƒ½æŒ‰ç…§ä¸€å®šé¡ºåºæ‰§è¡Œã€‚å¦‚æœæœ‰ä¸€ä¸ªå‡†å…¥æ§åˆ¶æ‹’ç»äº†æ­¤æ¬¡è¯·æ±‚ï¼Œé‚£ä¹ˆæ•´ä¸ªè¯·æ±‚çš„ç»“æœå°†ä¼šç«‹å³è¿”å›ï¼Œå¹¶æç¤ºç”¨æˆ·ç›¸åº”çš„errorä¿¡æ¯ã€‚ å¸¸ç”¨ç»„ä»¶ï¼ˆæ§åˆ¶ä»£ç ï¼‰å¦‚ä¸‹ï¼š")]),s._v(" "),t("ul",[t("li",[s._v("AlwaysAdmitï¼šå…è®¸æ‰€æœ‰è¯·æ±‚")]),s._v(" "),t("li",[s._v("AlwaysDenyï¼šç¦æ­¢æ‰€æœ‰è¯·æ±‚ï¼Œå¤šç”¨äºæµ‹è¯•ç¯å¢ƒ")]),s._v(" "),t("li",[s._v("ServiceAccountï¼šå®ƒå°†serviceAccountså®ç°äº†è‡ªåŠ¨åŒ–ï¼Œå®ƒä¼šè¾…åŠ©serviceAccountåšä¸€äº›äº‹æƒ…ï¼Œæ¯”å¦‚å¦‚æœpodæ²¡æœ‰serviceAccountå±æ€§ï¼Œå®ƒä¼šè‡ªåŠ¨æ·»åŠ ä¸€ä¸ªdefaultï¼Œå¹¶ç¡®ä¿podçš„serviceAccountå§‹ç»ˆå­˜åœ¨")]),s._v(" "),t("li",[s._v("LimitRangerï¼šä»–ä¼šè§‚å¯Ÿæ‰€æœ‰çš„è¯·æ±‚ï¼Œç¡®ä¿æ²¡æœ‰è¿åå·²ç»å®šä¹‰å¥½çš„çº¦æŸæ¡ä»¶ï¼Œè¿™äº›æ¡ä»¶å®šä¹‰åœ¨namespaceä¸­LimitRangeå¯¹è±¡ä¸­ã€‚å¦‚æœåœ¨kubernetesä¸­ä½¿ç”¨LimitRangeå¯¹è±¡ï¼Œåˆ™å¿…é¡»ä½¿ç”¨è¿™ä¸ªæ’ä»¶ã€‚")]),s._v(" "),t("li",[s._v("NamespaceExistsï¼šå®ƒä¼šè§‚å¯Ÿæ‰€æœ‰çš„è¯·æ±‚ï¼Œå¦‚æœè¯·æ±‚å°è¯•åˆ›å»ºä¸€ä¸ªä¸å­˜åœ¨çš„namespaceï¼Œåˆ™è¿™ä¸ªè¯·æ±‚è¢«æ‹’ç»ã€‚")])]),s._v(" "),t("h2",{attrs:{id:"ä¸‰ã€å®‰è£…-cfssl"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#ä¸‰ã€å®‰è£…-cfssl"}},[s._v("#")]),s._v(" ä¸‰ã€å®‰è£… CFSSL")]),s._v(" "),t("p",[t("strong",[s._v("éœ€è¦å‡†å¤‡çš„è¯ä¹¦ï¼š")])]),s._v(" "),t("ul",[t("li",[s._v("ca-key.pem")]),s._v(" "),t("li",[s._v("ca.pem")]),s._v(" "),t("li",[s._v("etcd-key.pem")]),s._v(" "),t("li",[s._v("etcd.pem")]),s._v(" "),t("li",[s._v("server-key.pem")]),s._v(" "),t("li",[s._v("server.pem")]),s._v(" "),t("li",[s._v("admin.pem")]),s._v(" "),t("li",[s._v("admin-key.pem")]),s._v(" "),t("li",[s._v("kube-proxy-key.pem")]),s._v(" "),t("li",[s._v("kube-proxy.pem")])]),s._v(" "),t("p",[t("strong",[s._v("ä½¿ç”¨è¯ä¹¦çš„ç»„ä»¶å¦‚ä¸‹ï¼š")])]),s._v(" "),t("ul",[t("li",[s._v("etcdï¼šä½¿ç”¨ ca.pemã€server-key.pemã€server.pem")]),s._v(" "),t("li",[s._v("kube-apiserverï¼šä½¿ç”¨ ca.pemã€server-key.pemã€server.pem")]),s._v(" "),t("li",[s._v("kubeletï¼šä½¿ç”¨ ca.pem")]),s._v(" "),t("li",[s._v("kube-proxyï¼šä½¿ç”¨ ca.pemã€kube-proxy-key.pemã€kube-proxy.pem")]),s._v(" "),t("li",[s._v("kubectlï¼šä½¿ç”¨ ca.pemã€admin-key.pemã€admin.pem")]),s._v(" "),t("li",[s._v("kube-controller-managerï¼šä½¿ç”¨ ca-key.pemã€ca.pem")])]),s._v(" "),t("p",[s._v("æˆ‘ä»¬ä½¿ç”¨CFSSLæ¥åˆ¶ä½œè¯ä¹¦ï¼Œå®ƒæ˜¯cloudflareå¼€å‘çš„ä¸€ä¸ªå¼€æºçš„PKIå·¥å…·ï¼Œæ˜¯ä¸€ä¸ªå®Œå¤‡çš„CAæœåŠ¡ç³»ç»Ÿï¼Œå¯ä»¥ç­¾ç½²ã€æ’¤é”€è¯ä¹¦ç­‰ï¼Œè¦†ç›–äº†ä¸€ä¸ªè¯ä¹¦çš„æ•´ä¸ªç”Ÿå‘½å‘¨æœŸï¼Œåé¢åªç”¨åˆ°äº†å®ƒçš„å‘½ä»¤è¡Œå·¥å…·ã€‚")]),s._v(" "),t("div",{staticClass:"custom-block tip"},[t("p",[s._v("æ³¨ï¼šä¸€èˆ¬æƒ…å†µä¸‹ï¼ŒK8Sä¸­è¯ä¹¦åªéœ€è¦åˆ›å»ºä¸€æ¬¡ï¼Œä»¥ååœ¨å‘é›†ç¾¤ä¸­æ·»åŠ æ–°èŠ‚ç‚¹æ—¶åªè¦å°†/etc/kubernetes/caç›®å½•ä¸‹çš„è¯ä¹¦æ‹·è´åˆ°æ–°èŠ‚ç‚¹ä¸Šå³å¯ã€‚")])]),s._v(" "),t("p",[s._v("cfsslæ˜¯éå¸¸å¥½ç”¨çš„CAå·¥å…·ï¼Œæˆ‘ä»¬ç”¨å®ƒæ¥ç”Ÿæˆè¯ä¹¦å’Œç§˜é’¥æ–‡ä»¶ï¼Œ"),t("strong",[s._v("ç›´æ¥ä½¿ç”¨äºŒè¿›åˆ¶æºç åŒ…å®‰è£…ï¼š")])]),s._v(" "),t("div",{staticClass:"language-bash extra-class"},[t("pre",{pre:!0,attrs:{class:"language-bash"}},[t("code",[t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#ä¸‹è½½")]),s._v("\n$ "),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("wget")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token parameter variable"}},[s._v("-q")]),s._v(" --show-progress --https-only "),t("span",{pre:!0,attrs:{class:"token parameter variable"}},[s._v("--timestamping")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("\\")]),s._v("\n  https://pkg.cfssl.org/R1.2/cfssl_linux-amd64 "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("\\")]),s._v("\n  https://pkg.cfssl.org/R1.2/cfssljson_linux-amd64\n  \n"),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#ä¿®æ”¹ä¸ºå¯æ‰§è¡Œæƒé™")]),s._v("\n$ "),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("chmod")]),s._v(" +x cfssl_linux-amd64 cfssljson_linux-amd64\n\n"),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#ç§»åŠ¨åˆ°binç›®å½•")]),s._v("\n$ "),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("mv")]),s._v(" cfssl_linux-amd64 /usr/local/bin/cfssl\n$ "),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("mv")]),s._v(" cfssljson_linux-amd64 /usr/local/bin/cfssljson\n\n"),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#éªŒè¯")]),s._v("\n$ cfssl version\n")])])]),t("h2",{attrs:{id:"è¯ä¹¦ä½ç½®"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#è¯ä¹¦ä½ç½®"}},[s._v("#")]),s._v(" è¯ä¹¦ä½ç½®")]),s._v(" "),t("div",{staticClass:"language-bash extra-class"},[t("pre",{pre:!0,attrs:{class:"language-bash"}},[t("code",[t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#æ‰€æœ‰è¯ä¹¦ç›¸å…³çš„ä¸œè¥¿éƒ½æ”¾åœ¨è¿™, åé¢æ‰€æœ‰çš„è¯ä¹¦éƒ½æ”¾åœ¨è¯¥ç›®å½•ä¸‹, ä½ å¯ä»¥è‡ªå®šä¹‰")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("mkdir")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token parameter variable"}},[s._v("-p")]),s._v(" /etc/kubernetes/ca\n")])])]),t("h2",{attrs:{id:"å››ã€åˆ›å»º-ca-æ ¹è¯ä¹¦"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#å››ã€åˆ›å»º-ca-æ ¹è¯ä¹¦"}},[s._v("#")]),s._v(" å››ã€åˆ›å»º CA (æ ¹è¯ä¹¦)")]),s._v(" "),t("h3",{attrs:{id:"_4-1-åˆ›å»º-ca-é…ç½®æ–‡ä»¶"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#_4-1-åˆ›å»º-ca-é…ç½®æ–‡ä»¶"}},[s._v("#")]),s._v(" 4.1 åˆ›å»º CA é…ç½®æ–‡ä»¶")]),s._v(" "),t("div",{staticClass:"language-bash extra-class"},[t("pre",{pre:!0,attrs:{class:"language-bash"}},[t("code",[t("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v("cd")]),s._v(" /etc/kubernetes/ca\n"),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# åˆ›å»ºå¦‚ä¸‹çš„ca-config.jsonæ–‡ä»¶(* ä¹Ÿå¯ä»¥ä¸æ‰§è¡Œè¯¥å‘½ä»¤ï¼Œç›´æ¥åˆ›å»ºä¸‹é¢ğŸ‘‡çš„æ–‡ä»¶)")]),s._v("\ncfssl print-defaults config "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v(">")]),s._v(" ca-config.json\n"),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# ä¿®æ”¹ ca-config.json æ–‡ä»¶ï¼Œå¦‚ä¸‹ï¼š")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("vim")]),s._v(" ca-config.json\n"),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# è¿‡æœŸæ—¶é—´è®¾ç½®æˆäº† 87600h")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n  "),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('"signing"')]),t("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v(":")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n    "),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('"default"')]),t("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v(":")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n      "),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('"expiry"')]),t("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v(":")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('"87600h"')]),s._v("\n    "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v(",\n    "),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('"profiles"')]),t("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v(":")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n      "),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('"kubernetes"')]),t("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v(":")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n        "),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('"usages"')]),t("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v(":")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("\n            "),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('"signing"')]),s._v(",\n            "),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('"key encipherment"')]),s._v(",\n            "),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('"server auth"')]),s._v(",\n            "),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('"client auth"')]),s._v("\n        "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),s._v(",\n        "),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('"expiry"')]),t("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v(":")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('"87600h"')]),s._v("\n      "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n    "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n  "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n\n")])])]),t("p",[s._v("å­—æ®µè¯´æ˜")]),s._v(" "),t("ul",[t("li",[t("code",[s._v("ca-config.json")]),s._v("ï¼šå¯ä»¥å®šä¹‰å¤šä¸ª profilesï¼Œåˆ†åˆ«æŒ‡å®šä¸åŒçš„è¿‡æœŸæ—¶é—´ã€ä½¿ç”¨åœºæ™¯ç­‰å‚æ•°ï¼›åç»­åœ¨ç­¾åè¯ä¹¦æ—¶ä½¿ç”¨æŸä¸ª profileï¼›")]),s._v(" "),t("li",[t("code",[s._v("signing")]),s._v("ï¼šè¡¨ç¤ºè¯¥è¯ä¹¦å¯ç”¨äºç­¾åå…¶å®ƒè¯ä¹¦ï¼›ç”Ÿæˆçš„ ca.pem è¯ä¹¦ä¸­ "),t("code",[s._v("CA=TRUE")]),s._v("ï¼›")]),s._v(" "),t("li",[t("code",[s._v("server auth")]),s._v("ï¼šè¡¨ç¤ºclientå¯ä»¥ç”¨è¯¥ CA å¯¹serveræä¾›çš„è¯ä¹¦è¿›è¡ŒéªŒè¯ï¼›")]),s._v(" "),t("li",[t("code",[s._v("client auth")]),s._v("ï¼šè¡¨ç¤ºserverå¯ä»¥ç”¨è¯¥CAå¯¹clientæä¾›çš„è¯ä¹¦è¿›è¡ŒéªŒè¯ï¼›")])]),s._v(" "),t("h3",{attrs:{id:"_4-2-åˆ›å»º-ca-è¯ä¹¦ç­¾åè¯·æ±‚"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#_4-2-åˆ›å»º-ca-è¯ä¹¦ç­¾åè¯·æ±‚"}},[s._v("#")]),s._v(" 4.2 åˆ›å»º CA è¯ä¹¦ç­¾åè¯·æ±‚")]),s._v(" "),t("div",{staticClass:"language-bash extra-class"},[t("pre",{pre:!0,attrs:{class:"language-bash"}},[t("code",[t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# åˆ›å»ºå¦‚ä¸‹çš„ca-csr.jsonæ–‡ä»¶")]),s._v("\ncfssl print-defaults csr "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v(">")]),s._v(" ca-csr.json\n"),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# ä¿®æ”¹ ca-csr.json æ–‡ä»¶ï¼Œå¦‚ä¸‹ï¼š")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("vim")]),s._v(" ca-csr.json\n"),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# ca-csr.josn æ–‡ä»¶å†…å®¹å¦‚ä¸‹")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n  "),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('"CN"')]),t("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v(":")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('"kubernetes"')]),s._v(",\n  "),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('"key"')]),t("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v(":")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n    "),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('"algo"')]),t("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v(":")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('"rsa"')]),s._v(",\n    "),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('"size"')]),t("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v(":")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("2048")]),s._v("\n  "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v(",\n  "),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('"names"')]),t("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v(":")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("\n    "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n      "),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('"C"')]),t("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v(":")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('"CN"')]),s._v(",\n      "),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('"ST"')]),t("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v(":")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('"BeiJing"')]),s._v(",\n      "),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('"L"')]),t("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v(":")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('"BeiJing"')]),s._v(",\n      "),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('"O"')]),t("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v(":")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('"k8s"')]),s._v(",\n      "),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('"OU"')]),t("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v(":")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('"System"')]),s._v("\n    "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n  "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),s._v(",\n    "),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('"ca"')]),t("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v(":")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n       "),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('"expiry"')]),t("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v(":")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('"87600h"')]),s._v("\n    "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n")])])]),t("p",[s._v("å­—æ®µè¯´æ˜")]),s._v(" "),t("ul",[t("li",[s._v('"CN"ï¼š'),t("code",[s._v("Common Name")]),s._v("ï¼Œkube-apiserver ä»è¯ä¹¦ä¸­æå–è¯¥å­—æ®µä½œä¸ºè¯·æ±‚çš„ç”¨æˆ·å (User Name)ï¼›æµè§ˆå™¨ä½¿ç”¨è¯¥å­—æ®µéªŒè¯ç½‘ç«™æ˜¯å¦åˆæ³•ï¼›")]),s._v(" "),t("li",[s._v('"O"ï¼š'),t("code",[s._v("Organization")]),s._v("ï¼Œkube-apiserver ä»è¯ä¹¦ä¸­æå–è¯¥å­—æ®µä½œä¸ºè¯·æ±‚ç”¨æˆ·æ‰€å±çš„ç»„ (Group)ï¼›")])]),s._v(" "),t("h3",{attrs:{id:"_4-3-ç”Ÿæˆ-ca-è¯ä¹¦å’Œç§é’¥"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#_4-3-ç”Ÿæˆ-ca-è¯ä¹¦å’Œç§é’¥"}},[s._v("#")]),s._v(" 4.3 ç”Ÿæˆ CA è¯ä¹¦å’Œç§é’¥")]),s._v(" "),t("div",{staticClass:"language-bash extra-class"},[t("pre",{pre:!0,attrs:{class:"language-bash"}},[t("code",[s._v("cfssl gencert "),t("span",{pre:!0,attrs:{class:"token parameter variable"}},[s._v("-initca")]),s._v(" ca-csr.json "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("|")]),s._v(" cfssljson "),t("span",{pre:!0,attrs:{class:"token parameter variable"}},[s._v("-bare")]),s._v(" ca\n"),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# ç”Ÿæˆå®Œæˆåä¼šæœ‰ä»¥ä¸‹æ–‡ä»¶ï¼ˆæˆ‘ä»¬æœ€ç»ˆæƒ³è¦çš„å°±æ˜¯ca-key.pemå’Œca.pemï¼Œä¸€ä¸ªç§˜é’¥ï¼Œä¸€ä¸ªè¯ä¹¦ï¼‰")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v(">")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("ls")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v(">")]),s._v(" ca-config.json  ca.csr  ca-csr.json  ca-key.pem  ca.pem\n")])])]),t("h2",{attrs:{id:"äº”ã€åˆ›å»º-etcd-è¯ä¹¦"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#äº”ã€åˆ›å»º-etcd-è¯ä¹¦"}},[s._v("#")]),s._v(" äº”ã€åˆ›å»º ETCD è¯ä¹¦")]),s._v(" "),t("h3",{attrs:{id:"_5-1-ç”Ÿæˆ-etcd-è¯ä¹¦é…ç½®"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#_5-1-ç”Ÿæˆ-etcd-è¯ä¹¦é…ç½®"}},[s._v("#")]),s._v(" 5.1 ç”Ÿæˆ etcd è¯ä¹¦é…ç½®")]),s._v(" "),t("div",{staticClass:"language-bash extra-class"},[t("pre",{pre:!0,attrs:{class:"language-bash"}},[t("code",[t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# etcdè¯ä¹¦æ”¾åœ¨è¿™")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("mkdir")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token parameter variable"}},[s._v("-p")]),s._v(" /etc/kubernetes/ca/etcd\n"),t("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v("cd")]),s._v(" /etc/kubernetes/ca/etcd\n"),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("vim")]),s._v(" etcd-csr.json\n"),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# æ–‡ä»¶å†…å®¹å¦‚ä¸‹")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n  "),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('"CN"')]),t("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v(":")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('"etcd"')]),s._v(",\n  "),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('"hosts"')]),t("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v(":")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("\n    "),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('"127.0.0.1"')]),s._v(",\n    "),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('"192.168.10.102"')]),s._v("\n  "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),s._v(",\n  "),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('"key"')]),t("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v(":")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n    "),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('"algo"')]),t("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v(":")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('"rsa"')]),s._v(",\n    "),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('"size"')]),t("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v(":")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("2048")]),s._v("\n  "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v(",\n  "),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('"names"')]),t("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v(":")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("\n    "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n      "),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('"C"')]),t("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v(":")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('"CN"')]),s._v(",\n      "),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('"ST"')]),t("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v(":")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('"Beijing"')]),s._v(",\n      "),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('"L"')]),t("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v(":")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('"XS"')]),s._v(",\n      "),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('"O"')]),t("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v(":")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('"k8s"')]),s._v(",\n      "),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('"OU"')]),t("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v(":")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('"System"')]),s._v("\n    "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n  "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n")])])]),t("p",[s._v("å­—æ®µè¯´æ˜")]),s._v(" "),t("ul",[t("li",[t("code",[s._v("hosts")]),s._v("ï¼šæŒ‡å®šæˆæƒä½¿ç”¨è¯¥è¯ä¹¦çš„ "),t("strong",[s._v("IP æˆ–åŸŸååˆ—è¡¨")]),s._v("ï¼Œå¦‚æœæœ‰éƒ¨ç½²å¤šä¸ª etcdï¼Œé‚£ä¹ˆå°±éœ€è¦å¡«å…¥å…¶ä»– etcd çš„ "),t("strong",[s._v("IP æˆ–åŸŸååˆ—è¡¨")]),s._v("ï¼Œæˆ‘è¿™é‡Œåªéƒ¨ç½²ä¸€å°æ‰€ä»¥å°±å†™ä¸€ä¸ªâ˜ï¸")])]),s._v(" "),t("div",{staticClass:"custom-block tip"},[t("p",[s._v("æ³¨ï¼šä¸Šè¿°æ–‡ä»¶hostså­—æ®µä¸­IPä¸ºæ‰€æœ‰etcdèŠ‚ç‚¹çš„é›†ç¾¤å†…éƒ¨é€šä¿¡IPï¼Œä¸€ä¸ªéƒ½ä¸èƒ½å°‘ï¼ä¸ºäº†æ–¹ä¾¿åæœŸæ‰©å®¹å¯ä»¥å¤šå†™å‡ ä¸ªé¢„ç•™çš„IPã€‚")])]),s._v(" "),t("h3",{attrs:{id:"_5-2-ä½¿ç”¨æ ¹è¯ä¹¦-ca-pem-ç­¾å‘etcdè¯ä¹¦"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#_5-2-ä½¿ç”¨æ ¹è¯ä¹¦-ca-pem-ç­¾å‘etcdè¯ä¹¦"}},[s._v("#")]),s._v(" 5.2 ä½¿ç”¨æ ¹è¯ä¹¦(ca.pem)ç­¾å‘etcdè¯ä¹¦")]),s._v(" "),t("div",{staticClass:"language-bash extra-class"},[t("pre",{pre:!0,attrs:{class:"language-bash"}},[t("code",[s._v("cfssl gencert "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("\\")]),s._v("\n        "),t("span",{pre:!0,attrs:{class:"token parameter variable"}},[s._v("-ca")]),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v("/etc/kubernetes/ca/ca.pem "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("\\")]),s._v("\n        -ca-key"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v("/etc/kubernetes/ca/ca-key.pem "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("\\")]),s._v("\n        "),t("span",{pre:!0,attrs:{class:"token parameter variable"}},[s._v("-config")]),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v("/etc/kubernetes/ca/ca-config.json "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("\\")]),s._v("\n        "),t("span",{pre:!0,attrs:{class:"token parameter variable"}},[s._v("-profile")]),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v("kubernetes etcd-csr.json "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("|")]),s._v(" cfssljson "),t("span",{pre:!0,attrs:{class:"token parameter variable"}},[s._v("-bare")]),s._v(" etcd\n   \n"),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# è·Ÿä¹‹å‰ç±»ä¼¼ç”Ÿæˆä¸‰ä¸ªæ–‡ä»¶etcd.csræ˜¯ä¸ªä¸­é—´è¯ä¹¦è¯·æ±‚æ–‡ä»¶ï¼Œæˆ‘ä»¬æœ€ç»ˆè¦çš„æ˜¯etcd-key.pemå’Œetcd.pem")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v(">")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("ls")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v(">")]),s._v(" etcd.csr  etcd-csr.json  etcd-key.pem  etcd.pem\n")])])]),t("h2",{attrs:{id:"å…­ã€åˆ›å»º-api-server-è¯ä¹¦"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#å…­ã€åˆ›å»º-api-server-è¯ä¹¦"}},[s._v("#")]),s._v(" å…­ã€åˆ›å»º Api-server è¯ä¹¦")]),s._v(" "),t("ul",[t("li",[t("strong",[s._v("controller-managerï¼š")]),s._v(" ä¸€èˆ¬ä¸api-serveråœ¨åŒä¸€å°æœºå™¨ä¸Šï¼Œæ‰€ä»¥å¯ä»¥ä½¿ç”¨éå®‰å…¨ç«¯å£ä¸api-serveré€šè®¯ï¼Œä¸éœ€è¦ç”Ÿæˆè¯ä¹¦å’Œç§é’¥")]),s._v(" "),t("li",[t("strong",[s._v("schedulerï¼š")]),s._v(" ä¸€èˆ¬ä¸apiserveråœ¨åŒä¸€å°æœºå™¨ä¸Šï¼Œæ‰€ä»¥å¯ä»¥ä½¿ç”¨éå®‰å…¨ç«¯å£ä¸apiserveré€šè®¯ã€‚ä¸éœ€è¦ç”Ÿæˆè¯ä¹¦å’Œç§é’¥ã€‚")])]),s._v(" "),t("h3",{attrs:{id:"_6-1-ç”Ÿæˆ-api-server-è¯ä¹¦é…ç½®"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#_6-1-ç”Ÿæˆ-api-server-è¯ä¹¦é…ç½®"}},[s._v("#")]),s._v(" 6.1 ç”Ÿæˆ Api-server è¯ä¹¦é…ç½®")]),s._v(" "),t("div",{staticClass:"language-bash extra-class"},[t("pre",{pre:!0,attrs:{class:"language-bash"}},[t("code",[t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# api-serverè¯ä¹¦æ”¾åœ¨è¿™")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("mkdir")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token parameter variable"}},[s._v("-p")]),s._v(" /etc/kubernetes/ca/server\n"),t("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v("cd")]),s._v(" /etc/kubernetes/ca/server\n"),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("vim")]),s._v(" server-csr.json\n"),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# å†…å®¹å¦‚ä¸‹")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n  "),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('"CN"')]),t("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v(":")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('"kubernetes"')]),s._v(",\n  "),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('"hosts"')]),t("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v(":")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("\n    "),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('"127.0.0.1"')]),s._v(",\n    "),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('"10.0.0.1"')]),s._v(",\n    "),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('"192.168.10.101"')]),s._v(",\n    "),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('"192.168.10.102"')]),s._v(",\n    "),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('"192.168.10.103"')]),s._v(",\n    "),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('"kubernetes"')]),s._v(",\n    "),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('"kubernetes.default"')]),s._v(",\n    "),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('"kubernetes.default.svc"')]),s._v(",\n    "),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('"kubernetes.default.svc.cluster"')]),s._v(",\n    "),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('"kubernetes.default.svc.cluster.local"')]),s._v("\n  "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),s._v(",\n  "),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('"key"')]),t("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v(":")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n    "),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('"algo"')]),t("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v(":")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('"rsa"')]),s._v(",\n    "),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('"size"')]),t("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v(":")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("2048")]),s._v("\n  "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v(",\n  "),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('"names"')]),t("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v(":")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("\n    "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n      "),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('"C"')]),t("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v(":")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('"CN"')]),s._v(",\n      "),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('"ST"')]),t("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v(":")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('"Beijing"')]),s._v(",\n      "),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('"L"')]),t("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v(":")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('"XS"')]),s._v(",\n      "),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('"O"')]),t("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v(":")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('"k8s"')]),s._v(",\n      "),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('"OU"')]),t("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v(":")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('"System"')]),s._v("\n    "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n  "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n")])])]),t("ul",[t("li",[t("strong",[t("code",[s._v("kubernetes")]),s._v(" æœåŠ¡çš„æœåŠ¡ IP")]),s._v("ï¼ˆä¸€èˆ¬æ˜¯ "),t("code",[s._v("kube-apiserver")]),s._v(" æŒ‡å®šçš„ "),t("code",[s._v("service-cluster-ip-range")]),s._v(" ç½‘æ®µçš„ç¬¬ä¸€ä¸ªIPï¼Œå¦‚ 10.0.0.1ï¼‰")])]),s._v(" "),t("h3",{attrs:{id:"_6-2-ä½¿ç”¨æ ¹è¯ä¹¦-ca-pem-ç­¾å‘-apiserver-è¯ä¹¦"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#_6-2-ä½¿ç”¨æ ¹è¯ä¹¦-ca-pem-ç­¾å‘-apiserver-è¯ä¹¦"}},[s._v("#")]),s._v(" 6.2 ä½¿ç”¨æ ¹è¯ä¹¦(ca.pem)ç­¾å‘ apiserver è¯ä¹¦")]),s._v(" "),t("div",{staticClass:"language-bash extra-class"},[t("pre",{pre:!0,attrs:{class:"language-bash"}},[t("code",[s._v("cfssl gencert "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("\\")]),s._v("\n        "),t("span",{pre:!0,attrs:{class:"token parameter variable"}},[s._v("-ca")]),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v("/etc/kubernetes/ca/ca.pem "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("\\")]),s._v("\n        -ca-key"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v("/etc/kubernetes/ca/ca-key.pem "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("\\")]),s._v("\n        "),t("span",{pre:!0,attrs:{class:"token parameter variable"}},[s._v("-config")]),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v("/etc/kubernetes/ca/ca-config.json "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("\\")]),s._v("\n        "),t("span",{pre:!0,attrs:{class:"token parameter variable"}},[s._v("-profile")]),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v("kubernetes server-csr.json "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("|")]),s._v(" cfssljson "),t("span",{pre:!0,attrs:{class:"token parameter variable"}},[s._v("-bare")]),s._v(" server\n        \n"),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# è·Ÿä¹‹å‰ç±»ä¼¼ç”Ÿæˆä¸‰ä¸ªæ–‡ä»¶server.csræ˜¯ä¸ªä¸­é—´è¯ä¹¦è¯·æ±‚æ–‡ä»¶ï¼Œæˆ‘ä»¬æœ€ç»ˆè¦çš„æ˜¯server-key.pemå’Œserver.pem")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v(">")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("ls")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v(">")]),s._v(" server-csr.json server.csr server.pem server-key.pem\n")])])]),t("h2",{attrs:{id:"ä¸ƒã€åˆ›å»º-admin-è¯ä¹¦"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#ä¸ƒã€åˆ›å»º-admin-è¯ä¹¦"}},[s._v("#")]),s._v(" ä¸ƒã€åˆ›å»º Admin è¯ä¹¦")]),s._v(" "),t("h3",{attrs:{id:"_7-1-ç”Ÿæˆ-admin-è¯ä¹¦é…ç½®"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#_7-1-ç”Ÿæˆ-admin-è¯ä¹¦é…ç½®"}},[s._v("#")]),s._v(" 7.1 ç”Ÿæˆ Admin è¯ä¹¦é…ç½®")]),s._v(" "),t("div",{staticClass:"language-bash extra-class"},[t("pre",{pre:!0,attrs:{class:"language-bash"}},[t("code",[t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# kubectlè¯ä¹¦æ”¾åœ¨è¿™ï¼Œç”±äºkubectlç›¸å½“äºç³»ç»Ÿç®¡ç†å‘˜ï¼Œæˆ‘ä»¬ä½¿ç”¨adminå‘½å")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("mkdir")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token parameter variable"}},[s._v("-p")]),s._v(" /etc/kubernetes/ca/admin\n"),t("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v("cd")]),s._v(" /etc/kubernetes/ca/admin\n"),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("vim")]),s._v(" admin-csr.json\n"),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# å†…å®¹å¦‚ä¸‹")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n  "),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('"CN"')]),t("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v(":")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('"admin"')]),s._v(",\n  "),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('"hosts"')]),t("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v(":")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),s._v(",\n  "),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('"key"')]),t("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v(":")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n    "),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('"algo"')]),t("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v(":")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('"rsa"')]),s._v(",\n    "),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('"size"')]),t("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v(":")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("2048")]),s._v("\n  "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v(",\n  "),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('"names"')]),t("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v(":")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("\n    "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n      "),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('"C"')]),t("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v(":")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('"CN"')]),s._v(",\n      "),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('"ST"')]),t("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v(":")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('"BeiJing"')]),s._v(",\n      "),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('"L"')]),t("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v(":")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('"BeiJing"')]),s._v(",\n      "),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('"O"')]),t("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v(":")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('"system:masters"')]),s._v(",\n      "),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('"OU"')]),t("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v(":")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('"System"')]),s._v("\n    "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n  "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n")])])]),t("h3",{attrs:{id:"_7-2-ä½¿ç”¨æ ¹è¯ä¹¦-ca-pem-ç­¾å‘adminè¯ä¹¦"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#_7-2-ä½¿ç”¨æ ¹è¯ä¹¦-ca-pem-ç­¾å‘adminè¯ä¹¦"}},[s._v("#")]),s._v(" 7.2 ä½¿ç”¨æ ¹è¯ä¹¦(ca.pem)ç­¾å‘adminè¯ä¹¦")]),s._v(" "),t("div",{staticClass:"language-bash extra-class"},[t("pre",{pre:!0,attrs:{class:"language-bash"}},[t("code",[s._v("cfssl gencert "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("\\")]),s._v("\n        "),t("span",{pre:!0,attrs:{class:"token parameter variable"}},[s._v("-ca")]),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v("/etc/kubernetes/ca/ca.pem "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("\\")]),s._v("\n        -ca-key"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v("/etc/kubernetes/ca/ca-key.pem "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("\\")]),s._v("\n        "),t("span",{pre:!0,attrs:{class:"token parameter variable"}},[s._v("-config")]),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v("/etc/kubernetes/ca/ca-config.json "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("\\")]),s._v("\n        "),t("span",{pre:!0,attrs:{class:"token parameter variable"}},[s._v("-profile")]),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v("kubernetes admin-csr.json "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("|")]),s._v(" cfssljson "),t("span",{pre:!0,attrs:{class:"token parameter variable"}},[s._v("-bare")]),s._v(" admin\n        \n"),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# æˆ‘ä»¬æœ€ç»ˆè¦çš„æ˜¯admin-key.pemå’Œadmin.pem")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v(">")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("ls")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v(">")]),s._v(" admin.csr  admin-csr.json  admin-key.pem  admin.pem\n")])])]),t("h2",{attrs:{id:"å…«ã€åˆ›å»º-kube-proxy-è¯ä¹¦"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#å…«ã€åˆ›å»º-kube-proxy-è¯ä¹¦"}},[s._v("#")]),s._v(" å…«ã€åˆ›å»º kube-proxy è¯ä¹¦")]),s._v(" "),t("h3",{attrs:{id:"_8-1-ç”Ÿæˆ-kube-proxy-è¯ä¹¦é…ç½®"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#_8-1-ç”Ÿæˆ-kube-proxy-è¯ä¹¦é…ç½®"}},[s._v("#")]),s._v(" 8.1 ç”Ÿæˆ kube-proxy è¯ä¹¦é…ç½®")]),s._v(" "),t("div",{staticClass:"language-bash extra-class"},[t("pre",{pre:!0,attrs:{class:"language-bash"}},[t("code",[t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# proxyè¯ä¹¦æ”¾åœ¨è¿™")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("mkdir")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token parameter variable"}},[s._v("-p")]),s._v(" /etc/kubernetes/ca/kube-proxy\n"),t("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v("cd")]),s._v(" /etc/kubernetes/ca/kube-proxy\n"),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("vim")]),s._v(" kube-proxy-csr.json\n"),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# å†…å®¹å¦‚ä¸‹")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n  "),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('"CN"')]),t("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v(":")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('"system:kube-proxy"')]),s._v(",\n  "),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('"hosts"')]),t("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v(":")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),s._v(",\n  "),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('"key"')]),t("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v(":")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n    "),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('"algo"')]),t("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v(":")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('"rsa"')]),s._v(",\n    "),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('"size"')]),t("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v(":")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("2048")]),s._v("\n  "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v(",\n  "),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('"names"')]),t("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v(":")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("\n    "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n      "),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('"C"')]),t("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v(":")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('"CN"')]),s._v(",\n      "),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('"ST"')]),t("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v(":")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('"Beijing"')]),s._v(",\n      "),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('"L"')]),t("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v(":")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('"BeiJing"')]),s._v(",\n      "),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('"O"')]),t("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v(":")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('"k8s"')]),s._v(",\n      "),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('"OU"')]),t("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v(":")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('"System"')]),s._v("\n    "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n  "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n")])])]),t("p",[s._v("å­—æ®µè¯´æ˜ï¼š")]),s._v(" "),t("ul",[t("li",[t("p",[s._v("CN æŒ‡å®šè¯¥è¯ä¹¦çš„ User ä¸º "),t("code",[s._v("system:kube-proxy")])])]),s._v(" "),t("li",[t("p",[t("code",[s._v("kube-apiserver")]),s._v(" é¢„å®šä¹‰çš„ RoleBinding "),t("code",[s._v("system:node-proxy")]),s._v(" å°†User "),t("code",[s._v("system:kube-proxy")]),s._v(" ä¸ Role "),t("code",[s._v("system:node-proxier")]),s._v(" ç»‘å®šï¼Œæˆäºˆäº†è°ƒç”¨ "),t("code",[s._v("kube-api-server")]),s._v(" proxyçš„ç›¸å…³ API çš„æƒé™")])])]),s._v(" "),t("h3",{attrs:{id:"_8-2-ä½¿ç”¨æ ¹è¯ä¹¦-ca-pem-ç­¾å‘proxyè¯ä¹¦"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#_8-2-ä½¿ç”¨æ ¹è¯ä¹¦-ca-pem-ç­¾å‘proxyè¯ä¹¦"}},[s._v("#")]),s._v(" 8.2 ä½¿ç”¨æ ¹è¯ä¹¦(ca.pem)ç­¾å‘proxyè¯ä¹¦")]),s._v(" "),t("div",{staticClass:"language-bash extra-class"},[t("pre",{pre:!0,attrs:{class:"language-bash"}},[t("code",[s._v("cfssl gencert "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("\\")]),s._v("\n        "),t("span",{pre:!0,attrs:{class:"token parameter variable"}},[s._v("-ca")]),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v("/etc/kubernetes/ca/ca.pem "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("\\")]),s._v("\n        -ca-key"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v("/etc/kubernetes/ca/ca-key.pem "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("\\")]),s._v("\n        "),t("span",{pre:!0,attrs:{class:"token parameter variable"}},[s._v("-config")]),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v("/etc/kubernetes/ca/ca-config.json "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("\\")]),s._v("\n        "),t("span",{pre:!0,attrs:{class:"token parameter variable"}},[s._v("-profile")]),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v("kubernetes kube-proxy-csr.json "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("|")]),s._v(" cfssljson "),t("span",{pre:!0,attrs:{class:"token parameter variable"}},[s._v("-bare")]),s._v(" kube-proxy\n        \n"),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# æˆ‘ä»¬æœ€ç»ˆè¦çš„æ˜¯kube-proxy-key.pemå’Œkube-proxy.pem")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v(">")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("ls")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v(">")]),s._v(" kube-proxy.csr  kube-proxy-csr.json  kube-proxy-key.pem  kube-proxy.pem\n")])])]),t("h2",{attrs:{id:"ä¹ã€åˆ†å‘è¯ä¹¦"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#ä¹ã€åˆ†å‘è¯ä¹¦"}},[s._v("#")]),s._v(" ä¹ã€åˆ†å‘è¯ä¹¦")]),s._v(" "),t("p",[s._v("å°†ç”Ÿæˆçš„è¯ä¹¦å’Œç§˜é’¥æ–‡ä»¶ï¼ˆåç¼€åä¸º"),t("code",[s._v(".pem")]),s._v("ï¼‰æ‹·è´åˆ°æ‰€æœ‰æœºå™¨çš„ "),t("code",[s._v("/etc/kubernetes/ca")]),s._v(" ç›®å½•ä¸‹å¤‡ç”¨ï¼›")]),s._v(" "),t("div",{staticClass:"language-bash extra-class"},[t("pre",{pre:!0,attrs:{class:"language-bash"}},[t("code",[t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# æœ€åæŸ¥çœ‹ç”Ÿæˆçš„è¯ä¹¦ç›®å½•")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v(">")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("ls")]),s._v(" /etc/kubernetes/ca\n"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v(">")]),s._v(" admin  ca-config.json  ca.csr  ca-csr.json  ca-key.pem  ca.pem  etcd  kube-proxy  apiserver\n"),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# åˆ†å‘è¯ä¹¦")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("scp")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token parameter variable"}},[s._v("-r")]),s._v(" /etc/kubernetes/ca root@å…¶ä»–èŠ‚ç‚¹ip:/etc/kubernetes/\n")])])]),t("h2",{attrs:{id:"åã€å¯ç”¨-tls-bootstrapping-æœºåˆ¶"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#åã€å¯ç”¨-tls-bootstrapping-æœºåˆ¶"}},[s._v("#")]),s._v(" åã€å¯ç”¨ TLS Bootstrapping æœºåˆ¶")]),s._v(" "),t("p",[s._v("TLS Bootstrapingï¼šMaster apiserverå¯ç”¨TLSè®¤è¯åï¼ŒNodeèŠ‚ç‚¹kubeletå’Œkube-proxyè¦ä¸kube-apiserverè¿›è¡Œé€šä¿¡ï¼Œå¿…é¡»ä½¿ç”¨CAç­¾å‘çš„æœ‰æ•ˆè¯ä¹¦æ‰å¯ä»¥ï¼Œå½“NodeèŠ‚ç‚¹å¾ˆå¤šæ—¶ï¼Œè¿™ç§å®¢æˆ·ç«¯è¯ä¹¦é¢å‘éœ€è¦å¤§é‡å·¥ä½œï¼ŒåŒæ ·ä¹Ÿä¼šå¢åŠ é›†ç¾¤æ‰©å±•å¤æ‚åº¦ã€‚ä¸ºäº†ç®€åŒ–æµç¨‹ï¼ŒKuberneteså¼•å…¥äº†TLS bootstrapingæœºåˆ¶æ¥è‡ªåŠ¨é¢å‘å®¢æˆ·ç«¯è¯ä¹¦ï¼Œkubeletä¼šä»¥ä¸€ä¸ªä½æƒé™ç”¨æˆ·è‡ªåŠ¨å‘apiserverç”³è¯·è¯ä¹¦ï¼Œkubeletçš„è¯ä¹¦ç”±apiserveråŠ¨æ€ç­¾ç½²ã€‚æ‰€ä»¥å¼ºçƒˆå»ºè®®åœ¨Nodeä¸Šä½¿ç”¨è¿™ç§æ–¹å¼ï¼Œç›®å‰ä¸»è¦ç”¨äºkubeletï¼Œkube-proxyè¿˜æ˜¯ç”±æˆ‘ä»¬ç»Ÿä¸€é¢å‘ä¸€ä¸ªè¯ä¹¦ã€‚")]),s._v(" "),t("p",[t("strong",[s._v("TLS bootstraping å·¥ä½œæµç¨‹ï¼š")])]),s._v(" "),t("img",{staticStyle:{zoom:"67%"},attrs:{src:"https://media.zenghr.cn/blog/img/TLS bootstraping å·¥ä½œæµç¨‹.png",alt:"TLSbootstrapingå·¥ä½œæµç¨‹"}}),s._v(" "),t("h3",{attrs:{id:"_10-1-ç”Ÿæˆtokenè®¤è¯æ–‡ä»¶"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#_10-1-ç”Ÿæˆtokenè®¤è¯æ–‡ä»¶"}},[s._v("#")]),s._v(" 10.1 ç”Ÿæˆtokenè®¤è¯æ–‡ä»¶")]),s._v(" "),t("div",{staticClass:"language-bash extra-class"},[t("pre",{pre:!0,attrs:{class:"language-bash"}},[t("code",[t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# ç”Ÿæˆéšæœºtoken")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("head")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token parameter variable"}},[s._v("-c")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("16")]),s._v(" /dev/urandom "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("|")]),s._v(" od "),t("span",{pre:!0,attrs:{class:"token parameter variable"}},[s._v("-An")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token parameter variable"}},[s._v("-t")]),s._v(" x "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("|")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("tr")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token parameter variable"}},[s._v("-d")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token string"}},[s._v("' '")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# æŒ‰ç…§å›ºå®šæ ¼å¼å†™å…¥token.csvï¼Œæ³¨æ„æ›¿æ¢tokenå†…å®¹")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v("echo")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('"734883758a7159caba1d9501c22f1408,kubelet-bootstrap,10001,'),t("span",{pre:!0,attrs:{class:"token entity",title:'\\"'}},[s._v('\\"')]),s._v("system:kubelet-bootstrap"),t("span",{pre:!0,attrs:{class:"token entity",title:'\\"'}},[s._v('\\"')]),s._v('"')]),s._v(" "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v(">")]),s._v(" /etc/kubernetes/ca/server/token.csv\n")])])])])}),[],!1,null,null,null);t.default=n.exports}}]);