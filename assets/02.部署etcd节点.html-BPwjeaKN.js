import{_ as i}from"./plugin-vue_export-helper-DlAUqK2U.js";import{c as a,a as e,o as t}from"./app-B0Z4DqLO.js";const n={};function l(h,s){return t(),a("div",null,s[0]||(s[0]=[e(`<h1 id="部署-etcd-节点" tabindex="-1"><a class="header-anchor" href="#部署-etcd-节点"><span>部署 ETCD 节点</span></a></h1><h2 id="_1-简介" tabindex="-1"><a class="header-anchor" href="#_1-简介"><span>1. 简介</span></a></h2><p>kubernetes需要存储很多东西，像它本身的节点信息，组件信息，还有通过kubernetes运行的pod，deployment，service等等。都需要持久化。<code>etcd</code> 就是它的数据中心。生产环境中为了保证数据中心的高可用和数据的一致性，一般会部署最少三个节点。我们这里以学习为主就只在主节点部署一个实例。</p><h2 id="_2-从github下载二进制文件" tabindex="-1"><a class="header-anchor" href="#_2-从github下载二进制文件"><span>2. 从Github下载二进制文件</span></a></h2><p>下载地址：<a href="https://github.com/etcd-io/etcd/releases" target="_blank" rel="noopener noreferrer">https://github.com/etcd-io/etcd/releases</a></p><blockquote><p>我这里下载的版本是 <a href="https://github.com/etcd-io/etcd/releases/tag/v3.4.10" target="_blank" rel="noopener noreferrer">v3.4.10</a></p></blockquote><h2 id="_3-部署-etcd" tabindex="-1"><a class="header-anchor" href="#_3-部署-etcd"><span>3. 部署 ETCD</span></a></h2><h3 id="_1-创建工作目录并解压二进制包" tabindex="-1"><a class="header-anchor" href="#_1-创建工作目录并解压二进制包"><span>1. 创建工作目录并解压二进制包</span></a></h3><div class="language-bash" data-highlighter="shiki" data-ext="bash" style="--shiki-light:#abb2bf;--shiki-dark:#abb2bf;--shiki-light-bg:#282c34;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes one-dark-pro one-dark-pro vp-code"><code><span class="line"><span style="--shiki-light:#61AFEF;--shiki-dark:#61AFEF;">mkdir</span><span style="--shiki-light:#98C379;--shiki-dark:#98C379;"> /etc/kubernetes/etcd/{bin,cfg}</span><span style="--shiki-light:#D19A66;--shiki-dark:#D19A66;"> -p</span></span>
<span class="line"><span style="--shiki-light:#7F848E;--shiki-light-font-style:italic;--shiki-dark:#7F848E;--shiki-dark-font-style:italic;"># 解压缩</span></span>
<span class="line"><span style="--shiki-light:#61AFEF;--shiki-dark:#61AFEF;">tar</span><span style="--shiki-light:#98C379;--shiki-dark:#98C379;"> zxvf</span><span style="--shiki-light:#98C379;--shiki-dark:#98C379;"> etcd-v3.4.10-linux-amd64.tar.gz</span></span>
<span class="line"><span style="--shiki-light:#7F848E;--shiki-light-font-style:italic;--shiki-dark:#7F848E;--shiki-dark-font-style:italic;"># 移动 etcd 二进制文件</span></span>
<span class="line"><span style="--shiki-light:#61AFEF;--shiki-dark:#61AFEF;">mv</span><span style="--shiki-light:#98C379;--shiki-dark:#98C379;"> etcd-v3.4.10-linux-amd64/{etcd,etcdctl}</span><span style="--shiki-light:#98C379;--shiki-dark:#98C379;"> /etc/kubernetes/etcd/bin/</span></span></code></pre></div><h3 id="_2-创建etcd配置文件" tabindex="-1"><a class="header-anchor" href="#_2-创建etcd配置文件"><span>2. 创建etcd配置文件</span></a></h3><div class="language-bash" data-highlighter="shiki" data-ext="bash" style="--shiki-light:#abb2bf;--shiki-dark:#abb2bf;--shiki-light-bg:#282c34;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes one-dark-pro one-dark-pro vp-code"><code><span class="line"><span style="--shiki-light:#61AFEF;--shiki-dark:#61AFEF;">cat</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;"> &gt; </span><span style="--shiki-light:#98C379;--shiki-dark:#98C379;">/etc/kubernetes/etcd/cfg/etcd.conf</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;"> &lt;&lt; </span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">EOF</span></span>
<span class="line"><span style="--shiki-light:#98C379;--shiki-dark:#98C379;">#[Member]</span></span>
<span class="line"><span style="--shiki-light:#98C379;--shiki-dark:#98C379;">ETCD_NAME=&quot;etcd-1&quot;</span></span>
<span class="line"><span style="--shiki-light:#98C379;--shiki-dark:#98C379;">ETCD_DATA_DIR=&quot;/var/lib/etcd/default.etcd&quot;</span></span>
<span class="line"><span style="--shiki-light:#98C379;--shiki-dark:#98C379;">ETCD_LISTEN_PEER_URLS=&quot;https://192.168.10.102:2380&quot;</span></span>
<span class="line"><span style="--shiki-light:#98C379;--shiki-dark:#98C379;">ETCD_LISTEN_CLIENT_URLS=&quot;https://192.168.10.102:2379&quot;</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#98C379;--shiki-dark:#98C379;">#[Clustering]</span></span>
<span class="line"><span style="--shiki-light:#98C379;--shiki-dark:#98C379;">ETCD_INITIAL_ADVERTISE_PEER_URLS=&quot;https://192.168.10.102:2380&quot;</span></span>
<span class="line"><span style="--shiki-light:#98C379;--shiki-dark:#98C379;">ETCD_ADVERTISE_CLIENT_URLS=&quot;https://192.168.10.102:2379&quot;</span></span>
<span class="line"><span style="--shiki-light:#98C379;--shiki-dark:#98C379;">ETCD_INITIAL_CLUSTER=&quot;etcd-1=https://192.168.10.102:2380&quot;</span></span>
<span class="line"><span style="--shiki-light:#98C379;--shiki-dark:#98C379;">ETCD_INITIAL_CLUSTER_TOKEN=&quot;etcd-cluster&quot;</span></span>
<span class="line"><span style="--shiki-light:#98C379;--shiki-dark:#98C379;">ETCD_INITIAL_CLUSTER_STATE=&quot;new&quot;</span></span>
<span class="line"><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">EOF</span></span></code></pre></div><p>字段描述：</p><ul><li>ETCD_NAME：节点名称，集群中唯一</li><li>ETCD_DATA_DIR：存放数据的目录</li><li>ETCD_LISTEN_PEER_URLS：集群通信监听地址</li><li>ETCD_LISTEN_CLIENT_URLS：客户端访问监听地址</li><li>ETCD_INITIAL_ADVERTISE_PEER_URLS：集群通告地址</li><li>ETCD_ADVERTISE_CLIENT_URLS：客户端通告地址</li><li>ETCD_INITIAL_CLUSTER：集群节点地址，多个 etcd 时，参考格式：<code>节点名称1:ETCD_LISTEN_PEER_URLS,节点名称2:ETCD_LISTEN_PEER_URLS</code></li><li>ETCD_INITIAL_CLUSTER_TOKEN：集群Token</li><li>ETCD_INITIAL_CLUSTER_STATE：加入集群的当前状态，new是新集群，existing表示加入已有集群</li></ul><div class="hint-container tip"><p class="hint-container-title">提示</p><p>etcd 监听 2379 端口，是为了接收组件如：api-server 的数据，2380 端口是为了接收其他 etcd 的数据</p></div><h3 id="_3-通过systemd管理etcd" tabindex="-1"><a class="header-anchor" href="#_3-通过systemd管理etcd"><span>3. 通过systemd管理etcd</span></a></h3><div class="language-bash line-numbers-mode" data-highlighter="shiki" data-ext="bash" style="--shiki-light:#abb2bf;--shiki-dark:#abb2bf;--shiki-light-bg:#282c34;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes one-dark-pro one-dark-pro vp-code"><code><span class="line"><span style="--shiki-light:#61AFEF;--shiki-dark:#61AFEF;">vim</span><span style="--shiki-light:#98C379;--shiki-dark:#98C379;"> /lib/systemd/system/etcd.service</span></span>
<span class="line"><span style="--shiki-light:#7F848E;--shiki-light-font-style:italic;--shiki-dark:#7F848E;--shiki-dark-font-style:italic;"># etcd.service 内容如下</span></span>
<span class="line"><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">[Unit]</span></span>
<span class="line"><span style="--shiki-light:#E06C75;--shiki-dark:#E06C75;">Description</span><span style="--shiki-light:#56B6C2;--shiki-dark:#56B6C2;">=</span><span style="--shiki-light:#98C379;--shiki-dark:#98C379;">Etcd</span><span style="--shiki-light:#61AFEF;--shiki-dark:#61AFEF;"> Server</span></span>
<span class="line"><span style="--shiki-light:#E06C75;--shiki-dark:#E06C75;">After</span><span style="--shiki-light:#56B6C2;--shiki-dark:#56B6C2;">=</span><span style="--shiki-light:#98C379;--shiki-dark:#98C379;">network.target</span></span>
<span class="line"><span style="--shiki-light:#E06C75;--shiki-dark:#E06C75;">After</span><span style="--shiki-light:#56B6C2;--shiki-dark:#56B6C2;">=</span><span style="--shiki-light:#98C379;--shiki-dark:#98C379;">network-online.target</span></span>
<span class="line"><span style="--shiki-light:#E06C75;--shiki-dark:#E06C75;">Wants</span><span style="--shiki-light:#56B6C2;--shiki-dark:#56B6C2;">=</span><span style="--shiki-light:#98C379;--shiki-dark:#98C379;">network-online.target</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">[Service]</span></span>
<span class="line"><span style="--shiki-light:#E06C75;--shiki-dark:#E06C75;">Type</span><span style="--shiki-light:#56B6C2;--shiki-dark:#56B6C2;">=</span><span style="--shiki-light:#98C379;--shiki-dark:#98C379;">notify</span></span>
<span class="line"><span style="--shiki-light:#E06C75;--shiki-dark:#E06C75;">WorkingDirectory</span><span style="--shiki-light:#56B6C2;--shiki-dark:#56B6C2;">=</span><span style="--shiki-light:#98C379;--shiki-dark:#98C379;">/var/lib/etcd/</span></span>
<span class="line"><span style="--shiki-light:#E06C75;--shiki-dark:#E06C75;">EnvironmentFile</span><span style="--shiki-light:#56B6C2;--shiki-dark:#56B6C2;">=</span><span style="--shiki-light:#98C379;--shiki-dark:#98C379;">/etc/kubernetes/etcd/cfg/etcd.conf</span></span>
<span class="line"><span style="--shiki-light:#E06C75;--shiki-dark:#E06C75;">ExecStart</span><span style="--shiki-light:#56B6C2;--shiki-dark:#56B6C2;">=</span><span style="--shiki-light:#98C379;--shiki-dark:#98C379;">/etc/kubernetes/etcd/bin/etcd</span><span style="--shiki-light:#61AFEF;--shiki-dark:#61AFEF;"> \\</span></span>
<span class="line"><span style="--shiki-light:#D19A66;--shiki-dark:#D19A66;">  --cert-file=/etc/kubernetes/ca/etcd/etcd.pem</span><span style="--shiki-light:#56B6C2;--shiki-dark:#56B6C2;"> \\</span></span>
<span class="line"><span style="--shiki-light:#D19A66;--shiki-dark:#D19A66;">  --key-file=/etc/kubernetes/ca/etcd/etcd-key.pem</span><span style="--shiki-light:#56B6C2;--shiki-dark:#56B6C2;"> \\</span></span>
<span class="line"><span style="--shiki-light:#D19A66;--shiki-dark:#D19A66;">  --peer-cert-file=/etc/kubernetes/ca/etcd/etcd.pem</span><span style="--shiki-light:#56B6C2;--shiki-dark:#56B6C2;"> \\</span></span>
<span class="line"><span style="--shiki-light:#D19A66;--shiki-dark:#D19A66;">  --peer-key-file=/etc/kubernetes/ca/etcd/etcd-key.pem</span><span style="--shiki-light:#56B6C2;--shiki-dark:#56B6C2;"> \\</span></span>
<span class="line"><span style="--shiki-light:#D19A66;--shiki-dark:#D19A66;">  --trusted-ca-file=/etc/kubernetes/ca/ca.pem</span><span style="--shiki-light:#56B6C2;--shiki-dark:#56B6C2;"> \\</span></span>
<span class="line"><span style="--shiki-light:#D19A66;--shiki-dark:#D19A66;">  --peer-trusted-ca-file=/etc/kubernetes/ca/ca.pem</span><span style="--shiki-light:#56B6C2;--shiki-dark:#56B6C2;"> \\</span></span>
<span class="line"><span style="--shiki-light:#D19A66;--shiki-dark:#D19A66;">  --logger=zap</span></span>
<span class="line"><span style="--shiki-light:#E06C75;--shiki-dark:#E06C75;">Restart</span><span style="--shiki-light:#56B6C2;--shiki-dark:#56B6C2;">=</span><span style="--shiki-light:#98C379;--shiki-dark:#98C379;">on-failure</span></span>
<span class="line"><span style="--shiki-light:#E06C75;--shiki-dark:#E06C75;">LimitNOFILE</span><span style="--shiki-light:#56B6C2;--shiki-dark:#56B6C2;">=</span><span style="--shiki-light:#98C379;--shiki-dark:#98C379;">65536</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">[Install]</span></span>
<span class="line"><span style="--shiki-light:#E06C75;--shiki-dark:#E06C75;">WantedBy</span><span style="--shiki-light:#56B6C2;--shiki-dark:#56B6C2;">=</span><span style="--shiki-light:#98C379;--shiki-dark:#98C379;">multi-user.target</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><div class="hint-container tip"><p class="hint-container-title">提示</p><p>注意：请修改你的证书存放位置</p></div><h3 id="_4-启动并设置开机启动" tabindex="-1"><a class="header-anchor" href="#_4-启动并设置开机启动"><span>4. 启动并设置开机启动</span></a></h3><div class="language-bash" data-highlighter="shiki" data-ext="bash" style="--shiki-light:#abb2bf;--shiki-dark:#abb2bf;--shiki-light-bg:#282c34;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes one-dark-pro one-dark-pro vp-code"><code><span class="line"><span style="--shiki-light:#61AFEF;--shiki-dark:#61AFEF;">systemctl</span><span style="--shiki-light:#98C379;--shiki-dark:#98C379;"> daemon-reload</span></span>
<span class="line"><span style="--shiki-light:#61AFEF;--shiki-dark:#61AFEF;">systemctl</span><span style="--shiki-light:#98C379;--shiki-dark:#98C379;"> start</span><span style="--shiki-light:#98C379;--shiki-dark:#98C379;"> etcd</span></span>
<span class="line"><span style="--shiki-light:#61AFEF;--shiki-dark:#61AFEF;">systemctl</span><span style="--shiki-light:#98C379;--shiki-dark:#98C379;"> enable</span><span style="--shiki-light:#98C379;--shiki-dark:#98C379;"> etcd</span></span>
<span class="line"><span style="--shiki-light:#7F848E;--shiki-light-font-style:italic;--shiki-dark:#7F848E;--shiki-dark-font-style:italic;"># 查看日志是否启动异常</span></span>
<span class="line"><span style="--shiki-light:#61AFEF;--shiki-dark:#61AFEF;">journalctl</span><span style="--shiki-light:#D19A66;--shiki-dark:#D19A66;"> -f</span><span style="--shiki-light:#D19A66;--shiki-dark:#D19A66;"> -u</span><span style="--shiki-light:#98C379;--shiki-dark:#98C379;"> etcd</span></span></code></pre></div><h3 id="_5-部署多个etcd" tabindex="-1"><a class="header-anchor" href="#_5-部署多个etcd"><span>5. 部署多个etcd</span></a></h3><div class="hint-container tip"><p class="hint-container-title">提示</p><p>如果你需要部署多个 etcd 那么将该节点生成的文件拷贝到其他节点，再修改一下配置就可以了</p></div><div class="language-bash" data-highlighter="shiki" data-ext="bash" style="--shiki-light:#abb2bf;--shiki-dark:#abb2bf;--shiki-light-bg:#282c34;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes one-dark-pro one-dark-pro vp-code"><code><span class="line"><span style="--shiki-light:#7F848E;--shiki-light-font-style:italic;--shiki-dark:#7F848E;--shiki-dark-font-style:italic;"># 拷贝 etcd 二进制文件以及配置</span></span>
<span class="line"><span style="--shiki-light:#61AFEF;--shiki-dark:#61AFEF;">scp</span><span style="--shiki-light:#D19A66;--shiki-dark:#D19A66;"> -r</span><span style="--shiki-light:#98C379;--shiki-dark:#98C379;"> /etc/kubernetes/etcd/</span><span style="--shiki-light:#98C379;--shiki-dark:#98C379;"> root@其他节点IP:/etc/kubernetes/</span></span>
<span class="line"><span style="--shiki-light:#7F848E;--shiki-light-font-style:italic;--shiki-dark:#7F848E;--shiki-dark-font-style:italic;"># 拷贝 service 文件</span></span>
<span class="line"><span style="--shiki-light:#61AFEF;--shiki-dark:#61AFEF;">scp</span><span style="--shiki-light:#D19A66;--shiki-dark:#D19A66;"> -r</span><span style="--shiki-light:#98C379;--shiki-dark:#98C379;"> /lib/systemd/system/etcd.service</span><span style="--shiki-light:#98C379;--shiki-dark:#98C379;"> root@其他节点IP:/lib/systemd/system/</span></span>
<span class="line"><span style="--shiki-light:#7F848E;--shiki-light-font-style:italic;--shiki-dark:#7F848E;--shiki-dark-font-style:italic;"># 拷贝 证书</span></span>
<span class="line"><span style="--shiki-light:#61AFEF;--shiki-dark:#61AFEF;">scp</span><span style="--shiki-light:#D19A66;--shiki-dark:#D19A66;"> -r</span><span style="--shiki-light:#98C379;--shiki-dark:#98C379;"> /etc/kubernetes/ca/</span><span style="--shiki-light:#98C379;--shiki-dark:#98C379;"> root@其他节点IP:/etc/kubernetes/</span></span></code></pre></div><p><strong>然后在节点分别修改etcd.conf配置文件中的节点名称和当前服务器IP：</strong></p><div class="language-bash" data-highlighter="shiki" data-ext="bash" style="--shiki-light:#abb2bf;--shiki-dark:#abb2bf;--shiki-light-bg:#282c34;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes one-dark-pro one-dark-pro vp-code"><code><span class="line"><span style="--shiki-light:#61AFEF;--shiki-dark:#61AFEF;">vim</span><span style="--shiki-light:#98C379;--shiki-dark:#98C379;"> /etc/kubernetes/etcd/cfg/etcd.conf</span></span>
<span class="line"><span style="--shiki-light:#7F848E;--shiki-light-font-style:italic;--shiki-dark:#7F848E;--shiki-dark-font-style:italic;">#[Member]</span></span>
<span class="line"><span style="--shiki-light:#E06C75;--shiki-dark:#E06C75;">ETCD_NAME</span><span style="--shiki-light:#56B6C2;--shiki-dark:#56B6C2;">=</span><span style="--shiki-light:#98C379;--shiki-dark:#98C379;">&quot;etcd-2&quot;</span><span style="--shiki-light:#7F848E;--shiki-light-font-style:italic;--shiki-dark:#7F848E;--shiki-dark-font-style:italic;">   # 修改此处，节点2改为etcd-2</span></span>
<span class="line"><span style="--shiki-light:#E06C75;--shiki-dark:#E06C75;">ETCD_DATA_DIR</span><span style="--shiki-light:#56B6C2;--shiki-dark:#56B6C2;">=</span><span style="--shiki-light:#98C379;--shiki-dark:#98C379;">&quot;/var/lib/etcd/default.etcd&quot;</span></span>
<span class="line"><span style="--shiki-light:#E06C75;--shiki-dark:#E06C75;">ETCD_LISTEN_PEER_URLS</span><span style="--shiki-light:#56B6C2;--shiki-dark:#56B6C2;">=</span><span style="--shiki-light:#98C379;--shiki-dark:#98C379;">&quot;https://192.168.10.101:2380&quot;</span><span style="--shiki-light:#7F848E;--shiki-light-font-style:italic;--shiki-dark:#7F848E;--shiki-dark-font-style:italic;">   # 修改此处为当前服务器IP</span></span>
<span class="line"><span style="--shiki-light:#E06C75;--shiki-dark:#E06C75;">ETCD_LISTEN_CLIENT_URLS</span><span style="--shiki-light:#56B6C2;--shiki-dark:#56B6C2;">=</span><span style="--shiki-light:#98C379;--shiki-dark:#98C379;">&quot;https://192.168.10.101:2379&quot;</span><span style="--shiki-light:#7F848E;--shiki-light-font-style:italic;--shiki-dark:#7F848E;--shiki-dark-font-style:italic;"> # 修改此处为当前服务器IP</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#7F848E;--shiki-light-font-style:italic;--shiki-dark:#7F848E;--shiki-dark-font-style:italic;">#[Clustering]</span></span>
<span class="line"><span style="--shiki-light:#E06C75;--shiki-dark:#E06C75;">ETCD_INITIAL_ADVERTISE_PEER_URLS</span><span style="--shiki-light:#56B6C2;--shiki-dark:#56B6C2;">=</span><span style="--shiki-light:#98C379;--shiki-dark:#98C379;">&quot;https://192.168.10.101:2380&quot;</span><span style="--shiki-light:#7F848E;--shiki-light-font-style:italic;--shiki-dark:#7F848E;--shiki-dark-font-style:italic;"> # 修改此处为当前服务器IP</span></span>
<span class="line"><span style="--shiki-light:#E06C75;--shiki-dark:#E06C75;">ETCD_ADVERTISE_CLIENT_URLS</span><span style="--shiki-light:#56B6C2;--shiki-dark:#56B6C2;">=</span><span style="--shiki-light:#98C379;--shiki-dark:#98C379;">&quot;https://192.168.10.101:2379&quot;</span><span style="--shiki-light:#7F848E;--shiki-light-font-style:italic;--shiki-dark:#7F848E;--shiki-dark-font-style:italic;"> # 修改此处为当前服务器IP</span></span>
<span class="line"><span style="--shiki-light:#E06C75;--shiki-dark:#E06C75;">ETCD_INITIAL_CLUSTER</span><span style="--shiki-light:#56B6C2;--shiki-dark:#56B6C2;">=</span><span style="--shiki-light:#98C379;--shiki-dark:#98C379;">&quot;etcd-2=https://192.168.10.101:2380,etcd-1=https://192.168.10.102:2380&quot;</span></span>
<span class="line"><span style="--shiki-light:#E06C75;--shiki-dark:#E06C75;">ETCD_INITIAL_CLUSTER_TOKEN</span><span style="--shiki-light:#56B6C2;--shiki-dark:#56B6C2;">=</span><span style="--shiki-light:#98C379;--shiki-dark:#98C379;">&quot;etcd-cluster&quot;</span></span>
<span class="line"><span style="--shiki-light:#E06C75;--shiki-dark:#E06C75;">ETCD_INITIAL_CLUSTER_STATE</span><span style="--shiki-light:#56B6C2;--shiki-dark:#56B6C2;">=</span><span style="--shiki-light:#98C379;--shiki-dark:#98C379;">&quot;new&quot;</span></span></code></pre></div><p>最后启动etcd并设置开机启动</p><h3 id="_6-查看集群状态" tabindex="-1"><a class="header-anchor" href="#_6-查看集群状态"><span>6. 查看集群状态</span></a></h3><div class="language-bash" data-highlighter="shiki" data-ext="bash" style="--shiki-light:#abb2bf;--shiki-dark:#abb2bf;--shiki-light-bg:#282c34;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes one-dark-pro one-dark-pro vp-code"><code><span class="line"><span style="--shiki-light:#E06C75;--shiki-dark:#E06C75;">ETCDCTL_API</span><span style="--shiki-light:#56B6C2;--shiki-dark:#56B6C2;">=</span><span style="--shiki-light:#98C379;--shiki-dark:#98C379;">3</span><span style="--shiki-light:#61AFEF;--shiki-dark:#61AFEF;"> /etc/kubernetes/etcd/bin/etcdctl</span><span style="--shiki-light:#D19A66;--shiki-dark:#D19A66;"> --cacert=/etc/kubernetes/ca/ca.pem</span><span style="--shiki-light:#D19A66;--shiki-dark:#D19A66;"> --cert=/etc/kubernetes/ca/etcd/etcd.pem</span><span style="--shiki-light:#D19A66;--shiki-dark:#D19A66;"> --key=/etc/kubernetes/ca/etcd/etcd-key.pem</span><span style="--shiki-light:#D19A66;--shiki-dark:#D19A66;"> --endpoints=</span><span style="--shiki-light:#98C379;--shiki-dark:#98C379;">&quot;https://192.168.10.102:2379&quot;</span><span style="--shiki-light:#98C379;--shiki-dark:#98C379;"> endpoint</span><span style="--shiki-light:#98C379;--shiki-dark:#98C379;"> health</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#7F848E;--shiki-light-font-style:italic;--shiki-dark:#7F848E;--shiki-dark-font-style:italic;"># 输出该结果代表 etcd 部署成功</span></span>
<span class="line"><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">&gt; https://192.168.10.102:2379 is healthy: successfully committed proposal: took = 5.838821ms</span></span></code></pre></div>`,27)]))}const d=i(n,[["render",l]]),r=JSON.parse('{"path":"/tool/kubernetes/02.%E9%83%A8%E7%BD%B2etcd%E8%8A%82%E7%82%B9.html","title":"部署etcd节点","lang":"zh-CN","frontmatter":{"title":"部署etcd节点","date":"2020-08-12T20:14:12.000Z","re":"2020-08-12-kubernetes-deploy-etcd","category":["kubernetes"],"description":"部署 ETCD 节点 1. 简介 kubernetes需要存储很多东西，像它本身的节点信息，组件信息，还有通过kubernetes运行的pod，deployment，service等等。都需要持久化。etcd 就是它的数据中心。生产环境中为了保证数据中心的高可用和数据的一致性，一般会部署最少三个节点。我们这里以学习为主就只在主节点部署一个实例。 2. ...","permalink":"/passages/2020-08-12-kubernetes-deploy-etcd.html","head":[["meta",{"property":"og:url","content":"https://blog.zenghr.cn/passages/2020-08-12-kubernetes-deploy-etcd.html"}],["meta",{"property":"og:site_name","content":"Zenghr"}],["meta",{"property":"og:title","content":"部署etcd节点"}],["meta",{"property":"og:description","content":"部署 ETCD 节点 1. 简介 kubernetes需要存储很多东西，像它本身的节点信息，组件信息，还有通过kubernetes运行的pod，deployment，service等等。都需要持久化。etcd 就是它的数据中心。生产环境中为了保证数据中心的高可用和数据的一致性，一般会部署最少三个节点。我们这里以学习为主就只在主节点部署一个实例。 2. ..."}],["meta",{"property":"og:type","content":"article"}],["meta",{"property":"og:locale","content":"zh-CN"}],["meta",{"property":"og:updated_time","content":"2025-04-07T19:48:14.000Z"}],["meta",{"property":"article:published_time","content":"2020-08-12T20:14:12.000Z"}],["meta",{"property":"article:modified_time","content":"2025-04-07T19:48:14.000Z"}],["script",{"type":"application/ld+json"},"{\\"@context\\":\\"https://schema.org\\",\\"@type\\":\\"Article\\",\\"headline\\":\\"部署etcd节点\\",\\"image\\":[\\"\\"],\\"datePublished\\":\\"2020-08-12T20:14:12.000Z\\",\\"dateModified\\":\\"2025-04-07T19:48:14.000Z\\",\\"author\\":[{\\"@type\\":\\"Person\\",\\"name\\":\\"Zenghr\\"}]}"]]},"git":{"createdTime":1744055294000,"updatedTime":1744055294000,"contributors":[{"name":"zenghr","username":"zenghr","email":"zenghr","commits":1,"url":"https://github.com/zenghr"}]},"readingTime":{"minutes":2.7,"words":810},"filePathRelative":"tool/kubernetes/02.部署etcd节点.md","localizedDate":"2020年8月12日","excerpt":"\\n<h2>1. 简介</h2>\\n<p>kubernetes需要存储很多东西，像它本身的节点信息，组件信息，还有通过kubernetes运行的pod，deployment，service等等。都需要持久化。<code>etcd</code> 就是它的数据中心。生产环境中为了保证数据中心的高可用和数据的一致性，一般会部署最少三个节点。我们这里以学习为主就只在主节点部署一个实例。</p>\\n<h2>2. 从Github下载二进制文件</h2>\\n<p>下载地址：<a href=\\"https://github.com/etcd-io/etcd/releases\\" target=\\"_blank\\" rel=\\"noopener noreferrer\\">https://github.com/etcd-io/etcd/releases</a></p>","autoDesc":true}');export{d as comp,r as data};
