import{_ as i}from"./plugin-vue_export-helper-DlAUqK2U.js";import{c as a,a as e,o as n}from"./app-CLjXuD7o.js";const t={};function h(l,s){return n(),a("div",null,s[0]||(s[0]=[e(`<h1 id="部署dashboard和coredns" tabindex="-1"><a class="header-anchor" href="#部署dashboard和coredns"><span>部署Dashboard和CoreDNS</span></a></h1><h2 id="一、部署dashboard" tabindex="-1"><a class="header-anchor" href="#一、部署dashboard"><span>一、部署Dashboard</span></a></h2><h3 id="_1-1-dashboard简介" tabindex="-1"><a class="header-anchor" href="#_1-1-dashboard简介"><span>1.1 Dashboard简介</span></a></h3><p>Dashboard 是基于网页的 Kubernetes 用户界面。您可以使用 Dashboard 将容器应用部署到 Kubernetes 集群中，也可以对容器应用排错，还能管理集群资源。您可以使用 Dashboard 获取运行在集群中的应用的概览信息，也可以创建或者修改 Kubernetes 资源（如 Deployment，Job，DaemonSet 等等）。例如，您可以对 Deployment 实现弹性伸缩、发起滚动升级、重启 Pod 或者使用向导创建新的应用。</p><p>Dashboard 同时展示了 Kubernetes 集群中的资源状态信息和所有报错信息。</p><p><img src="https://media.zenghr.cn/blog/img/ui-dashboard.png" alt="ui-dashboard"></p><h3 id="_1-2-下载-yaml-文件" tabindex="-1"><a class="header-anchor" href="#_1-2-下载-yaml-文件"><span>1.2 下载 YAML 文件</span></a></h3><div class="language-bash line-numbers-mode" data-highlighter="shiki" data-ext="bash" style="--shiki-light:#abb2bf;--shiki-dark:#abb2bf;--shiki-light-bg:#282c34;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes one-dark-pro one-dark-pro vp-code"><code><span class="line"><span style="--shiki-light:#61AFEF;--shiki-dark:#61AFEF;">wget</span><span style="--shiki-light:#98C379;--shiki-dark:#98C379;"> https://raw.githubusercontent.com/kubernetes/dashboard/v2.0.0/aio/deploy/recommended.yaml</span></span>
<span class="line"><span style="--shiki-light:#7F848E;--shiki-light-font-style:italic;--shiki-dark:#7F848E;--shiki-dark-font-style:italic;"># 默认Dashboard只能集群内部访问，修改Service为NodePort类型，暴露到外部：</span></span>
<span class="line"><span style="--shiki-light:#61AFEF;--shiki-dark:#61AFEF;">vim</span><span style="--shiki-light:#98C379;--shiki-dark:#98C379;"> recommended.yaml</span></span>
<span class="line"><span style="--shiki-light:#7F848E;--shiki-light-font-style:italic;--shiki-dark:#7F848E;--shiki-dark-font-style:italic;"># 修改如下</span></span>
<span class="line"><span style="--shiki-light:#61AFEF;--shiki-dark:#61AFEF;">kind:</span><span style="--shiki-light:#98C379;--shiki-dark:#98C379;"> Service</span></span>
<span class="line"><span style="--shiki-light:#61AFEF;--shiki-dark:#61AFEF;">apiVersion:</span><span style="--shiki-light:#98C379;--shiki-dark:#98C379;"> v1</span></span>
<span class="line"><span style="--shiki-light:#61AFEF;--shiki-dark:#61AFEF;">metadata:</span></span>
<span class="line"><span style="--shiki-light:#61AFEF;--shiki-dark:#61AFEF;">  labels:</span></span>
<span class="line"><span style="--shiki-light:#61AFEF;--shiki-dark:#61AFEF;">    k8s-app:</span><span style="--shiki-light:#98C379;--shiki-dark:#98C379;"> kubernetes-dashboard</span></span>
<span class="line"><span style="--shiki-light:#61AFEF;--shiki-dark:#61AFEF;">  name:</span><span style="--shiki-light:#98C379;--shiki-dark:#98C379;"> kubernetes-dashboard</span></span>
<span class="line"><span style="--shiki-light:#61AFEF;--shiki-dark:#61AFEF;">  namespace:</span><span style="--shiki-light:#98C379;--shiki-dark:#98C379;"> kubernetes-dashboard</span></span>
<span class="line"><span style="--shiki-light:#61AFEF;--shiki-dark:#61AFEF;">spec:</span></span>
<span class="line"><span style="--shiki-light:#61AFEF;--shiki-dark:#61AFEF;">  ports:</span></span>
<span class="line"><span style="--shiki-light:#61AFEF;--shiki-dark:#61AFEF;">    -</span><span style="--shiki-light:#98C379;--shiki-dark:#98C379;"> port:</span><span style="--shiki-light:#D19A66;--shiki-dark:#D19A66;"> 443</span></span>
<span class="line"><span style="--shiki-light:#61AFEF;--shiki-dark:#61AFEF;">      targetPort:</span><span style="--shiki-light:#D19A66;--shiki-dark:#D19A66;"> 8443</span></span>
<span class="line"><span style="--shiki-light:#61AFEF;--shiki-dark:#61AFEF;">      nodePort:</span><span style="--shiki-light:#D19A66;--shiki-dark:#D19A66;"> 30001</span></span>
<span class="line"><span style="--shiki-light:#56B6C2;--shiki-dark:#56B6C2;">  type</span><span style="--shiki-light:#98C379;--shiki-dark:#98C379;">:</span><span style="--shiki-light:#98C379;--shiki-dark:#98C379;"> NodePort</span></span>
<span class="line"><span style="--shiki-light:#61AFEF;--shiki-dark:#61AFEF;">  selector:</span></span>
<span class="line"><span style="--shiki-light:#61AFEF;--shiki-dark:#61AFEF;">    k8s-app:</span><span style="--shiki-light:#98C379;--shiki-dark:#98C379;"> kubernetes-dashboard</span></span>
<span class="line"><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">    </span></span>
<span class="line"><span style="--shiki-light:#7F848E;--shiki-light-font-style:italic;--shiki-dark:#7F848E;--shiki-dark-font-style:italic;"># 启动服务</span></span>
<span class="line"><span style="--shiki-light:#61AFEF;--shiki-dark:#61AFEF;">kubectl</span><span style="--shiki-light:#98C379;--shiki-dark:#98C379;"> apply</span><span style="--shiki-light:#D19A66;--shiki-dark:#D19A66;"> -f</span><span style="--shiki-light:#98C379;--shiki-dark:#98C379;"> recommended.yaml</span></span>
<span class="line"><span style="--shiki-light:#7F848E;--shiki-light-font-style:italic;--shiki-dark:#7F848E;--shiki-dark-font-style:italic;"># 查看</span></span>
<span class="line"><span style="--shiki-light:#61AFEF;--shiki-dark:#61AFEF;">kubectl</span><span style="--shiki-light:#98C379;--shiki-dark:#98C379;"> get</span><span style="--shiki-light:#98C379;--shiki-dark:#98C379;"> pods,svc</span><span style="--shiki-light:#D19A66;--shiki-dark:#D19A66;"> -n</span><span style="--shiki-light:#98C379;--shiki-dark:#98C379;"> kubernetes-dashboard</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>访问地址：<a href="https://nodeip:30001/" target="_blank" rel="noopener noreferrer">https://NodeIP:30001</a></p><h2 id="二、部署-dns" tabindex="-1"><a class="header-anchor" href="#二、部署-dns"><span>二、部署 DNS</span></a></h2><h3 id="_2-1-coredns简介" tabindex="-1"><a class="header-anchor" href="#_2-1-coredns简介"><span>2.1 coreDNS简介</span></a></h3><p>服务发现是 K8s 的一项很重要的功能。K8s 的服务发现有两种方式，一种是将 svc 的 ClusterIP 以环境变量的方式注入到 pod 中；一种就是 DNS，从 1.13 版本开始，coreDNS 就取代了 kube dns 成为了内置的 DNS 服务器。</p><h3 id="_2-2-下载部署脚本" tabindex="-1"><a class="header-anchor" href="#_2-2-下载部署脚本"><span>2.2 下载部署脚本</span></a></h3><div class="language-bash" data-highlighter="shiki" data-ext="bash" style="--shiki-light:#abb2bf;--shiki-dark:#abb2bf;--shiki-light-bg:#282c34;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes one-dark-pro one-dark-pro vp-code"><code><span class="line"><span style="--shiki-light:#61AFEF;--shiki-dark:#61AFEF;">git</span><span style="--shiki-light:#98C379;--shiki-dark:#98C379;"> clone</span><span style="--shiki-light:#98C379;--shiki-dark:#98C379;"> https://github.com/coredns/deployment.git</span></span>
<span class="line"><span style="--shiki-light:#56B6C2;--shiki-dark:#56B6C2;">cd</span><span style="--shiki-light:#98C379;--shiki-dark:#98C379;"> deployment/kubernetes</span></span></code></pre></div><h3 id="_2-3-部署" tabindex="-1"><a class="header-anchor" href="#_2-3-部署"><span>2.3 部署</span></a></h3><p>总体流程是我们使用 <code>deploy.sh</code> 生成 yaml 并保存成 <code>coredns.yaml</code> 文件并执行 <code>kubectl apply -f coredns.yaml</code> 进行部署 ，如果要卸载，执行 <code>kubectl delete -f coredns.yaml</code></p><p><code>deploy.sh</code> 脚本依赖 <code>jq</code> 命令，所以先确保 <code>jq</code> 已安装: <strong><code>apt install -y jq</code></strong></p><div class="hint-container tip"><p class="hint-container-title">提示</p><p>如果集群中没有 kube-dns 或低版本 coredns，我们直接用 <code>-i</code> 参数指定集群 DNS 的 CLUSTER IP，这个 IP 是安装集群时就确定好的，可以在 <code>kubelet</code> 的 <code>clusterDNS</code> 配置设置，示例:</p></div><div class="language-bash" data-highlighter="shiki" data-ext="bash" style="--shiki-light:#abb2bf;--shiki-dark:#abb2bf;--shiki-light-bg:#282c34;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes one-dark-pro one-dark-pro vp-code"><code><span class="line"><span style="--shiki-light:#61AFEF;--shiki-dark:#61AFEF;">./deploy.sh</span><span style="--shiki-light:#D19A66;--shiki-dark:#D19A66;"> -i</span><span style="--shiki-light:#D19A66;--shiki-dark:#D19A66;"> 10.0.0.2</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;"> &gt; </span><span style="--shiki-light:#98C379;--shiki-dark:#98C379;">coredns.yaml</span></span>
<span class="line"><span style="--shiki-light:#61AFEF;--shiki-dark:#61AFEF;">kubectl</span><span style="--shiki-light:#98C379;--shiki-dark:#98C379;"> apply</span><span style="--shiki-light:#D19A66;--shiki-dark:#D19A66;"> -f</span><span style="--shiki-light:#98C379;--shiki-dark:#98C379;"> coredns.yaml</span></span>
<span class="line"><span style="--shiki-light:#7F848E;--shiki-light-font-style:italic;--shiki-dark:#7F848E;--shiki-dark-font-style:italic;"># 查看是否部署成功</span></span>
<span class="line"><span style="--shiki-light:#61AFEF;--shiki-dark:#61AFEF;">kubectl</span><span style="--shiki-light:#98C379;--shiki-dark:#98C379;"> get</span><span style="--shiki-light:#98C379;--shiki-dark:#98C379;"> pods</span><span style="--shiki-light:#D19A66;--shiki-dark:#D19A66;"> -n</span><span style="--shiki-light:#98C379;--shiki-dark:#98C379;"> kube-system</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;"> </span></span>
<span class="line"><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">&gt;</span></span>
<span class="line"><span style="--shiki-light:#61AFEF;--shiki-dark:#61AFEF;">NAME</span><span style="--shiki-light:#98C379;--shiki-dark:#98C379;">                          READY</span><span style="--shiki-light:#98C379;--shiki-dark:#98C379;">   STATUS</span><span style="--shiki-light:#98C379;--shiki-dark:#98C379;">    RESTARTS</span><span style="--shiki-light:#98C379;--shiki-dark:#98C379;">   AGE</span></span>
<span class="line"><span style="--shiki-light:#61AFEF;--shiki-dark:#61AFEF;">coredns-5ffbfd976d-j6shb</span><span style="--shiki-light:#98C379;--shiki-dark:#98C379;">      1/1</span><span style="--shiki-light:#98C379;--shiki-dark:#98C379;">     Running</span><span style="--shiki-light:#D19A66;--shiki-dark:#D19A66;">   0</span><span style="--shiki-light:#98C379;--shiki-dark:#98C379;">          32s</span></span></code></pre></div>`,19)]))}const d=i(t,[["render",h]]),k=JSON.parse('{"path":"/tool/kubernetes/07.%E9%83%A8%E7%BD%B2Dashboard%E5%92%8CCoreDNS.html","title":"部署Dashboard和CoreDNS","lang":"zh-CN","frontmatter":{"title":"部署Dashboard和CoreDNS","date":"2020-08-13T15:30:20.000Z","re":"2020-08-13-kubernetes-deploy-dns","category":["kubernetes"],"description":"部署Dashboard和CoreDNS 一、部署Dashboard 1.1 Dashboard简介 Dashboard 是基于网页的 Kubernetes 用户界面。您可以使用 Dashboard 将容器应用部署到 Kubernetes 集群中，也可以对容器应用排错，还能管理集群资源。您可以使用 Dashboard 获取运行在集群中的应用的概览信息，也...","permalink":"/passages/2020-08-13-kubernetes-deploy-dns.html","head":[["meta",{"property":"og:url","content":"https://blog.zenghr.cn/passages/2020-08-13-kubernetes-deploy-dns.html"}],["meta",{"property":"og:site_name","content":"Zenghr"}],["meta",{"property":"og:title","content":"部署Dashboard和CoreDNS"}],["meta",{"property":"og:description","content":"部署Dashboard和CoreDNS 一、部署Dashboard 1.1 Dashboard简介 Dashboard 是基于网页的 Kubernetes 用户界面。您可以使用 Dashboard 将容器应用部署到 Kubernetes 集群中，也可以对容器应用排错，还能管理集群资源。您可以使用 Dashboard 获取运行在集群中的应用的概览信息，也..."}],["meta",{"property":"og:type","content":"article"}],["meta",{"property":"og:image","content":"https://media.zenghr.cn/blog/img/ui-dashboard.png"}],["meta",{"property":"og:locale","content":"zh-CN"}],["meta",{"property":"og:updated_time","content":"2025-04-07T20:23:00.000Z"}],["meta",{"property":"article:published_time","content":"2020-08-13T15:30:20.000Z"}],["meta",{"property":"article:modified_time","content":"2025-04-07T20:23:00.000Z"}],["script",{"type":"application/ld+json"},"{\\"@context\\":\\"https://schema.org\\",\\"@type\\":\\"Article\\",\\"headline\\":\\"部署Dashboard和CoreDNS\\",\\"image\\":[\\"https://media.zenghr.cn/blog/img/ui-dashboard.png\\"],\\"datePublished\\":\\"2020-08-13T15:30:20.000Z\\",\\"dateModified\\":\\"2025-04-07T20:23:00.000Z\\",\\"author\\":[{\\"@type\\":\\"Person\\",\\"name\\":\\"Zenghr\\"}]}"]]},"git":{"createdTime":1744057380000,"updatedTime":1744057380000,"contributors":[{"name":"zenghr","username":"zenghr","email":"zenghr","commits":1,"url":"https://github.com/zenghr"}]},"readingTime":{"minutes":1.79,"words":537},"filePathRelative":"tool/kubernetes/07.部署Dashboard和CoreDNS.md","localizedDate":"2020年8月13日","excerpt":"\\n<h2>一、部署Dashboard</h2>\\n<h3>1.1 Dashboard简介</h3>\\n<p>Dashboard 是基于网页的 Kubernetes 用户界面。您可以使用 Dashboard 将容器应用部署到 Kubernetes 集群中，也可以对容器应用排错，还能管理集群资源。您可以使用 Dashboard 获取运行在集群中的应用的概览信息，也可以创建或者修改 Kubernetes 资源（如 Deployment，Job，DaemonSet 等等）。例如，您可以对 Deployment 实现弹性伸缩、发起滚动升级、重启 Pod 或者使用向导创建新的应用。</p>\\n<p>Dashboard 同时展示了 Kubernetes 集群中的资源状态信息和所有报错信息。</p>","autoDesc":true}');export{d as comp,k as data};
