import{_ as i}from"./plugin-vue_export-helper-DlAUqK2U.js";import{c as a,a as t,o as h}from"./app-BdIzuXiJ.js";const n={};function e(p,s){return h(),a("div",null,s[0]||(s[0]=[t(`<h2 id="前言" tabindex="-1"><a class="header-anchor" href="#前言"><span>前言</span></a></h2><p>2025年4月22日，小小的老子忙碌了一天，一如既往在个人电脑上使用 <strong>Git</strong> 命令来操作 GitHub 上的项目，本来都很正常，就在 <strong>push</strong> 代码时，突然提示如下错误 ssh: connect to host github.com port 22: Connection refused</p><div class="language-bash" data-highlighter="shiki" data-ext="bash" style="--shiki-light:#abb2bf;--shiki-dark:#abb2bf;--shiki-light-bg:#282c34;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes one-dark-pro one-dark-pro vp-code"><code><span class="line"><span style="--shiki-light:#61AFEF;--shiki-dark:#61AFEF;">$</span><span style="--shiki-light:#98C379;--shiki-dark:#98C379;"> git</span><span style="--shiki-light:#98C379;--shiki-dark:#98C379;"> pull</span></span>
<span class="line"><span style="--shiki-light:#61AFEF;--shiki-dark:#61AFEF;">ssh:</span><span style="--shiki-light:#98C379;--shiki-dark:#98C379;"> connect</span><span style="--shiki-light:#98C379;--shiki-dark:#98C379;"> to</span><span style="--shiki-light:#98C379;--shiki-dark:#98C379;"> host</span><span style="--shiki-light:#98C379;--shiki-dark:#98C379;"> github.com</span><span style="--shiki-light:#98C379;--shiki-dark:#98C379;"> port</span><span style="--shiki-light:#98C379;--shiki-dark:#98C379;"> 22:</span><span style="--shiki-light:#98C379;--shiki-dark:#98C379;"> Connection</span><span style="--shiki-light:#98C379;--shiki-dark:#98C379;"> refused</span></span>
<span class="line"><span style="--shiki-light:#61AFEF;--shiki-dark:#61AFEF;">fatal:</span><span style="--shiki-light:#98C379;--shiki-dark:#98C379;"> Could</span><span style="--shiki-light:#98C379;--shiki-dark:#98C379;"> not</span><span style="--shiki-light:#98C379;--shiki-dark:#98C379;"> read</span><span style="--shiki-light:#98C379;--shiki-dark:#98C379;"> from</span><span style="--shiki-light:#98C379;--shiki-dark:#98C379;"> remote</span><span style="--shiki-light:#98C379;--shiki-dark:#98C379;"> repository.</span></span>
<span class="line"><span style="--shiki-light:#61AFEF;--shiki-dark:#61AFEF;">​</span></span>
<span class="line"><span style="--shiki-light:#61AFEF;--shiki-dark:#61AFEF;">Please</span><span style="--shiki-light:#98C379;--shiki-dark:#98C379;"> make</span><span style="--shiki-light:#98C379;--shiki-dark:#98C379;"> sure</span><span style="--shiki-light:#98C379;--shiki-dark:#98C379;"> you</span><span style="--shiki-light:#98C379;--shiki-dark:#98C379;"> have</span><span style="--shiki-light:#98C379;--shiki-dark:#98C379;"> the</span><span style="--shiki-light:#98C379;--shiki-dark:#98C379;"> correct</span><span style="--shiki-light:#98C379;--shiki-dark:#98C379;"> access</span><span style="--shiki-light:#98C379;--shiki-dark:#98C379;"> rights</span></span>
<span class="line"><span style="--shiki-light:#61AFEF;--shiki-dark:#61AFEF;">and</span><span style="--shiki-light:#98C379;--shiki-dark:#98C379;"> the</span><span style="--shiki-light:#98C379;--shiki-dark:#98C379;"> repository</span><span style="--shiki-light:#98C379;--shiki-dark:#98C379;"> exists.</span></span></code></pre></div><h2 id="排查思路" tabindex="-1"><a class="header-anchor" href="#排查思路"><span>排查思路</span></a></h2><p><code>ssh: connect to host github.com port 22: Connection refused</code> 这个错误提示的是连接<code>github.com</code>的22端口被拒绝了。</p><p>原本以为 <a href="http://github.com" target="_blank" rel="noopener noreferrer">github.com</a> 挂了，但是浏览器访问 <a href="http://github.com" target="_blank" rel="noopener noreferrer">github.com</a> 一切正常</p><p>网上搜索这个报错，发现很多人遇到这个问题，大概有2个原因和对应解决方案</p><h2 id="使用github的443端口" tabindex="-1"><a class="header-anchor" href="#使用github的443端口"><span>使用GitHub的443端口</span></a></h2><p>22端口可能被防火墙屏蔽了，可以尝试连接GitHub的443端口</p><div class="language-" data-highlighter="shiki" data-ext="" style="--shiki-light:#abb2bf;--shiki-dark:#abb2bf;--shiki-light-bg:#282c34;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes one-dark-pro one-dark-pro vp-code"><code><span class="line"><span>$ vim ~/.ssh/config</span></span>
<span class="line"><span>\`\`\`</span></span>
<span class="line"><span># Add section below to it</span></span>
<span class="line"><span>Host github.com</span></span>
<span class="line"><span>Hostname ssh.github.com</span></span>
<span class="line"><span>Port 443</span></span>
<span class="line"><span>\`\`\`</span></span>
<span class="line"><span>$ ssh -T git@github.com</span></span>
<span class="line"><span>Hi xxxxx! You&#39;ve successfully authenticated, but GitHub does not</span></span>
<span class="line"><span>provide shell access.</span></span></code></pre></div><p>这个解决方案的思路是：给<code>~/.ssh/config</code>文件里添加如下内容，这样ssh连接GitHub的时候就会使用443端口</p><div class="language-" data-highlighter="shiki" data-ext="" style="--shiki-light:#abb2bf;--shiki-dark:#abb2bf;--shiki-light-bg:#282c34;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes one-dark-pro one-dark-pro vp-code"><code><span class="line"><span>Host github.com</span></span>
<span class="line"><span>Hostname ssh.github.com</span></span>
<span class="line"><span>Port 443</span></span></code></pre></div><p>如果<code>~/.ssh</code>目录下没有config文件，新建一个即可</p><p>修改完<code>~/.ssh/config</code>文件后，使用<code>ssh -T git@github.com</code>来测试和GitHub的网络通信是否正常，如果提示<code>Hi xxxxx! You&#39;ve successfully authenticated, but GitHub does not provide shell access.</code> 就表示一切正常了</p><p>但是，这个方案在我这里行不通，修改后还是提示<code>ssh: connect to host github.com port 443: Connection refused</code></p><p><strong>这个方案有效的前提是</strong>：执行命令 <code>ssh -T -p 443 git@ssh.github.com</code> 后不再提示<code>connection refused</code>，所以要尝试这个方案的小伙伴先执行这条命令测试下。</p><h2 id="使用https协议-不要使用ssh协议" tabindex="-1"><a class="header-anchor" href="#使用https协议-不要使用ssh协议"><span>使用https协议，不要使用ssh协议</span></a></h2><p>在你的GitHub的本地repo目录，执行如下命令：</p><div class="language-bash" data-highlighter="shiki" data-ext="bash" style="--shiki-light:#abb2bf;--shiki-dark:#abb2bf;--shiki-light-bg:#282c34;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes one-dark-pro one-dark-pro vp-code"><code><span class="line"><span style="--shiki-light:#61AFEF;--shiki-dark:#61AFEF;">$</span><span style="--shiki-light:#98C379;--shiki-dark:#98C379;"> git</span><span style="--shiki-light:#98C379;--shiki-dark:#98C379;"> config</span><span style="--shiki-light:#D19A66;--shiki-dark:#D19A66;"> --local</span><span style="--shiki-light:#D19A66;--shiki-dark:#D19A66;"> -e</span></span></code></pre></div><p>然后把里面的url配置项从git格式</p><div class="language-bash" data-highlighter="shiki" data-ext="bash" style="--shiki-light:#abb2bf;--shiki-dark:#abb2bf;--shiki-light-bg:#282c34;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes one-dark-pro one-dark-pro vp-code"><code><span class="line"><span style="--shiki-light:#61AFEF;--shiki-dark:#61AFEF;">url</span><span style="--shiki-light:#98C379;--shiki-dark:#98C379;"> =</span><span style="--shiki-light:#98C379;--shiki-dark:#98C379;"> git@github.com:username/repo.git</span></span></code></pre></div><p>修改为https格式</p><div class="language-bash" data-highlighter="shiki" data-ext="bash" style="--shiki-light:#abb2bf;--shiki-dark:#abb2bf;--shiki-light-bg:#282c34;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes one-dark-pro one-dark-pro vp-code"><code><span class="line"><span style="--shiki-light:#61AFEF;--shiki-dark:#61AFEF;">url</span><span style="--shiki-light:#98C379;--shiki-dark:#98C379;"> =</span><span style="--shiki-light:#98C379;--shiki-dark:#98C379;"> https://github.com/username/repo.git</span></span></code></pre></div><p>这个其实修改的是repo根目录下的<code>./git/config</code>文件。</p><p><strong>但是这个方法在我这里同样不生效</strong>。</p><h2 id="解决方案" tabindex="-1"><a class="header-anchor" href="#解决方案"><span>解决方案</span></a></h2><p>既然和GitHub建立ssh连接的时候提示<code>connection refused</code>，那我们就详细看看建立ssh连接的过程中发生了什么，可以使用<code>ssh -v</code>命令，<code>-v</code>表示verbose，会打出详细日志</p><div class="language-bash" data-highlighter="shiki" data-ext="bash" style="--shiki-light:#abb2bf;--shiki-dark:#abb2bf;--shiki-light-bg:#282c34;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes one-dark-pro one-dark-pro vp-code"><code><span class="line"><span style="--shiki-light:#61AFEF;--shiki-dark:#61AFEF;">$</span><span style="--shiki-light:#98C379;--shiki-dark:#98C379;"> ssh</span><span style="--shiki-light:#D19A66;--shiki-dark:#D19A66;"> -vT</span><span style="--shiki-light:#98C379;--shiki-dark:#98C379;"> git@github.com</span></span>
<span class="line"><span style="--shiki-light:#61AFEF;--shiki-dark:#61AFEF;">OpenSSH_9.0p1,</span><span style="--shiki-light:#98C379;--shiki-dark:#98C379;"> OpenSSL</span><span style="--shiki-light:#98C379;--shiki-dark:#98C379;"> 1.1.1o</span><span style="--shiki-light:#D19A66;--shiki-dark:#D19A66;">  3</span><span style="--shiki-light:#98C379;--shiki-dark:#98C379;"> May</span><span style="--shiki-light:#D19A66;--shiki-dark:#D19A66;"> 2022</span></span>
<span class="line"><span style="--shiki-light:#61AFEF;--shiki-dark:#61AFEF;">debug1:</span><span style="--shiki-light:#98C379;--shiki-dark:#98C379;"> Reading</span><span style="--shiki-light:#98C379;--shiki-dark:#98C379;"> configuration</span><span style="--shiki-light:#98C379;--shiki-dark:#98C379;"> data</span><span style="--shiki-light:#98C379;--shiki-dark:#98C379;"> /etc/ssh/ssh_config</span></span>
<span class="line"><span style="--shiki-light:#61AFEF;--shiki-dark:#61AFEF;">debug1:</span><span style="--shiki-light:#98C379;--shiki-dark:#98C379;"> Connecting</span><span style="--shiki-light:#98C379;--shiki-dark:#98C379;"> to</span><span style="--shiki-light:#98C379;--shiki-dark:#98C379;"> github.com</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;"> [::1] port 22.</span></span>
<span class="line"><span style="--shiki-light:#61AFEF;--shiki-dark:#61AFEF;">debug1:</span><span style="--shiki-light:#98C379;--shiki-dark:#98C379;"> connect</span><span style="--shiki-light:#98C379;--shiki-dark:#98C379;"> to</span><span style="--shiki-light:#98C379;--shiki-dark:#98C379;"> address</span><span style="--shiki-light:#98C379;--shiki-dark:#98C379;"> ::1</span><span style="--shiki-light:#98C379;--shiki-dark:#98C379;"> port</span><span style="--shiki-light:#98C379;--shiki-dark:#98C379;"> 22:</span><span style="--shiki-light:#98C379;--shiki-dark:#98C379;"> Connection</span><span style="--shiki-light:#98C379;--shiki-dark:#98C379;"> refused</span></span>
<span class="line"><span style="--shiki-light:#61AFEF;--shiki-dark:#61AFEF;">debug1:</span><span style="--shiki-light:#98C379;--shiki-dark:#98C379;"> Connecting</span><span style="--shiki-light:#98C379;--shiki-dark:#98C379;"> to</span><span style="--shiki-light:#98C379;--shiki-dark:#98C379;"> github.com</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;"> [127.0.0.1] port 22.</span></span>
<span class="line"><span style="--shiki-light:#61AFEF;--shiki-dark:#61AFEF;">debug1:</span><span style="--shiki-light:#98C379;--shiki-dark:#98C379;"> connect</span><span style="--shiki-light:#98C379;--shiki-dark:#98C379;"> to</span><span style="--shiki-light:#98C379;--shiki-dark:#98C379;"> address</span><span style="--shiki-light:#D19A66;--shiki-dark:#D19A66;"> 127.0.0.1</span><span style="--shiki-light:#98C379;--shiki-dark:#98C379;"> port</span><span style="--shiki-light:#98C379;--shiki-dark:#98C379;"> 22:</span><span style="--shiki-light:#98C379;--shiki-dark:#98C379;"> Connection</span><span style="--shiki-light:#98C379;--shiki-dark:#98C379;"> refused</span></span>
<span class="line"><span style="--shiki-light:#61AFEF;--shiki-dark:#61AFEF;">ssh:</span><span style="--shiki-light:#98C379;--shiki-dark:#98C379;"> connect</span><span style="--shiki-light:#98C379;--shiki-dark:#98C379;"> to</span><span style="--shiki-light:#98C379;--shiki-dark:#98C379;"> host</span><span style="--shiki-light:#98C379;--shiki-dark:#98C379;"> github.com</span><span style="--shiki-light:#98C379;--shiki-dark:#98C379;"> port</span><span style="--shiki-light:#98C379;--shiki-dark:#98C379;"> 22:</span><span style="--shiki-light:#98C379;--shiki-dark:#98C379;"> Connection</span><span style="--shiki-light:#98C379;--shiki-dark:#98C379;"> refused</span></span></code></pre></div><p>从上面的信息马上就发现了诡异的地方，连接 <a href="http://github.com" target="_blank" rel="noopener noreferrer">github.com</a> 的地址居然是<code>::1</code>和<code>127.0.0.1</code></p><p>前者是IPV6的 localhost 地址，后者是IPV4的 localhost 地址</p><p>到这里问题就很明确了，是 <strong>DNS解析</strong> 出问题了，导致 <a href="https://github.com" target="_blank" rel="noopener noreferrer">github.com</a> 域名被解析成了 localhost 的ip地址，就自然连不上GitHub了</p><p>这个问题其实就是DNS解析被污染了，有2种可能：</p><ul><li>DNS解析被运营商劫持了</li><li>使用了科学上网工具</li></ul><p>按照我下面写的解决方案操作即可解决</p><p>Windows下执行<code>ipconfig /flushdns</code> 清除DNS缓存后也没用</p><p>最后修改hosts文件，增加一条github.com的域名映射搞定。</p><div class="language-bash" data-highlighter="shiki" data-ext="bash" style="--shiki-light:#abb2bf;--shiki-dark:#abb2bf;--shiki-light-bg:#282c34;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes one-dark-pro one-dark-pro vp-code"><code><span class="line"><span style="--shiki-light:#61AFEF;--shiki-dark:#61AFEF;">140.82.113.4</span><span style="--shiki-light:#98C379;--shiki-dark:#98C379;"> github.com</span></span></code></pre></div><p>查找 <strong>github.com</strong> 的ip地址可以使用<a href="https://dnschecker.org/" target="_blank" rel="noopener noreferrer">https://dnschecker.org/</a>来查询 <strong>github.com</strong> 在全球的ip地址</p><p>也可以通过 <a href="https://api.github.com/meta" target="_blank" rel="noopener noreferrer">https://api.github.com/meta</a> 查看 <strong>github.com</strong> 官方公布的IP地址</p>`,39)]))}const r=i(n,[["render",e]]),o=JSON.parse('{"path":"/tool/git/05.%E8%AE%B0%E5%BD%95Git%E7%AA%81%E7%84%B6%E6%8A%A5%E9%94%99%E8%BF%9E%E6%8E%A5github%E7%9A%8422%E7%AB%AF%E5%8F%A3%E8%A2%AB%E6%8B%92%E7%BB%9D%E4%BA%86.html","title":"记录Git突然报错连接github的22端口被拒绝了","lang":"zh-CN","frontmatter":{"title":"记录Git突然报错连接github的22端口被拒绝了","date":"2025-04-22T13:14:15.000Z","re":"git-ssh-error-handle","star":true,"tag":["git"],"category":["git"],"description":"前言 2025年4月22日，小小的老子忙碌了一天，一如既往在个人电脑上使用 Git 命令来操作 GitHub 上的项目，本来都很正常，就在 push 代码时，突然提示如下错误 ssh: connect to host github.com port 22: Connection refused 排查思路 ssh: connect to host git...","permalink":"/tool/git/git-ssh-error-handle.html","head":[["meta",{"property":"og:url","content":"https://blog.zenghr.cn/tool/git/git-ssh-error-handle.html"}],["meta",{"property":"og:site_name","content":"Zenghr"}],["meta",{"property":"og:title","content":"记录Git突然报错连接github的22端口被拒绝了"}],["meta",{"property":"og:description","content":"前言 2025年4月22日，小小的老子忙碌了一天，一如既往在个人电脑上使用 Git 命令来操作 GitHub 上的项目，本来都很正常，就在 push 代码时，突然提示如下错误 ssh: connect to host github.com port 22: Connection refused 排查思路 ssh: connect to host git..."}],["meta",{"property":"og:type","content":"article"}],["meta",{"property":"og:locale","content":"zh-CN"}],["meta",{"property":"og:updated_time","content":"2025-04-29T14:19:06.000Z"}],["meta",{"property":"article:tag","content":"git"}],["meta",{"property":"article:published_time","content":"2025-04-22T13:14:15.000Z"}],["meta",{"property":"article:modified_time","content":"2025-04-29T14:19:06.000Z"}],["script",{"type":"application/ld+json"},"{\\"@context\\":\\"https://schema.org\\",\\"@type\\":\\"Article\\",\\"headline\\":\\"记录Git突然报错连接github的22端口被拒绝了\\",\\"image\\":[\\"\\"],\\"datePublished\\":\\"2025-04-22T13:14:15.000Z\\",\\"dateModified\\":\\"2025-04-29T14:19:06.000Z\\",\\"author\\":[{\\"@type\\":\\"Person\\",\\"name\\":\\"Zenghr\\"}]}"]]},"git":{"createdTime":1745936346000,"updatedTime":1745936346000,"contributors":[{"name":"zenghr","username":"zenghr","email":"zenghr","commits":1,"url":"https://github.com/zenghr"}]},"readingTime":{"minutes":3.05,"words":914},"filePathRelative":"tool/git/05.记录Git突然报错连接github的22端口被拒绝了.md","localizedDate":"2025年4月22日","excerpt":"<h2>前言</h2>\\n<p>2025年4月22日，小小的老子忙碌了一天，一如既往在个人电脑上使用 <strong>Git</strong> 命令来操作 GitHub 上的项目，本来都很正常，就在 <strong>push</strong> 代码时，突然提示如下错误 ssh: connect to host github.com port 22: Connection refused</p>\\n<div class=\\"language-bash\\" data-highlighter=\\"shiki\\" data-ext=\\"bash\\" style=\\"--shiki-light:#abb2bf;--shiki-dark:#abb2bf;--shiki-light-bg:#282c34;--shiki-dark-bg:#282c34\\"><pre class=\\"shiki shiki-themes one-dark-pro one-dark-pro vp-code\\"><code><span class=\\"line\\"><span style=\\"--shiki-light:#61AFEF;--shiki-dark:#61AFEF\\">$</span><span style=\\"--shiki-light:#98C379;--shiki-dark:#98C379\\"> git</span><span style=\\"--shiki-light:#98C379;--shiki-dark:#98C379\\"> pull</span></span>\\n<span class=\\"line\\"><span style=\\"--shiki-light:#61AFEF;--shiki-dark:#61AFEF\\">ssh:</span><span style=\\"--shiki-light:#98C379;--shiki-dark:#98C379\\"> connect</span><span style=\\"--shiki-light:#98C379;--shiki-dark:#98C379\\"> to</span><span style=\\"--shiki-light:#98C379;--shiki-dark:#98C379\\"> host</span><span style=\\"--shiki-light:#98C379;--shiki-dark:#98C379\\"> github.com</span><span style=\\"--shiki-light:#98C379;--shiki-dark:#98C379\\"> port</span><span style=\\"--shiki-light:#98C379;--shiki-dark:#98C379\\"> 22:</span><span style=\\"--shiki-light:#98C379;--shiki-dark:#98C379\\"> Connection</span><span style=\\"--shiki-light:#98C379;--shiki-dark:#98C379\\"> refused</span></span>\\n<span class=\\"line\\"><span style=\\"--shiki-light:#61AFEF;--shiki-dark:#61AFEF\\">fatal:</span><span style=\\"--shiki-light:#98C379;--shiki-dark:#98C379\\"> Could</span><span style=\\"--shiki-light:#98C379;--shiki-dark:#98C379\\"> not</span><span style=\\"--shiki-light:#98C379;--shiki-dark:#98C379\\"> read</span><span style=\\"--shiki-light:#98C379;--shiki-dark:#98C379\\"> from</span><span style=\\"--shiki-light:#98C379;--shiki-dark:#98C379\\"> remote</span><span style=\\"--shiki-light:#98C379;--shiki-dark:#98C379\\"> repository.</span></span>\\n<span class=\\"line\\"><span style=\\"--shiki-light:#61AFEF;--shiki-dark:#61AFEF\\">​</span></span>\\n<span class=\\"line\\"><span style=\\"--shiki-light:#61AFEF;--shiki-dark:#61AFEF\\">Please</span><span style=\\"--shiki-light:#98C379;--shiki-dark:#98C379\\"> make</span><span style=\\"--shiki-light:#98C379;--shiki-dark:#98C379\\"> sure</span><span style=\\"--shiki-light:#98C379;--shiki-dark:#98C379\\"> you</span><span style=\\"--shiki-light:#98C379;--shiki-dark:#98C379\\"> have</span><span style=\\"--shiki-light:#98C379;--shiki-dark:#98C379\\"> the</span><span style=\\"--shiki-light:#98C379;--shiki-dark:#98C379\\"> correct</span><span style=\\"--shiki-light:#98C379;--shiki-dark:#98C379\\"> access</span><span style=\\"--shiki-light:#98C379;--shiki-dark:#98C379\\"> rights</span></span>\\n<span class=\\"line\\"><span style=\\"--shiki-light:#61AFEF;--shiki-dark:#61AFEF\\">and</span><span style=\\"--shiki-light:#98C379;--shiki-dark:#98C379\\"> the</span><span style=\\"--shiki-light:#98C379;--shiki-dark:#98C379\\"> repository</span><span style=\\"--shiki-light:#98C379;--shiki-dark:#98C379\\"> exists.</span></span></code></pre>\\n</div>","autoDesc":true}');export{r as comp,o as data};
