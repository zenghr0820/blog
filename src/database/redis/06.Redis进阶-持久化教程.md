---
title: "Redisè¿›é˜¶-æŒä¹…åŒ–æœºåˆ¶"
date: 2021-08-02 20:00:00
re: redis-rdb-aof
---

# Redis æŒä¹…åŒ–æœºåˆ¶

> Redisæ˜¯ä¸€ä¸ªæ”¯æŒæŒä¹…åŒ–çš„å†…å­˜æ•°æ®åº“ï¼Œä¹Ÿå°±æ˜¯è¯´ redis éœ€è¦ç»å¸¸å°†å†…å­˜ä¸­çš„æ•°æ®åŒæ­¥åˆ°ç¡¬ç›˜æ¥ä¿è¯æŒä¹…åŒ–
>
> RedisæŒä¹…åŒ–ä¸»è¦åˆ†ä¸ºä¸¤ç§æ–¹å¼ï¼Œåˆ†åˆ«æ˜¯RDBå’ŒAOFï¼Œå½“ç„¶å®é™…åœºæ™¯ä¸‹è¿˜ä¼šä½¿ç”¨è¿™ä¸¤ç§çš„æ··åˆæ¨¡å¼

## å‰è¨€

Redisçš„æ•°æ®æ­£å¸¸éƒ½æ˜¯å­˜å‚¨åœ¨å†…å­˜å†…ï¼Œå¦‚æœå®•æœºçªç„¶å‘ç”Ÿï¼Œæ•°æ®å°±ä¼šå…¨éƒ¨ä¸¢å¤±ï¼Œå› æ­¤éœ€è¦æä¾›ä¸€ç§æ–¹å¼ä¿è¯ redis çš„æ•°æ®ä¸ä¼šå› ä¸ºæ•…éšœè€Œä¸¢å¤±ï¼Œè¿™ç§æœºåˆ¶å°±æ˜¯ **redis çš„æŒä¹…åŒ–æœºåˆ¶** 

ç›®å‰ Redis ä¸»æµçš„æŒä¹…åŒ–æœºåˆ¶æœ‰ä¸¤ç§ï¼šRDB æ–¹å¼ å’Œ AOF æ–¹å¼

## RDB æŒä¹…åŒ–

> RDBæŒä¹…åŒ–æ˜¯æŠŠå½“å‰è¿›ç¨‹æ•°æ®ç”Ÿæˆå¿«ç…§ä¿å­˜åˆ°ç¡¬ç›˜çš„è¿‡ç¨‹ï¼Œè§¦å‘RDBæŒä¹…åŒ–è¿‡ç¨‹åˆ†ä¸º **æ‰‹åŠ¨è§¦å‘** å’Œ **è‡ªåŠ¨è§¦å‘**

### æ‰‹åŠ¨è§¦å‘

æ‰‹åŠ¨è§¦å‘åˆ†åˆ«å¯¹åº” save å’Œ bgsave å‘½ä»¤

- **saveå‘½ä»¤**ï¼šé˜»å¡å½“å‰RedisæœåŠ¡å™¨ï¼Œç›´åˆ°RDBè¿‡ç¨‹å®Œæˆä¸ºæ­¢ï¼Œå¯¹äºå†…å­˜ æ¯”è¾ƒå¤§çš„å®ä¾‹ä¼šé€ æˆé•¿æ—¶é—´**é˜»å¡**ï¼Œçº¿ä¸Šç¯å¢ƒä¸å»ºè®®ä½¿ç”¨
- **bgsaveå‘½ä»¤**ï¼šRedisè¿›ç¨‹æ‰§è¡Œforkæ“ä½œåˆ›å»ºå­è¿›ç¨‹ï¼ŒRDBæŒä¹…åŒ–è¿‡ç¨‹ç”±å­è¿›ç¨‹è´Ÿè´£ï¼Œå®Œæˆåè‡ªåŠ¨ç»“æŸã€‚é˜»å¡åªå‘ç”Ÿåœ¨forké˜¶æ®µï¼Œä¸€èˆ¬æ—¶é—´å¾ˆçŸ­

> bgsave å‘½ä»¤æ˜¯é’ˆå¯¹ save é˜»å¡é—®é¢˜åšçš„ä¼˜åŒ–ï¼Œå› æ­¤Rediså†…éƒ¨æ‰€æœ‰æ¶‰åŠåˆ°RDBæ“ä½œéƒ½é‡‡ç”¨ bgsave çš„æ–¹å¼ï¼Œè€Œ ~~save~~ å‘½ä»¤å¯ä»¥åºŸå¼ƒ

bgsaveæµç¨‹å›¾å¦‚ä¸‹æ‰€ç¤ºğŸ‘‡

![eFa8oF](https://media.zenghr.cn/blog/img/20210802/eFa8oF.png)

å…·ä½“æµç¨‹å¦‚ä¸‹ï¼š

- redis å®¢æˆ·ç«¯æ‰§è¡Œ bgsave å‘½ä»¤æˆ–è€…è‡ªåŠ¨è§¦å‘bgsaveå‘½ä»¤ï¼›
- ä¸»è¿›ç¨‹åˆ¤æ–­å½“å‰æ˜¯å¦å·²ç»å­˜åœ¨æ­£åœ¨æ‰§è¡Œçš„å­è¿›ç¨‹ï¼Œå¦‚æœå­˜åœ¨ï¼Œé‚£ä¹ˆä¸»è¿›ç¨‹ç›´æ¥è¿”å›ï¼›
- å¦‚æœä¸å­˜åœ¨æ­£åœ¨æ‰§è¡Œçš„å­è¿›ç¨‹ï¼Œé‚£ä¹ˆå°±forkä¸€ä¸ªæ–°çš„å­è¿›ç¨‹è¿›è¡ŒæŒä¹…åŒ–æ•°æ®ï¼Œforkè¿‡ç¨‹æ˜¯é˜»å¡çš„ï¼Œforkæ“ä½œå®Œæˆåä¸»è¿›ç¨‹å³å¯æ‰§è¡Œå…¶ä»–æ“ä½œï¼›
- å­è¿›ç¨‹å…ˆå°†æ•°æ®å†™å…¥åˆ°ä¸´æ—¶çš„rdbæ–‡ä»¶ä¸­ï¼Œå¾…å¿«ç…§æ•°æ®å†™å…¥å®Œæˆåå†åŸå­æ›¿æ¢æ—§çš„rdbæ–‡ä»¶ï¼›
- åŒæ—¶å‘é€ä¿¡å·ç»™ä¸»è¿›ç¨‹ï¼Œé€šçŸ¥ä¸»è¿›ç¨‹rdbæŒä¹…åŒ–å®Œæˆï¼Œä¸»è¿›ç¨‹æ›´æ–°ç›¸å…³çš„ç»Ÿè®¡ä¿¡æ¯ï¼ˆinfo Persitenceä¸‹çš„rdb_*ç›¸å…³é€‰é¡¹ï¼‰

### è‡ªåŠ¨è§¦å‘

> åœ¨ä»¥ä¸‹4ç§æƒ…å†µæ—¶ä¼šè‡ªåŠ¨è§¦å‘

- redis.confä¸­é…ç½®`save m n`ï¼Œå³åœ¨mç§’å†…æœ‰næ¬¡ä¿®æ”¹æ—¶ï¼Œè‡ªåŠ¨è§¦å‘bgsaveç”Ÿæˆrdbæ–‡ä»¶ï¼›

- ä¸»ä»å¤åˆ¶æ—¶ï¼Œä»èŠ‚ç‚¹è¦ä»ä¸»èŠ‚ç‚¹è¿›è¡Œå…¨é‡å¤åˆ¶æ—¶ä¹Ÿä¼šè§¦å‘bgsaveæ“ä½œï¼Œç”Ÿæˆå½“æ—¶çš„å¿«ç…§å‘é€åˆ°ä»èŠ‚ç‚¹ï¼›

- æ‰§è¡Œ **debug reload** å‘½ä»¤é‡æ–°åŠ è½½ redis æ—¶ä¹Ÿä¼šè§¦å‘bgsaveæ“ä½œï¼›

- é»˜è®¤æƒ…å†µä¸‹æ‰§è¡Œshutdownå‘½ä»¤æ—¶ï¼Œå¦‚æœæ²¡æœ‰å¼€å¯ aofæŒä¹…åŒ–ï¼Œé‚£ä¹ˆä¹Ÿä¼šè§¦å‘bgsaveæ“ä½œ

### redis.confä¸­é…ç½®RDB

- é…ç½®è®¾ç½®è‡ªåŠ¨åšå¿«ç…§æŒä¹…åŒ–æ–¹å¼

```sh
# å‘¨æœŸæ€§æ‰§è¡Œæ¡ä»¶çš„è®¾ç½®æ ¼å¼ä¸º
save <seconds> <changes>

# é»˜è®¤çš„è®¾ç½®ä¸ºï¼š
save 900 1
save 300 10
save 60 10000

# ä»¥ä¸‹è®¾ç½®æ–¹å¼ä¸ºå…³é—­RDBå¿«ç…§åŠŸèƒ½
save ""
```

ä»¥ä¸Šä¸‰é¡¹é»˜è®¤ä¿¡æ¯è®¾ç½®ä»£è¡¨çš„æ„ä¹‰æ˜¯ï¼š

- å¦‚æœ900ç§’å†…æœ‰1æ¡Keyä¿¡æ¯å‘ç”Ÿå˜åŒ–ï¼Œåˆ™è¿›è¡Œå¿«ç…§ï¼›
- å¦‚æœ300ç§’å†…æœ‰10æ¡Keyä¿¡æ¯å‘ç”Ÿå˜åŒ–ï¼Œåˆ™è¿›è¡Œå¿«ç…§ï¼›
- å¦‚æœ60ç§’å†…æœ‰10000æ¡Keyä¿¡æ¯å‘ç”Ÿå˜åŒ–ï¼Œåˆ™è¿›è¡Œå¿«ç…§ã€‚è¯»è€…å¯ä»¥æŒ‰ç…§è¿™ä¸ªè§„åˆ™ï¼Œæ ¹æ®è‡ªå·±çš„å®é™…è¯·æ±‚å‹åŠ›è¿›è¡Œè®¾ç½®è°ƒæ•´

```sh
# æ–‡ä»¶åç§°
dbfilename dump.rdb
# æ–‡ä»¶ä¿å­˜è·¯å¾„
dir /home/work/app/redis/data/
# å¦‚æœæŒä¹…åŒ–å‡ºé”™ï¼Œä¸»è¿›ç¨‹æ˜¯å¦åœæ­¢å†™å…¥
stop-writes-on-bgsave-error yes
# æ˜¯å¦å‹ç¼©
rdbcompression yes
# å¯¼å…¥æ—¶æ˜¯å¦æ£€æŸ¥
rdbchecksum yes
```

- **dbfilenameï¼š** é…ç½®æ–‡ä»¶åï¼Œå¯ä»¥é€šè¿‡æ‰§è¡Œ `config set dir {newDir}` å’Œ `config set dbfilename {newFileName}` è¿è¡ŒæœŸåŠ¨æ€æ‰§è¡Œï¼Œå½“ä¸‹æ¬¡è¿è¡Œæ—¶RDBæ–‡ä»¶ä¼šä¿å­˜åˆ°æ–°ç›®å½•
- **dirï¼š** å¯ä»¥é€šè¿‡æ‰§è¡Œ `config set dir {newDir}` å’Œ `config set dbfilename {newFileName}` è¿è¡ŒæœŸåŠ¨æ€æ‰§è¡Œï¼Œå½“ä¸‹æ¬¡è¿è¡Œæ—¶RDBæ–‡ä»¶ä¼šä¿å­˜åˆ°æ–°ç›®å½•

- **å‹ç¼©ï¼š** Redisé»˜è®¤é‡‡ç”¨ **LZFç®—æ³•** å¯¹ç”Ÿæˆçš„RDBæ–‡ä»¶åšå‹ç¼©å¤„ç†ï¼Œå‹ç¼©åçš„æ–‡ä»¶è¿œè¿œå°äºå†…å­˜å¤§å°ï¼Œé»˜è®¤å¼€å¯ï¼Œå¯ä»¥é€šè¿‡å‚æ•° `config set rdbcompression {yes|no}` åŠ¨æ€ä¿®æ”¹ã€‚
- **æ ¡éªŒï¼š** å¦‚æœRedisåŠ è½½æŸåçš„RDBæ–‡ä»¶æ—¶æ‹’ç»å¯åŠ¨ï¼Œè¿™ä¸ªåŠŸèƒ½å¤§æ¦‚ä¼šå¤šæŸå¤±10%å·¦å³çš„æ€§èƒ½ï¼Œä½†è·å¾—äº†æ›´é«˜çš„æ•°æ®å¯é æ€§ã€‚æ‰€ä»¥å¦‚æœæ‚¨çš„RedisæœåŠ¡éœ€è¦è¿½æ±‚æè‡´çš„æ€§èƒ½ï¼Œå°±å¯ä»¥å°†è¿™ä¸ªé€‰é¡¹è®¾ç½®ä¸º no

### RDB çš„ä¼˜ç¼ºç‚¹

- **ä¼˜ç‚¹ï¼š** 

  - RDBæ–‡ä»¶æ˜¯æŸä¸ªæ—¶é—´èŠ‚ç‚¹çš„å¿«ç…§ï¼Œé»˜è®¤ä½¿ç”¨LZFç®—æ³•è¿›è¡Œå‹ç¼©ï¼Œå‹ç¼©åçš„æ–‡ä»¶ä½“ç§¯è¿œè¿œå°äºå†…å­˜å¤§å°ï¼Œé€‚ç”¨äºå¤‡ä»½ã€å…¨é‡å¤åˆ¶ç­‰åœºæ™¯
  - RedisåŠ è½½RDBæ–‡ä»¶æ¢å¤æ•°æ®è¦è¿œè¿œå¿«äºAOFæ–¹å¼

- **ç¼ºç‚¹ï¼š** 

  - RDBæ–¹å¼å®æ—¶æ€§ä¸å¤Ÿï¼Œæ— æ³•åšåˆ°ç§’çº§çš„æŒä¹…åŒ–ï¼›
  - æ¯æ¬¡è°ƒç”¨bgsaveéƒ½éœ€è¦forkå­è¿›ç¨‹ï¼Œforkå­è¿›ç¨‹å±äºé‡é‡çº§æ“ä½œï¼Œé¢‘ç¹æ‰§è¡Œæˆæœ¬è¾ƒé«˜ï¼›
  - RDBæ–‡ä»¶æ˜¯äºŒè¿›åˆ¶çš„ï¼Œæ²¡æœ‰å¯è¯»æ€§ï¼ŒAOFæ–‡ä»¶åœ¨äº†è§£å…¶ç»“æ„çš„æƒ…å†µä¸‹å¯ä»¥æ‰‹åŠ¨ä¿®æ”¹æˆ–è€…è¡¥å…¨ï¼›
  - ç‰ˆæœ¬å…¼å®¹RDBæ–‡ä»¶é—®é¢˜

  é’ˆå¯¹RDBä¸é€‚åˆå®æ—¶æŒä¹…åŒ–çš„é—®é¢˜ï¼ŒRedisæä¾›äº† **AOFæŒä¹…åŒ–** æ–¹å¼æ¥è§£å†³

## AOF æŒä¹…åŒ–

> AOF(append only file)æŒä¹…åŒ–ï¼šä»¥ç‹¬ç«‹æ—¥å¿—çš„æ–¹å¼è®°å½•æ¯æ¬¡å†™å‘½ä»¤ï¼Œé‡å¯æ—¶å†é‡æ–°æ‰§è¡ŒAOFæ–‡ä»¶ä¸­å‘½ä»¤è¾¾åˆ°æ¢å¤æ•°æ®çš„ç›®çš„ã€‚
>
> AOFçš„ä¸»è¦ä½œç”¨æ˜¯è§£å†³äº†æ•°æ®æŒä¹…åŒ–çš„å®æ—¶æ€§ï¼Œç›®å‰å·²ç»æ˜¯ **RedisæŒä¹…åŒ–çš„ä¸»æµæ–¹å¼**

è€ŒAOFæ—¥å¿—é‡‡ç”¨å†™åæ—¥å¿—ï¼Œå³ **å…ˆå†™å†…å­˜ï¼Œåå†™æ—¥å¿—**

![a20AVK](https://media.zenghr.cn/blog/img/20210802/a20AVK.jpeg)

Redisè¦æ±‚é«˜æ€§èƒ½ï¼Œé‡‡ç”¨å†™æ—¥å¿—æœ‰ä¸¤æ–¹é¢å¥½å¤„ï¼š

- **é¿å…é¢å¤–çš„æ£€æŸ¥å¼€é”€**ï¼šRedis åœ¨å‘ AOF é‡Œé¢è®°å½•æ—¥å¿—çš„æ—¶å€™ï¼Œå¹¶ä¸ä¼šå…ˆå»å¯¹è¿™äº›å‘½ä»¤è¿›è¡Œè¯­æ³•æ£€æŸ¥ã€‚æ‰€ä»¥ï¼Œå¦‚æœå…ˆè®°æ—¥å¿—å†æ‰§è¡Œå‘½ä»¤çš„è¯ï¼Œæ—¥å¿—ä¸­å°±æœ‰å¯èƒ½è®°å½•äº†é”™è¯¯çš„å‘½ä»¤ï¼ŒRedis åœ¨ä½¿ç”¨æ—¥å¿—æ¢å¤æ•°æ®æ—¶ï¼Œå°±å¯èƒ½ä¼šå‡ºé”™ã€‚
- ä¸ä¼šé˜»å¡å½“å‰çš„å†™æ“ä½œ

ä½†è¿™ç§æ–¹å¼å­˜åœ¨æ½œåœ¨é£é™©ï¼š

- å¦‚æœå‘½ä»¤æ‰§è¡Œå®Œæˆï¼Œå†™æ—¥å¿—ä¹‹å‰å®•æœºäº†ï¼Œä¼šä¸¢å¤±æ•°æ®ã€‚
- ä¸»çº¿ç¨‹å†™ç£ç›˜å‹åŠ›å¤§ï¼Œå¯¼è‡´å†™ç›˜æ…¢ï¼Œé˜»å¡åç»­æ“ä½œ

### å¦‚ä½•å®ç° AOF

AOFæ—¥å¿—è®°å½•Redisçš„æ¯ä¸ªå†™å‘½ä»¤ï¼Œæ­¥éª¤åˆ†ä¸ºï¼šå‘½ä»¤è¿½åŠ ï¼ˆappendï¼‰ã€æ–‡ä»¶å†™å…¥ï¼ˆwriteï¼‰å’Œæ–‡ä»¶åŒæ­¥ï¼ˆsyncï¼‰

- **å‘½ä»¤è¿½åŠ ** å½“AOFæŒä¹…åŒ–åŠŸèƒ½æ‰“å¼€äº†ï¼ŒæœåŠ¡å™¨åœ¨æ‰§è¡Œå®Œä¸€ä¸ªå†™å‘½ä»¤ä¹‹åï¼Œä¼šä»¥åè®®æ ¼å¼å°†è¢«æ‰§è¡Œçš„å†™å‘½ä»¤è¿½åŠ åˆ°æœåŠ¡å™¨çš„ **aof_buf** ç¼“å†²åŒºã€‚

- **æ–‡ä»¶å†™å…¥å’ŒåŒæ­¥** å…³äºä½•æ—¶å°† aof_buf ç¼“å†²åŒºçš„å†…å®¹å†™å…¥AOFæ–‡ä»¶ä¸­ï¼ŒRedisæä¾›äº†ä¸‰ç§å†™å›ç­–ç•¥

![LATaFC](https://media.zenghr.cn/blog/img/20210802/LATaFC.jpeg)

- **Always** - åŒæ­¥å†™å›ï¼šæ¯ä¸ªå†™å‘½ä»¤æ‰§è¡Œå®Œï¼Œç«‹é©¬åŒæ­¥åœ°å°†æ—¥å¿—å†™å›ç£ç›˜
- **`Everysec(æ¨è)`** - æ¯ç§’å†™å›ï¼šæ¯ä¸ªå†™å‘½ä»¤æ‰§è¡Œå®Œï¼Œåªæ˜¯å…ˆæŠŠæ—¥å¿—å†™åˆ°AOFæ–‡ä»¶çš„å†…å­˜ç¼“å†²åŒºï¼Œæ¯éš”ä¸€ç§’æŠŠç¼“å†²åŒºä¸­çš„å†…å®¹å†™å…¥ç£ç›˜
- **No**  - æ“ä½œç³»ç»Ÿæ§åˆ¶çš„å†™å›ï¼šæ¯ä¸ªå†™å‘½ä»¤æ‰§è¡Œå®Œï¼Œåªæ˜¯å…ˆæŠŠæ—¥å¿—å†™åˆ°AOFæ–‡ä»¶çš„å†…å­˜ç¼“å†²åŒºï¼Œç”±æ“ä½œç³»ç»Ÿå†³å®šä½•æ—¶å°†ç¼“å†²åŒºå†…å®¹å†™å›ç£ç›˜(ä¸æ¨è)

### Conf é…ç½®AOF

é»˜è®¤æƒ…å†µä¸‹ï¼ŒRedisæ˜¯æ²¡æœ‰å¼€å¯AOFçš„ï¼Œå¯ä»¥é€šè¿‡é…ç½®redis.confæ–‡ä»¶æ¥å¼€å¯AOFæŒä¹…åŒ–ï¼Œå…³äºAOFçš„é…ç½®å¦‚ä¸‹ï¼š

```sh
# appendonlyå‚æ•°å¼€å¯AOFæŒä¹…åŒ–
appendonly no

# AOFæŒä¹…åŒ–çš„æ–‡ä»¶åï¼Œé»˜è®¤æ˜¯appendonly.aof
appendfilename "appendonly.aof"

# AOFæ–‡ä»¶çš„ä¿å­˜ä½ç½®å’ŒRDBæ–‡ä»¶çš„ä½ç½®ç›¸åŒï¼Œéƒ½æ˜¯é€šè¿‡dirå‚æ•°è®¾ç½®çš„
dir ./

# åŒæ­¥ç­–ç•¥
# appendfsync always
appendfsync everysec
# appendfsync no

# aofé‡å†™æœŸé—´æ˜¯å¦åŒæ­¥
no-appendfsync-on-rewrite no

# é‡å†™è§¦å‘é…ç½®
auto-aof-rewrite-percentage 100
auto-aof-rewrite-min-size 64mb

# åŠ è½½aofå‡ºé”™å¦‚ä½•å¤„ç†
aof-load-truncated yes

# æ–‡ä»¶é‡å†™ç­–ç•¥
aof-rewrite-incremental-fsync yes
```

ä»¥ä¸‹æ˜¯Redisä¸­å…³äºAOFçš„ä¸»è¦é…ç½®ä¿¡æ¯ï¼š

- `appendonly`ï¼šé»˜è®¤æƒ…å†µä¸‹AOFåŠŸèƒ½æ˜¯å…³é—­çš„ï¼Œå°†è¯¥é€‰é¡¹æ”¹ä¸ºyesä»¥ä¾¿æ‰“å¼€Redisçš„AOFåŠŸèƒ½ã€‚

- `appendfilename`ï¼šè¿™ä¸ªå‚æ•°é¡¹å¾ˆå¥½ç†è§£äº†ï¼Œå°±æ˜¯AOFæ–‡ä»¶çš„åå­—
- `appendfsync`ï¼šè¿™ä¸ªå‚æ•°é¡¹æ˜¯AOFåŠŸèƒ½æœ€é‡è¦çš„è®¾ç½®é¡¹ä¹‹ä¸€ï¼Œä¸»è¦ç”¨äºè®¾ç½®æ“ä½œå‘½ä»¤å‘AOFæ–‡ä»¶ä¸­åŒæ­¥çš„ç­–ç•¥



## RDBå’ŒAOFæ··åˆæ–¹å¼

> Redis 4.0 ä¸­æå‡ºäº†ä¸€ä¸ª**æ··åˆä½¿ç”¨ AOF æ—¥å¿—å’Œå†…å­˜å¿«ç…§**çš„æ–¹æ³•ã€‚ç®€å•æ¥è¯´ï¼Œå†…å­˜å¿«ç…§ä»¥ä¸€å®šçš„é¢‘ç‡æ‰§è¡Œï¼Œåœ¨ä¸¤æ¬¡å¿«ç…§ä¹‹é—´ï¼Œä½¿ç”¨ AOF æ—¥å¿—è®°å½•è¿™æœŸé—´çš„æ‰€æœ‰å‘½ä»¤æ“ä½œ

è¿™æ ·ä¸€æ¥ï¼Œå¿«ç…§ä¸ç”¨å¾ˆé¢‘ç¹åœ°æ‰§è¡Œï¼Œè¿™å°±é¿å…äº†é¢‘ç¹ fork å¯¹ä¸»çº¿ç¨‹çš„å½±å“ã€‚è€Œä¸”ï¼ŒAOF æ—¥å¿—ä¹Ÿåªç”¨è®°å½•ä¸¤æ¬¡å¿«ç…§é—´çš„æ“ä½œï¼Œä¹Ÿå°±æ˜¯è¯´ï¼Œä¸éœ€è¦è®°å½•æ‰€æœ‰æ“ä½œäº†ï¼Œå› æ­¤ï¼Œå°±ä¸ä¼šå‡ºç°æ–‡ä»¶è¿‡å¤§çš„æƒ…å†µäº†ï¼Œä¹Ÿå¯ä»¥é¿å…é‡å†™å¼€é”€ã€‚

å¦‚ä¸‹å›¾æ‰€ç¤ºï¼ŒT1 å’Œ T2 æ—¶åˆ»çš„ä¿®æ”¹ï¼Œç”¨ AOF æ—¥å¿—è®°å½•ï¼Œç­‰åˆ°ç¬¬äºŒæ¬¡åšå…¨é‡å¿«ç…§æ—¶ï¼Œå°±å¯ä»¥æ¸…ç©º AOF æ—¥å¿—ï¼Œå› ä¸ºæ­¤æ—¶çš„ä¿®æ”¹éƒ½å·²ç»è®°å½•åˆ°å¿«ç…§ä¸­äº†ï¼Œæ¢å¤æ—¶å°±ä¸å†ç”¨æ—¥å¿—äº†

![yBKz08](https://media.zenghr.cn/blog/img/20210802/yBKz08.jpeg)

è¿™ä¸ªæ–¹æ³•æ—¢èƒ½äº«å—åˆ° RDB æ–‡ä»¶å¿«é€Ÿæ¢å¤çš„å¥½å¤„ï¼Œåˆèƒ½äº«å—åˆ° AOF åªè®°å½•æ“ä½œå‘½ä»¤çš„ç®€å•ä¼˜åŠ¿, å®é™…ç¯å¢ƒä¸­ç”¨çš„å¾ˆå¤š

## å‚è€ƒæ–‡æ¡£

- [https://www.cnblogs.com/ybyn/p/14157568.html](https://www.cnblogs.com/ybyn/p/14157568.html)

- [https://segmentfault.com/a/1190000015983518](https://segmentfault.com/a/1190000015983518)

- [https://blog.csdn.net/qq_41434612/article/details/108791437](https://blog.csdn.net/qq_41434612/article/details/108791437)

- [https://www.cnblogs.com/liang24/p/14180036.html](https://www.cnblogs.com/liang24/p/14180036.html)

- [https://www.jianshu.com/p/d3ba7b8ad964](https://www.jianshu.com/p/d3ba7b8ad964)

- [https://blog.csdn.net/liupeifeng3514/article/details/79048767](https://blog.csdn.net/liupeifeng3514/article/details/79048767)

- [https://www.pdai.tech/md/db/nosql-redis/db-redis-x-rdb-aof.html](https://www.pdai.tech/md/db/nosql-redis/db-redis-x-rdb-aof.html)

