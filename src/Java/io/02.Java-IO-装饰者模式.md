---
title: "Java I/O - è£…é¥°è€…æ¨¡å¼"
date: 2021-05-06 21:30:12
re: 2021-05-06-java-io-decorator-pattern
category:
  - Java
---

# Java I/O ä¸­çš„è®¾è®¡æ¨¡å¼(è£…é¥°)

:::tip

æœ¬æ–‡äº†è§£ Java è®¾è®¡æ¨¡å¼ä¸­çš„ä¸€ç§æ¨¡å¼ï¼Œè£…é¥°è€…æ¨¡å¼ï¼Œåœ¨ Java.io åŒ…ä¸­çš„ åŒ…è£…æµ ä¸­å°±ä½¿ç”¨äº†è£…é¥°è€…æ¨¡å¼

:::

å¦‚éœ€äº†è§£è£…é¥°å™¨æ¨¡å¼è¯¦è§£è¯·çœ‹ğŸ‘‰ [è£…é¥°å™¨æ¨¡å¼è¯¦è§£](/passages/dev-decorator-pattern.html)

## è£…é¥°å™¨æ¨¡å¼

è£…é¥°å™¨æ¨¡å¼ï¼ˆDecorator Patternï¼‰å…è®¸å‘ä¸€ä¸ªç°æœ‰çš„å¯¹è±¡æ·»åŠ æ–°çš„åŠŸèƒ½ï¼ŒåŒæ—¶åˆä¸æ”¹å˜å…¶ç»“æ„ï¼Œè£…é¥°å™¨æ¨¡å¼ä¸­æœ‰å››ä¸ªé‡è¦çš„è§’è‰²

- æŠ½è±¡æ„ä»¶è§’è‰² (Component)
- å…·ä½“æ„ä»¶è§’è‰²(ConcreteComponent)
- æŠ½è±¡è£…é¥°è€…è§’è‰²(Decorator)
- å…·ä½“è£…é¥°è€…è§’è‰²(ConcreteDecorator)

ä»¥ **InputStream** ä¸¾ä¾‹ï¼Œå®ƒå°±æ˜¯ä¸€ä¸ª **æŠ½è±¡çš„æ„å»ºè§’è‰²(Component)**

```java
public abstract class InputStream implements Closeable {
    // ...
}
```

**ä¸”å®šä¹‰æœ‰æŠ½è±¡æ–¹æ³•**

```java
public abstract int read() throws IOException;
public void close() throws IOException {}
```

è¯¥æŠ½è±¡æ–¹æ³•ç”±å…·ä½“çš„å­ç±»å»å®ç°ï¼Œç›´æ¥ç»§æ‰¿äº† **InputStream**ï¼Œå¹¶ä¸”æä¾›æŸä¸€ç‰¹å®šåŠŸèƒ½çš„å­ç±»æœ‰

- ByteArrayInputStream
- FileInputStream
- FilterInputStream
- PipedInputStream
- DataInputStream

è¿™äº›å­ç±»éƒ½æœ‰è‡ªå·±ç‰¹å®šçš„åŠŸèƒ½ï¼ŒFileInputStream ä»£è¡¨æ–‡ä»¶è¾“å…¥æµï¼Œæˆ‘ä»¬ç§°è¿™äº›å­ç±»ä¸º **å…·ä½“æ„ä»¶è§’è‰²(ConcreteComponent)**

## æŠ½è±¡è£…é¥°è€…(Decorator)

åœ¨è¿™äº›ç±»ä¸­æœ‰ä¸€ä¸ªç±»å’Œå…¶ä»–ç±»ä¸åŒ - **FilterInputStream**ï¼ŒæŸ¥çœ‹å…¶æºä»£ç å¯çŸ¥ï¼Œå…¶å†…éƒ¨ç»´æŠ¤äº†ä¸€ä¸ª **InputStream** å¯¹è±¡ï¼Œå¹¶ä¸”å®ƒçš„æ‰€æœ‰æ–¹æ³•ï¼Œéƒ½æ˜¯è°ƒç”¨è¿™ä¸ªæˆå‘˜å¯¹è±¡çš„åŒåæ–¹æ³•ï¼Œé‚£ä¹ˆè¿™ä¸ª **FilterInputStream** å°±æ˜¯ä¸€ä¸ª**æŠ½è±¡è£…é¥°è€…(Decorator)**

```java
public class FilterInputStream extends InputStream {
    protected volatile InputStream in;
    
    protected FilterInputStream(InputStream in) {
        this.in = in;
    }
    
    public int read() throws IOException {
        return in.read();
    }
    
    public int read(byte b[]) throws IOException {
        return read(b, 0, b.length);
    }
    
    public int read(byte b[], int off, int len) throws IOException {
        return in.read(b, off, len);
    }
    
    public long skip(long n) throws IOException {
        return in.skip(n);
    }
    
    public int available() throws IOException {
        return in.available();
    }
    
    public void close() throws IOException {
        in.close();
    }
    
    public synchronized void mark(int readlimit) {
        in.mark(readlimit);
    }

    public synchronized void reset() throws IOException {
        in.reset();
    }
    
    public boolean markSupported() {
        return in.markSupported();
    }
}
```

FilterInputStream ç±»ä¸‹é¢æœ‰å®ƒçš„ä¸€äº›å­ç±»ï¼Œæˆ‘ä»¬ä¸»è¦çœ‹å¸¸ç”¨çš„ **BufferedInputStream** ç¼“å†²åŒ…è£…æµï¼ŒæŸ¥çœ‹å®ƒçš„æºä»£ç 

```java
public class BufferedInputStream extends FilterInputStream {
    public BufferedInputStream(InputStream in, int size) {
        super(in);
        if (size <= 0) {
            throw new IllegalArgumentException("Buffer size <= 0");
        }
        buf = new byte[size];
    }
    
    public synchronized int read() throws IOException {
        if (pos >= count) {
            fill();
            if (pos >= count)
                return -1;
        }
        return getBufIfOpen()[pos++] & 0xff;
    }
}
```

æŸ¥çœ‹å®ƒçš„ **read()** æ–¹æ³•æºç å¯çŸ¥ï¼Œ**BufferedInputStream** å°±æ˜¯ä¸€ä¸ªå…·ä½“çš„**è£…é¥°è€…è§’è‰²(ConcreteDecorator)**ï¼Œå®ƒèƒ½ä¸ºä¸€ä¸ªåŸæœ¬æ²¡æœ‰ç¼“å†²åŠŸèƒ½çš„ InputStream æ·»åŠ ä¸Šç¼“å†²çš„åŠŸèƒ½ï¼Œä¾‹å¦‚ FIleInputStream å¹¶æ²¡æœ‰ç¼“å­˜åŠŸèƒ½ï¼Œä½¿ç”¨ BufferedInputStream æ¥**è£…é¥°**å®ƒï¼Œä½¿å¾—å…¶å…·å¤‡ç¼“å­˜èƒ½åŠ›ï¼Œæé«˜ç¨‹åºçš„æ€§èƒ½