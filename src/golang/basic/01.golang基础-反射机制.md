---
title: "golangåŸºç¡€ - åå°„æœºåˆ¶"
date: 2021-06-26 14:14:14
re: golang-reflect
star: true
category:
  - golang
  
tag:
  - golang
---

# golang åå°„æœºåˆ¶

å’Œ Java è¯­è¨€ä¸€æ ·ï¼ŒGo ä¹Ÿå®ç°è¿è¡Œæ—¶åå°„ï¼Œè¿™ä¸ºæˆ‘ä»¬æä¾›ä¸€ç§å¯ä»¥åœ¨è¿è¡Œæ—¶æ“ä½œä»»æ„ç±»å‹å¯¹è±¡çš„èƒ½åŠ›ã€‚

åœ¨ go è¯­è¨€ä¸­ï¼Œå®ç°åå°„èƒ½åŠ›çš„æ˜¯ `reflect`åŒ…ï¼Œèƒ½å¤Ÿè®©ç¨‹åºæ“ä½œä¸åŒç±»å‹çš„å¯¹è±¡ã€‚å…¶ä¸­ï¼Œåœ¨åå°„åŒ…ä¸­æœ‰ä¸¤ä¸ªéå¸¸é‡è¦çš„ **ç±»å‹**å’Œ **å‡½æ•°**ï¼Œä¸¤ä¸ªå‡½æ•°åˆ†åˆ«æ˜¯ï¼š

- **`reflect.TypeOf`** - èƒ½è·å–å¯¹è±¡çš„ç±»å‹çš„ä¿¡æ¯
- **`reflect.ValueOf`** - èƒ½è·å–å¯¹è±¡çš„æ•°æ®

ä¸¤ä¸ªç±»å‹æ˜¯ [**`reflect.Type`**](https://golang.org/pkg/reflect/#Type) å’Œ [**`reflect.Value`**](https://golang.org/pkg/reflect/#Value)ï¼Œå®ƒä»¬ä¸å‡½æ•°æ˜¯ä¸€ä¸€å¯¹åº”çš„å…³ç³»ï¼š

![6hzQxX](https://media.zenghr.cn/blog/img/20210626/6hzQxX.png)

## golang åå°„æ³¨æ„<Badge text="New"/>

:::tip

golang åå°„ä¸èƒ½**è·å–å’Œä¿®æ”¹** ç§æœ‰çš„å±æ€§ä»¥åŠæ–¹æ³•

**ValueOf(*ptr)** æ–¹æ³•ä¼ é€’çš„å‚æ•°å¿…é¡»æ˜¯ **æŒ‡é’ˆç±»å‹** æ‰å¯ä»¥ä¿®æ”¹å­—æ®µå¦åˆ™ä¼šæŠ¥é”™

:::

## Type å’Œ TypeOf

**reflect.Type** ç±»å‹æ˜¯ä¸€ä¸ªæ¥å£ç±»å‹ï¼Œå†…éƒ¨æŒ‡å®šäº†è‹¥å¹²æ–¹æ³•ï¼Œé€šè¿‡è¿™äº›æ–¹æ³•æˆ‘ä»¬å¯ä»¥è·å–åˆ°åå°„ç±»å‹çš„å„ç§ä¿¡æ¯ï¼Œä¾‹å¦‚ï¼šå­—æ®µã€æ–¹æ³•ç­‰

ä½¿ç”¨ ***reflect.TypeOf()*** å‡½æ•°å¯ä»¥è·å–å°†ä»»æ„å€¼çš„ç±»å‹å¯¹è±¡ (`reflect.Type`)ï¼Œç¨‹åºé€šè¿‡ç±»å‹å¯¹è±¡å¯ä»¥è®¿é—®ä»»æ„å€¼çš„ç±»å‹ä¿¡æ¯

### 1. ç†è§£ Type å’Œ ç§ç±» Kind

**reflect.Type æ˜¯å˜é‡çš„ç±»å‹ï¼Œè€Œä¸æ˜¯è¿½æ ¹æº¯æºçš„æœ€åº•å±‚ç±»å‹**

```go
type MyInt int
reflect.TypeOf(MyInt).Kind()
```

è¿™é‡Œçš„ reflect.Type å°±æ˜¯ *`MyInt`*ï¼Œè€Œé intï¼Œå¦‚æœæƒ³è·å¾— int åªèƒ½ä½¿ç”¨**Kind()**

æ€»ç»“ï¼š***Type è¡¨ç¤ºçš„æ˜¯é™æ€ç±»å‹ï¼Œè€Œ kind è¡¨ç¤ºçš„æ˜¯åº•å±‚çœŸå®çš„ç±»å‹***

### 2. è·å–ç±»å‹åä»¥åŠ kind

```go
package main

import (
    "fmt"
    "reflect"
)

// å®šä¹‰ä¸€ä¸ª MyInt ç±»å‹
type MyInt int

func main() {
    // å£°æ˜ä¸€ä¸ªç©ºç»“æ„ä½“
    type cat struct {
    }
    // è·å–ç»“æ„ä½“å®ä¾‹çš„åå°„ç±»å‹å¯¹è±¡
    typeOfCat := reflect.TypeOf(cat{})
    // æ˜¾ç¤ºåå°„ç±»å‹å¯¹è±¡çš„åç§°å’Œç§ç±»
    fmt.Println(typeOfCat.Name(), typeOfCat.Kind())
    // è·å–Zeroå¸¸é‡çš„åå°„ç±»å‹å¯¹è±¡
    typeOfA := reflect.TypeOf(Zero)
    // æ˜¾ç¤ºåå°„ç±»å‹å¯¹è±¡çš„åç§°å’Œç§ç±»
    fmt.Println(typeOfA.Name(), typeOfA.Kind())
}
```

ä»£ç è¾“å‡ºå¦‚ä¸‹ï¼š

> cat struct
>
> MyInt int

### 3. Type å¸¸ç”¨æ–¹æ³•

è·å–ä¸æˆå‘˜ç›¸å…³çš„æ–¹æ³•å¦‚ä¸‹ï¼š

| æ–¹æ³•                                             | æè¿°                                                         |
| ------------------------------------------------ | ------------------------------------------------------------ |
| **Field**(i int) StructField                     | æ ¹æ®ç´¢å¼•ï¼Œè¿”å›ç´¢å¼•å¯¹åº”çš„ç»“æ„ä½“å­—æ®µçš„ä¿¡æ¯ã€‚å½“å€¼ä¸æ˜¯ç»“æ„ä½“æˆ–ç´¢å¼•è¶…ç•Œæ—¶å‘ç”Ÿå®•æœº |
| **NumField**() int                               | è¿”å›ç»“æ„ä½“æˆå‘˜å­—æ®µæ•°é‡(åŒ…å«ç§æœ‰å­—æ®µ)                         |
| **FieldByName**(name string) (StructField, bool) | æ ¹æ®ç»™å®šå­—ç¬¦ä¸²è¿”å›å­—ç¬¦ä¸²å¯¹åº”çš„ç»“æ„ä½“å­—æ®µçš„ä¿¡æ¯ã€‚æ²¡æœ‰æ‰¾åˆ°æ—¶ bool è¿”å› false |
| FieldByIndex(index []int) StructField            | å¤šå±‚æˆå‘˜è®¿é—®æ—¶ï¼Œæ ¹æ® []int æä¾›çš„æ¯ä¸ªç»“æ„ä½“çš„å­—æ®µç´¢å¼•ï¼Œè¿”å›å­—æ®µçš„ä¿¡æ¯ã€‚æ²¡æœ‰æ‰¾åˆ°æ—¶è¿”å›é›¶å€¼ |

**StructFieldç»“æ„**ï¼Œè¿™ä¸ªç»“æ„æè¿°ç»“æ„ä½“çš„æˆå‘˜ä¿¡æ¯ï¼Œé€šè¿‡è¿™ä¸ªä¿¡æ¯å¯ä»¥è·å–æˆå‘˜ä¸ç»“æ„ä½“çš„å…³ç³»ï¼Œå¦‚åç§»ã€ç´¢å¼•ã€æ˜¯å¦ä¸ºåŒ¿åå­—æ®µã€ç»“æ„ä½“æ ‡ç­¾ï¼ˆStruct Tagï¼‰ç­‰

```go
type StructField struct {
	Name      string    // å­—æ®µå
	PkgPath   string    // å­—æ®µè·¯å¾„
	Type      Type      // å­—æ®µåå°„ç±»å‹å¯¹è±¡
	Tag       StructTag // å­—æ®µçš„ç»“æ„ä½“æ ‡ç­¾
	Offset    uintptr   // å­—æ®µåœ¨ç»“æ„ä½“ä¸­çš„ç›¸å¯¹åç§»
	Index     []int     // Type.FieldByIndexä¸­çš„è¿”å›çš„ç´¢å¼•å€¼
	Anonymous bool      // æ˜¯å¦ä¸ºåŒ¿åå­—æ®µ
}
```

### 4. è·å–æˆå‘˜åå°„ä¿¡æ¯

```go
package main
import (
	"fmt"
	"reflect"
)
func main() {
	// å£°æ˜ä¸€ä¸ªç©ºç»“æ„ä½“
	type cat struct {
		Name string
		// å¸¦æœ‰ç»“æ„ä½“tagçš„å­—æ®µ
		Type int `json:"type" id:"100"`
	}
	// åˆ›å»ºcatçš„å®ä¾‹
	ins := cat{Name: "mimi", Type: 1}
	// è·å–ç»“æ„ä½“å®ä¾‹çš„åå°„ç±»å‹å¯¹è±¡
	typeOfCat := reflect.TypeOf(ins)
	// éå†ç»“æ„ä½“æ‰€æœ‰æˆå‘˜
	for i := 0; i < typeOfCat.NumField(); i++ {
		// è·å–æ¯ä¸ªæˆå‘˜çš„ç»“æ„ä½“å­—æ®µç±»å‹
		fieldType := typeOfCat.Field(i)
		// è¾“å‡ºæˆå‘˜åå’Œtag
		fmt.Printf("name: %v  tag: '%v'\n", fieldType.Name, fieldType.Tag)
	}
	// é€šè¿‡å­—æ®µå, æ‰¾åˆ°å­—æ®µç±»å‹ä¿¡æ¯
	if catType, ok := typeOfCat.FieldByName("Type"); ok {
		// ä»tagä¸­å–å‡ºéœ€è¦çš„tag
		fmt.Println(catType.Tag.Get("json"), catType.Tag.Get("id"))
	}
}
```

### 5. é€šè¿‡ç±»å‹ä¿¡æ¯åˆ›å»ºå®ä¾‹

å½“å·²çŸ¥ reflect.Type æ—¶ï¼Œå¯ä»¥åŠ¨æ€åœ°åˆ›å»ºè¿™ä¸ªç±»å‹çš„å®ä¾‹ï¼Œå®ä¾‹çš„ç±»å‹ä¸ºæŒ‡é’ˆ

```go
func main() {
	var a int
	// å–å˜é‡açš„åå°„ç±»å‹å¯¹è±¡
	typeOfA := reflect.TypeOf(a)
	// æ ¹æ®åå°„ç±»å‹å¯¹è±¡åˆ›å»ºç±»å‹å®ä¾‹
	aIns := reflect.New(typeOfA)
	// è¾“å‡ºï¼š*int ptr
	fmt.Println(aIns.Type(), aIns.Kind())
}
```



## Value å’Œ ValueOf

**reflect.Value** ç±»å‹æ˜¯ä¸€ä¸ªç»“æ„ä½“ï¼Œå°è£…äº†åå°„å¯¹è±¡çš„å€¼ï¼Œå†…éƒ¨è‹¥å¹²æ–¹æ³•ï¼Œå¯ä»¥é€šè¿‡è¿™äº›æ–¹æ³•æ¥è·å–å’Œä¿®æ”¹å¯¹è±¡çš„å€¼ï¼Œä½¿ç”¨ **`reflect.ValueOf`** å‡½æ•°å¯ä»¥è¿”å› Value ç±»å‹ï¼Œvalue ç±»å‹è¿˜å¯ä»¥ç”ŸæˆåŸå§‹ç±»å‹å¯¹è±¡

### 1. ç”ŸæˆåŸå§‹ç±»å‹çš„å¯¹è±¡

å¯ä»¥é€šè¿‡ä¸‹é¢å‡ ç§æ–¹æ³•ä»åå°„å€¼å¯¹è±¡ reflect.Value ä¸­è·å–åŸå€¼

| æ–¹æ³•å                       | è¯´  æ˜                                                       |
| ---------------------------- | ------------------------------------------------------------ |
| **Interface**() interface {} | å°†å€¼ä»¥ interface{} ç±»å‹è¿”å›ï¼Œå¯ä»¥é€šè¿‡ç±»å‹æ–­è¨€è½¬æ¢ä¸ºæŒ‡å®šç±»å‹  |
| Int() int64                  | å°†å€¼ä»¥ int ç±»å‹è¿”å›ï¼Œæ‰€æœ‰æœ‰ç¬¦å·æ•´å‹å‡å¯ä»¥æ­¤æ–¹å¼è¿”å›          |
| Uint() uint64                | å°†å€¼ä»¥ uint ç±»å‹è¿”å›ï¼Œæ‰€æœ‰æ— ç¬¦å·æ•´å‹å‡å¯ä»¥æ­¤æ–¹å¼è¿”å›         |
| Float() float64              | å°†å€¼ä»¥åŒç²¾åº¦ï¼ˆfloat64ï¼‰ç±»å‹è¿”å›ï¼Œæ‰€æœ‰æµ®ç‚¹æ•°ï¼ˆfloat32ã€float64ï¼‰å‡å¯ä»¥æ­¤æ–¹å¼è¿”å› |
| Bool() bool                  | å°†å€¼ä»¥ bool ç±»å‹è¿”å›                                         |
| Bytes() []bytes              | å°†å€¼ä»¥å­—èŠ‚æ•°ç»„ []bytes ç±»å‹è¿”å›                              |
| String() string              | å°†å€¼ä»¥å­—ç¬¦ä¸²ç±»å‹è¿”å›                                         |

ä»£ç æ¼”ç¤ºå¦‚ä¸‹ğŸ‘‡

```go
func main() {
    // å£°æ˜æ•´å‹å˜é‡aå¹¶èµ‹åˆå€¼
    var a int = 1024
    // è·å–å˜é‡açš„åå°„å€¼å¯¹è±¡
    valueOfA := reflect.ValueOf(a)
    // è·å–interface{}ç±»å‹çš„å€¼, é€šè¿‡ç±»å‹æ–­è¨€è½¬æ¢
    var getA int = valueOfA.Interface().(int)
    // è·å–64ä½çš„å€¼, å¼ºåˆ¶ç±»å‹è½¬æ¢ä¸ºintç±»å‹
    var getA2 int = int(valueOfA.Int())
    fmt.Println(getA, getA2)
}
```

### 2. æ“ä½œç»“æ„ä½“æˆå‘˜çš„å€¼

åå°„å€¼å¯¹è±¡ï¼ˆreflect.Valueï¼‰æä¾›å¯¹ç»“æ„ä½“è®¿é—®çš„æ–¹æ³•ï¼Œé€šè¿‡è¿™äº›æ–¹æ³•å¯ä»¥å®Œæˆå¯¹ç»“æ„ä½“ä»»æ„å€¼çš„è®¿é—®ï¼Œæ–¹æ³•åˆ—è¡¨å‚è€ƒ [Type å¸¸ç”¨æ–¹æ³•](#_3-type-å¸¸ç”¨æ–¹æ³•)

**ä¿®æ”¹æˆå‘˜çš„å€¼** ä½¿ç”¨ reflect.Value å¯¹åŒ…è£…çš„å€¼è¿›è¡Œä¿®æ”¹æ—¶ï¼Œéœ€è¦éµå¾ªä¸€äº›è§„åˆ™ã€‚å¦‚æœè¯¥å¯¹è±¡ä¸å¯å¯»å€æˆ–è€…æˆå‘˜æ˜¯ç§æœ‰çš„ï¼Œåˆ™æ— æ³•ä¿®æ”¹å¯¹è±¡å€¼

**åˆ¤å®šæ˜¯å¦å¯ä»¥æ“ä½œçš„æ–¹æ³•æœ‰å¦‚ä¸‹ğŸ‘‡**

| æ–¹æ³•å            | æ  è¿°                                                       |
| ----------------- | ------------------------------------------------------------ |
| **Elem**() Value  | å–å€¼æŒ‡å‘çš„å…ƒç´ å€¼ï¼Œç±»ä¼¼äºè¯­è¨€å±‚`*`æ“ä½œã€‚å½“å€¼ç±»å‹ä¸æ˜¯æŒ‡é’ˆæˆ–æ¥å£æ—¶å‘ç”Ÿå®• æœºï¼Œç©ºæŒ‡é’ˆæ—¶è¿”å› nil çš„ Value |
| Addr() Value      | å¯¹å¯å¯»å€çš„å€¼è¿”å›å…¶åœ°å€ï¼Œç±»ä¼¼äºè¯­è¨€å±‚`&`æ“ä½œã€‚å½“å€¼ä¸å¯å¯»å€æ—¶å‘ç”Ÿå®•æœº |
| CanAddr() bool    | è¡¨ç¤ºå€¼æ˜¯å¦å¯å¯»å€                                             |
| **CanSet**() bool | è¿”å›å€¼èƒ½å¦è¢«ä¿®æ”¹ã€‚è¦æ±‚å€¼å¯å¯»å€ä¸”æ˜¯å¯¼å‡ºçš„å­—æ®µ                 |

**ä¿®æ”¹çš„æ–¹æ³•å¦‚ä¸‹ğŸ‘‡**

| Set(x Value)        | å°†å€¼è®¾ç½®ä¸ºä¼ å…¥çš„åå°„å€¼å¯¹è±¡çš„å€¼                               |
| ------------------- | ------------------------------------------------------------ |
| Setlnt(x int64)     | ä½¿ç”¨ int64 è®¾ç½®å€¼ã€‚å½“å€¼çš„ç±»å‹ä¸æ˜¯ intã€int8ã€int16ã€ int32ã€int64 æ—¶ä¼šå‘ç”Ÿå®•æœº |
| SetUint(x uint64)   | ä½¿ç”¨ uint64 è®¾ç½®å€¼ã€‚å½“å€¼çš„ç±»å‹ä¸æ˜¯ uintã€uint8ã€uint16ã€uint32ã€uint64 æ—¶ä¼šå‘ç”Ÿå®•æœº |
| SetFloat(x float64) | ä½¿ç”¨ float64 è®¾ç½®å€¼ã€‚å½“å€¼çš„ç±»å‹ä¸æ˜¯ float32ã€float64 æ—¶ä¼šå‘ç”Ÿå®•æœº |
| SetBool(x bool)     | ä½¿ç”¨ bool è®¾ç½®å€¼ã€‚å½“å€¼çš„ç±»å‹ä¸æ˜¯ bod æ—¶ä¼šå‘ç”Ÿå®•æœº            |
| SetBytes(x []byte)  | è®¾ç½®å­—èŠ‚æ•°ç»„ []byteså€¼ã€‚å½“å€¼çš„ç±»å‹ä¸æ˜¯ []byte æ—¶ä¼šå‘ç”Ÿå®•æœº   |
| SetString(x string) | è®¾ç½®å­—ç¬¦ä¸²å€¼ã€‚å½“å€¼çš„ç±»å‹ä¸æ˜¯ string æ—¶ä¼šå‘ç”Ÿå®•æœº             |

**ä»£ç æ¡ˆä¾‹å¦‚ä¸‹**

```go
func main() {
	type dog struct {
		LegCount int
		age int
	}
	// è·å–dogå®ä¾‹åœ°å€çš„åå°„å€¼å¯¹è±¡
	valueOfDog := reflect.ValueOf(&dog{})
	// å–å‡ºdogå®ä¾‹åœ°å€çš„å…ƒç´ 
	valueOfDog = valueOfDog.Elem()
	// è·å–legCountå­—æ®µçš„å€¼
	vLegCount := valueOfDog.FieldByName("LegCount")
	vAge := valueOfDog.FieldByName("age")
	// å°è¯•è®¾ç½®legCountçš„å€¼
	vLegCount.SetInt(4)
	// è¿™é‡Œä¼šæŠ¥é”™
	vAge.SetInt(4)
	fmt.Println(vLegCount.Int())
}
```

## é€šè¿‡åå°„è°ƒç”¨å‡½æ•°

å¦‚æœåå°„å€¼å¯¹è±¡ï¼ˆreflect.Valueï¼‰ä¸­å€¼çš„ç±»å‹ä¸ºå‡½æ•°æ—¶ï¼Œå¯ä»¥é€šè¿‡ reflect.Value è°ƒç”¨è¯¥å‡½æ•°ï¼Œä½¿ç”¨åå°„è°ƒç”¨å‡½æ•°æ—¶ï¼Œéœ€è¦å°†å‚æ•°ä½¿ç”¨åå°„å€¼å¯¹è±¡çš„åˆ‡ç‰‡ []reflect.Value æ„é€ åä¼ å…¥ **Call()** æ–¹æ³•ä¸­ï¼Œè°ƒç”¨å®Œæˆæ—¶ï¼Œå‡½æ•°çš„è¿”å›å€¼é€šè¿‡ []reflect.Value è¿”å›

```go
package main
import (
	"fmt"
	"reflect"
)
// æ™®é€šå‡½æ•°
func add(a, b int) int {
	return a + b
}
func main() {
	// å°†å‡½æ•°åŒ…è£…ä¸ºåå°„å€¼å¯¹è±¡
	funcValue := reflect.ValueOf(add)
	// æ„é€ å‡½æ•°å‚æ•°, ä¼ å…¥ä¸¤ä¸ªæ•´å‹å€¼
	paramList := []reflect.Value{reflect.ValueOf(10), reflect.ValueOf(20)}
	// åå°„è°ƒç”¨å‡½æ•°
	retList := funcValue.Call(paramList)
	// è·å–ç¬¬ä¸€ä¸ªè¿”å›å€¼, å–æ•´æ•°å€¼
	fmt.Println(retList[0].Int())
}
```

## é€šè¿‡åå°„è°ƒç”¨å¯¹è±¡ä¸­çš„æ–¹æ³•

å¦‚æœåå°„å€¼å¯¹è±¡ä¸­å…·æœ‰æ–¹æ³•æ—¶ï¼Œå¯ä»¥é€šè¿‡åå°„è°ƒç”¨æ–¹æ³•ï¼Œè·å–æ–¹æ³•å¦‚ä¸‹ğŸ‘‡

| æ–¹æ³•                                | æè¿°                                     |
| ----------------------------------- | ---------------------------------------- |
| **Method**(i int) Value             | æ ¹æ®ç´¢å¼•ï¼Œè¿”å›ç´¢å¼•å¯¹åº”çš„æ–¹æ³•             |
| **NumMethod**() int                 | è¿”å›ç»“æ„ä½“æˆå‘˜æ–¹æ³•(åŒ…å«ç§æœ‰)             |
| **MethodByName**(name string) Value | æ ¹æ®ç»™å®šå­—ç¬¦ä¸²è¿”å›å­—ç¬¦ä¸²å¯¹åº”çš„ç»“æ„ä½“æ–¹æ³• |

```go
package main

import (
	"fmt"
	"reflect"
)
type Cat struct {
	Name string
}

func (c *Cat) Sleep() {
	fmt.Println("å‘œå‘œå‘œ...")
}

func main() {
	cat := Cat{}
	valueOf := reflect.ValueOf(&cat)
	showMethod := valueOf.MethodByName("Show")
	showMethod.Call(nil)
}
```

## åå°„å®ç°ï¼šmap è½¬ struct

```go
func Map2Struct(m map[string]interface{}, obj interface{}) {
	value := reflect.ValueOf(obj)

	// obj å¿…é¡»æ˜¯æŒ‡é’ˆä¸”æŒ‡é’ˆæŒ‡å‘çš„å¿…é¡»æ˜¯ struct
	if value.Kind() == reflect.Ptr && value.Elem().Kind() == reflect.Struct {
		value = value.Elem()
		getMapName := func(key string) interface{} {
			for k, v := range m {
				if strings.EqualFold(k, key) {
					return v
				}
			}
			return nil
		}
		// å¾ªç¯èµ‹å€¼
		for i := 0; i < value.NumField(); i++ {
			// è·å–å­—æ®µ type å¯¹è±¡
			field := value.Field(i)
			if !field.CanSet() {
				continue
			}
			// è·å–å­—æ®µåç§°
			fieldName := value.Type().Field(i).Name
			fmt.Println("fieldName -> ", fieldName)
			// è·å– map ä¸­çš„å¯¹åº”çš„å€¼
			fieldVal := getMapName(fieldName)
			if fieldVal != nil {
				field.Set(reflect.ValueOf(fieldVal))
			}
		}
	} else {
		panic("must prt")
	}

}
```

## åå°„å®ç°ï¼šstruct è½¬ map

```go
func Struct2Map(obj interface{}) map[string]interface{} {
	value := reflect.ValueOf(obj)

	if value.Kind() != reflect.Ptr || value.Elem().Kind() != reflect.Struct {
		panic("must prt")
	}
	value = value.Elem()
	t := value.Type()

	// åˆ›å»º map
	resultMap := make(map[string]interface{})

	// å¾ªç¯è·å–å­—æ®µåç§°ä»¥åŠå¯¹åº”çš„å€¼
	for i := 0; i < value.NumField(); i++ {
		val := value.Field(i)
		typeName := t.Field(i)
		if !val.CanSet() {
			resultMap[typeName.Name] = reflect.New(typeName.Type).Elem().Interface()
			continue
		}
		resultMap[typeName.Name] = val.Interface()
	}

	return resultMap
}
```

